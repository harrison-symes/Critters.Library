;/*FB_PKG_DELIM*/

__d("MWInboxQPContext.react",["emptyFunction","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useState,k=i.createContext(null),l=i.createContext(c("emptyFunction"));function a(a){var b=d("react-compiler-runtime").c(3);a=a.children;var c=j(null),e=c[0];c=c[1];b[0]!==e||b[1]!==a?(c=i.jsx(l.Provider,{value:c,children:i.jsx(k.Provider,{value:e,children:a})}),b[0]=e,b[1]=a,b[2]=c):c=b[2];return c}g.MWInboxQPContext=k;g.MWInboxQPContextSetter=l;g.MWInboxQPContextProvider=a}),98);
__d("WAGetUserMedia",[],(function(a,b,c,d,e,f){"use strict";function a(){var a=navigator.mediaDevices;return a==null?null:function(b){return a.getUserMedia(b)}}b=a();f.getUserMedia=b}),66);
__d("WAPttComposerOpusRecorder",["$InternalEnum","WAGetUserMedia","WANullthrows","WAOpusRecorderWorkerClient","err"],(function(a,b,c,d,e,f,g){var h={bitRate:16e3,bufferLength:4096,numberOfChannels:1,encoderSampleRate:16e3,maxBuffersPerPage:40,encoderApplication:2048,encoderFrameSize:20,streamOptions:{optional:[],mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}}},i=b("$InternalEnum").Mirrored(["INACTIVE","RECORDING","PAUSED","STOPPED"]);a=function(){function a(a){var b=this;this._duration=0;this._recordedPages=[];this._state=i.INACTIVE;this._isFirstBuffer=!1;this._requestCount=0;this._pendingFlushResolvers=new Map();this._handleEncoderMessage=function(a){a=a.data;switch(a.message){case"page":b._storePage(a.page);break;case"flushed":b._handleFlushed(a.requestId);break;default:throw c("err")("Invalid message event type: "+a.message)}};if(!k())throw c("err")("Recording is not supported in this browser");this._createStream=a.createStream;this._onDuration=a.onDuration;this._onPause=a.onPause;this._onResume=a.onResume;this._onStart=a.onStart;this._onStop=a.onStop;this._handlePage=a.onPage;this._completeRecordingPromise=new Promise(function(a){b._resolveCompleteRecordingPromise=a});this._audioContext=new AudioContext();this._encoderNode=this._audioContext.createScriptProcessor(h.bufferLength,h.numberOfChannels,h.numberOfChannels);this._encoderNode.onaudioprocess=function(a){b._encodeBuffers(a.inputBuffer)};this._monitorNode=this._audioContext.createGain()}var b=a.prototype;b.getState=function(){return this._state};b.start=async function(){switch(this._state){case i.RECORDING:return!0;case i.STOPPED:return!1;case i.PAUSED:return this.resume();case i.INACTIVE:break}this._recordedPages=[];this._isFirstBuffer=!0;this._duration=0;var a=d("WAOpusRecorderWorkerClient").getOpusEncoderWorker();this._encoder=a;a.addEventListener("message",this._handleEncoderMessage);var b=await this._startRecording();if(!b)return!1;(b=this._onStart)==null||b.call(this);(b=this._onDuration)==null||b.call(this,this._duration);a.postMessage({command:"encode-init",config:babelHelpers.extends({},h,{originalSampleRate:this._audioContext.sampleRate})});this._encoderNode.connect(this._audioContext.destination);return!0};b.stop=function(){var a;if(this._state===i.STOPPED)return;this._state=i.STOPPED;(a=this._recordingAbortController)==null||a.abort();this._audioContext.close&&this._audioContext.close();this._monitorNode.disconnect();this._encoderNode.disconnect();(a=this._encoder)==null||a.postMessage({command:"encode-done"})};b.pause=function(){var a;if(this._state!==i.RECORDING)return;this._state=i.PAUSED;(a=this._recordingAbortController)==null||a.abort();(a=this._onPause)==null||a.call(this)};b.resume=async function(){switch(this._state){case i.RECORDING:return!0;case i.STOPPED:return!1;case i.INACTIVE:throw c("err")("Attempting to resume recording that hasn't started");case i.PAUSED:break}var a=await this._startRecording();if(!a)return!1;(a=this._onResume)==null||a.call(this);return!0};b.getDuration=function(){return this._duration};b.getMonitorNode=function(){return this._monitorNode};b._encodeBuffers=function(a){if(this._isFirstBuffer){this._isFirstBuffer=!1;return}if(this._state!==i.RECORDING)return;var b=[];for(var d=0;d<a.numberOfChannels;d++)b[d]=a.getChannelData(d);d=c("WANullthrows")(this._encoder);d.postMessage({command:"encode",buffers:b});this._duration+=a.duration;(d=this._onDuration)==null||d.call(this,this._duration)};b._getNextRequestId=function(){this._requestCount++;return this._requestCount};b._startRecording=async function(){this._state=i.RECORDING;this._recordingAbortController=new AbortController();var a=await l(this._createStream,this._audioContext,[this._encoderNode,this._monitorNode],this._recordingAbortController.signal);if(!a){this.stop();return!1}return!0};b._storePage=function(a){this._recordedPages.push(a);if(a[5]&4){var b;(b=this._handlePage)==null||b.call(this,a,!0);b=c("WANullthrows")(this._encoder);b.removeEventListener("message",this._handleEncoderMessage);this._resolveCompleteRecordingPromise(j(this._recordedPages));this._recordedPages=[];(b=this._onStop)==null||b.call(this);return}(b=this._handlePage)==null||b.call(this,a,!1)};b._handleFlushed=function(a){var b=c("WANullthrows")(this._pendingFlushResolvers.get(a));this._pendingFlushResolvers.delete(a);b(j(this._recordedPages))};b.getPartialRecording=function(){var a=this,b=this._getNextRequestId(),d=new Promise(function(c){a._pendingFlushResolvers.set(b,c)}),e=c("WANullthrows")(this._encoder);e.postMessage({command:"flush",requestId:b});return d};b.getCompleteRecording=function(){return this._completeRecordingPromise};return a}();function j(a){var b=a.reduce(function(a,b){return a+b.length},0);b=new Uint8Array(b);var c=0;for(a of a)b.set(a,c),c+=a.length;return new Blob([b],{type:"audio/ogg; codecs=opus"})}function k(){return Boolean(window.AudioContext&&d("WAGetUserMedia").getUserMedia)}async function l(a,b,c,d){var e=await a(d);if(d.aborted||e==null)return!1;var f=b.createMediaStreamSource(e);c.forEach(function(a){f.connect(a)});d.addEventListener("abort",function(){e.getTracks().forEach(function(a){a.stop()}),f.disconnect()},{once:!0});return!0}g.OpusRecorderState=i;g.OpusRecorder=a}),98);
__d("WAPttComposerRecorderPollableTimer",[],(function(a,b,c,d,e,f){a=function(){function a(){}var b=a.prototype;b.start=function(){this.$1=Date.now()};b.stop=function(){this.$2=Date.now()};b.pause=function(){this.stop()};b.resume=function(){this.$1=Date.now()-this.getTime(),this.$2=null};b.getTime=function(){var a,b=this.$1;if(b==null)return 0;a=(a=this.$2)!=null?a:Date.now();return a-b};return a}();f["default"]=a}),66);
__d("WAPttComposerScaleWaveform",["invariant"],(function(a,b,c,d,e,f,g,h){function a(a,b){if(b===a.length)return a;if(b===0)return[];if(a.length===0)return new Array(b).fill(0);return b>a.length?i(a,b):j(a,b)}function i(a,b){b>a.length||h(0,75746,b,a.length);var c;if(a.length===1)c=0;else{var d=(b-a.length)/(a.length-1);c=1/(1+d)}d=[];b>=1&&d.push(a[0]);for(var e=1;e<b-1;e++){var f=e*c,g=Math.floor(f),i=f-g;d.push(k(a[g],a[Math.ceil(f)],i))}b>=2&&d.push(a[a.length-1]);return d}function j(a,b){b<a.length||h(0,75747,b,a.length);var c=[];b=b/a.length;var d=0,e=0,f=0;for(a of a)d+=a,f+=1,e+=b,e>=1&&(c.push(d/f),f=0,d=0,e-=1);f>0&&c.push(d/f);return c}function k(a,b,c){return a+(b-a)*c}g["default"]=a}),98);
__d("WAStartAnimationLoop",[],(function(a,b,c,d,e,f){function a(a,b){b=b!=null?b:{};b=b.delay;var c=b===void 0?0:b,d,e,f;b=function(){e=!0,window.cancelAnimationFrame(d)};var g=function(b){(f==null||b-f>=c)&&(a(b),f=b);if(e)return;d=window.requestAnimationFrame(g)};d=window.requestAnimationFrame(g);return b}f.startAnimationLoop=a}),66);
__d("WAPttComposerWaveformRecorder",["WANullthrows","WAPttComposerRecorderPollableTimer","WAPttComposerScaleWaveform","WAStartAnimationLoop"],(function(a,b,c,d,e,f,g){a=function(){function a(a,b){var d=this;this.$2=new(c("WAPttComposerRecorderPollableTimer"))();this.$3=[];this.$4=[];this.$5=0;this.$10=function(){d.$5=Math.max(d.$5,d.$11());var a=d.$3.length/d.$1;a=Math.floor((d.getDuration()-a)*d.$1);if(a===0)return;for(var b=0;b<a;b++)d.$3.push(d.$5);d.$5=0};this.$12=0;this.$7=h(a);a.connect(this.$7);this.$1=b}var b=a.prototype;b.start=function(){this.$2.start(),this.$9()};b.stop=function(){var a;this.$2.stop();(a=this.$6)==null||a.call(this)};b.pause=function(){var a;this.$2.pause();(a=this.$6)==null||a.call(this)};b.resume=function(){this.$2.resume(),this.$9()};b.$9=function(){this.$6=d("WAStartAnimationLoop").startAnimationLoop(this.$10)};b.$11=function(){var a,b=c("WANullthrows")(this.$7);this.$8=(a=this.$8)!=null?a:new Uint8Array(b.frequencyBinCount);a=this.$8;b.getByteFrequencyData(a);return Math.max.apply(Math,Array.from(a))/255};b.commitSamples=function(a){a=Math.floor(a*this.$1);a=a-this.$4.length;var b=this.$3.length-this.$12;if(a===0||b===0)return;b=this.$3.slice(this.$12,this.$3.length);b=c("WAPttComposerScaleWaveform")(b,a);for(a of b)this.$4.push(a);this.$12=this.$3.length};b.getSamples=function(){return this.$3};b.getDuration=function(){var a;a=(a=this.$2.getTime())!=null?a:0;return a/1e3};b.getCorrectedSamples=function(){return this.$4};return a}();function h(a){a=a.context.createAnalyser();a.fftSize=32;a.smoothingTimeConstant=0;a.minDecibels=-60;a.maxDecibels=-10;return a}g["default"]=a}),98);
__d("WAPttComposerRecorder",["WAPttComposerOpusRecorder","WAPttComposerWaveformRecorder"],(function(a,b,c,d,e,f,g){a=function(){function a(a){var b=this;this._handleOpusRecorderDuration=function(){b._waveformRecorder.commitSamples(b.getDuration()),b._onDuration==null||b._onDuration(b.getDuration())};this._onDuration=a.onDuration;this._opusRecorder=new(d("WAPttComposerOpusRecorder").OpusRecorder)({createStream:a.createStream,onDuration:this._handleOpusRecorderDuration,onPage:function(b,c){a.onPage==null||a.onPage(b,c)}});this._waveformRecorder=new(c("WAPttComposerWaveformRecorder"))(this._opusRecorder.getMonitorNode(),a.waveformSampleRate)}var b=a.prototype;b.start=async function(){var a=await this._opusRecorder.start();if(!a)return!1;this._waveformRecorder.start();return!0};b.stop=function(){this._opusRecorder.stop(),this._waveformRecorder.stop()};b.pause=function(){this._opusRecorder.pause(),this._waveformRecorder.pause()};b.resume=async function(){var a=await this._opusRecorder.resume();if(!a)return!1;this._waveformRecorder.resume();return!0};b.getDuration=function(){return this._opusRecorder.getDuration()};b.getPreciseDuration=function(){var a;return(a=this._waveformRecorder.getDuration())!=null?a:0};b.getLiveWaveformSamples=function(){return this._waveformRecorder.getSamples()};b.getCorrectedWaveformSamples=function(){return this._waveformRecorder.getCorrectedSamples()};b.getPartialRecording=function(){return this._opusRecorder.getPartialRecording()};b.getCompleteRecording=function(){return this._opusRecorder.getCompleteRecording()};return a}();g.default=a}),98);
__d("MWPUseVoiceRecorderV2",["FBLogger","MWPAudioPlayerIcons.react","MWPAudioPlayerLabels","WAGetSafeQPLError","WAMaybeTranscodeOggOpusToWavForPlayback","WAPttComposerRecorder","clearTimeout","emptyFunction","err","react","setTimeout","useIsMountedRef","usePrevious"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n=m||(m=d("react")),o=m,p=o.useCallback,q=o.useEffect,r=o.useReducer,s=o.useRef,t=function(){return c("FBLogger")("wmi").tags(["audio"])},u=8.5;function a(a){switch(a.stage){case"Unopen":case"Recording":return!1;case"Recorded":case"Playing":return!0}}function b(a){switch(a.stage){case"Unopen":case"Recording":return!1;case"Recorded":case"Playing":return!0}}function e(a){switch(a.stage){case"Unopen":return 0;case"Recording":return a.duration;case"Recorded":case"Playing":return Math.max(a.duration-a.currentTime,0)}}function v(a){switch(a.stage){case"Unopen":return 0;case"Recording":return a.recordingTimeout;case"Recorded":case"Playing":return a.duration}}function w(a){switch(a.stage){case"Unopen":case"Recording":return;case"Recorded":case"Playing":return a.currentTime}}function x(a){switch(a.stage){case"Unopen":case"Recorded":return!1;case"Recording":case"Playing":return!0}}function y(a){if(a.stage==="Recorded")return a.currentTime===0;else return!1}function z(a){switch(a.stage){case"Recording":return d("MWPAudioPlayerLabels").stopLabel;case"Unopen":case"Recorded":return d("MWPAudioPlayerLabels").playLabel;case"Playing":return d("MWPAudioPlayerLabels").pauseLabel}}function A(a,b){switch(a.stage){case"Recording":return n.jsx(d("MWPAudioPlayerIcons.react").StopIcon,{color:b});case"Unopen":case"Recorded":return n.jsx(d("MWPAudioPlayerIcons.react").PlayIcon,{color:b});case"Playing":return n.jsx(d("MWPAudioPlayerIcons.react").PauseIcon,{color:b})}}A.displayName=A.name+" [from "+f.id+"]";function B(a,b){switch(b.type){case"Start":return{duration:0,mediaStream:b.mediaStream,recordingTimeout:b.recordingTimeout,stage:"Recording"};case"Toggle":switch(a.stage){case"Unopen":return a;case"Recording":return{currentTime:0,duration:a.duration,stage:"Recorded"};case"Recorded":return{currentTime:a.currentTime,duration:a.duration,stage:"Playing"};case"Playing":return{currentTime:a.currentTime,duration:a.duration,stage:"Recorded"}}break;case"UpdateDuration":if(a.duration!=null&&b.duration<a.duration)return a;var c=b.duration;switch(a.stage){case"Unopen":return a;case"Recording":return{duration:c,mediaStream:a.mediaStream,recordingTimeout:a.recordingTimeout,stage:"Recording"};case"Recorded":return{currentTime:a.currentTime,duration:c,stage:"Recorded"};case"Playing":return{currentTime:a.currentTime,duration:c,stage:"Playing"}}break;case"UpdateTime":c=b.currentTime;switch(a.stage){case"Unopen":case"Recording":return a;case"Recorded":var d=a.duration;return c===d?{currentTime:0,duration:d,stage:"Recorded"}:{currentTime:c,duration:d,stage:"Recorded"};case"Playing":d=a.duration;return c===d?{currentTime:0,duration:d,stage:"Recorded"}:{currentTime:c,duration:d,stage:"Playing"}}break;case"RecordingTimeout":return{currentTime:0,duration:b.recordingTimeout,stage:"Recorded"};case"Reset":return{stage:"Unopen"}}}var C={stage:"Unopen"};function D(a){var b=a.maxDuration,e=b===void 0?60:b;b=a.logClickStartRecording;var f=b===void 0?c("emptyFunction"):b;b=a.logBrowserDenyAccess;var g=b===void 0?c("emptyFunction"):b,m=a.createVoiceRecordQpl;b=r(B,C);var n=b[0],o=b[1],v=c("useIsMountedRef")(),w=s(),x=s(),y=s(),z=s(),A=s(),D=s(c("emptyFunction")),E=p(async function(a){var b=a[0],c=a[1],e=a[2];if(!v.current)return;a=new Date().getTime();c=Math.round(c*1e3);a="audioclip-"+a+"-"+c+".ogg";var f=new File([b],a,{type:"audio/ogg"});c=URL.createObjectURL(await d("WAMaybeTranscodeOggOpusToWavForPlayback").maybeTranscodeOggOpusToWavForPlayback(b));y.current=c;var g=new Audio(c);g.addEventListener("error",function(){var a;t().MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["audioElement error code: ",". message: ",""])),(a=g.error)==null?void 0:a.code,(a=g.error)==null?void 0:a.message)});g.addEventListener("canplay",function(){x.current=g;var a=g.duration;o({duration:a,type:"UpdateDuration"});var b={amplitudes:e,sampling_freq:u};a={duration:a,file:f,waveformData:b};z.current=a;D.current(a);(b=A.current)==null||b.endSuccess()});g.addEventListener("timeupdate",function(){var a;a=(a=x.current)==null?void 0:a.currentTime;a!=null&&o({currentTime:a,type:"UpdateTime"})});g.addEventListener("durationchange",function(){var a;a=(a=x.current)==null?void 0:a.duration;a!=null&&!Number.isNaN(a)&&o({duration:a,type:"UpdateDuration"})})},[v]);q(function(){if(n.stage!=="Recording")return;f();var a=n.mediaStream;void Promise.resolve().then(function(){var b=new(c("WAPttComposerRecorder"))({createStream:function(){return Promise.resolve(a)},waveformSampleRate:u});w.current=b;return b.start()}).then(function(a){if(a){t().INFO(i||(i=babelHelpers.taggedTemplateLiteralLoose(["PTT recording start successfully"])));return}return Promise.reject(c("err")("PTT recording start failed"))}).catch(function(a){var b;t().MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["PTT recording start Error ",""])),a);(b=A.current)==null||b.endFail("start-error",{string:{failReason:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}})});return function(){var a;(a=w.current)==null||a.stop()}},[f,n.mediaStream,n.stage]);var F=c("usePrevious")(n);q(function(){if((F==null?void 0:F.stage)==="Recording"&&n.stage==="Recorded"){var a=w.current;if(a==null)return;a.stop();void Promise.all([a.getCompleteRecording(),a.getCorrectedWaveformSamples()]).then(function(b){var c=b[0];b=b[1];var d=a.getDuration();return E([c,d,b])}).catch(function(a){var b;t().MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["PTT recording stop Error ",""])),a);(b=A.current)==null||b.endFail("browser-deny-access",{string:{failReason:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}})})}},[E,F==null?void 0:F.stage,n.stage]);q(function(){if(n.stage!=="Recording")return;var a=Date.now(),b,d=function(){var f=(Date.now()-a)/1e3;if(f>=e){o({recordingTimeout:e,type:"RecordingTimeout"});return}o({duration:f,type:"UpdateDuration"});b=c("setTimeout")(d,1e3)};b=c("setTimeout")(d,1e3);return function(){b!=null&&c("clearTimeout")(b)}},[e,n.stage]);a=p(function(a){var b=m==null?void 0:m();A.current=b;b==null||b.start({startInfo:{isOpusRecorder:!0}});o({mediaStream:a,recordingTimeout:e,type:"Start"})},[e,m]);b=p(function(){var a;(a=A.current)==null||a.endCancel();o({type:"Reset"});(a=x.current)==null||a.pause();x.current=void 0;z.current=void 0;a=y.current;a!=null&&(URL.revokeObjectURL(a),y.current=void 0)},[]);var G=p(function(){var a=function(){o({maxDuration:e,type:"Toggle"})},b=x.current;if(b==null){a();return}switch(n.stage){case"Unopen":a();break;case"Recording":var c;(c=A.current)==null||c.addPoint("stop-recording");a();break;case"Recorded":(c=A.current)==null||c.addPoint("play-audio");b.play().then(a).catch(function(a){var b;t().MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["PTT recording play Error ",""])),a);(b=A.current)==null||b.endFail("browser-deny-access",{string:{failReason:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}});g()});break;case"Playing":(c=A.current)==null||c.addPoint("pause-playing");b.pause();a();break}},[g,n.stage,e]),H=p(function(){return new Promise(function(a){var b=z.current;if(b!=null)return a(b);D.current=a;if(n.stage==="Recording")return G()})},[n,G]);return{audioEl:x,getVoiceClip:H,reset:b,start:a,state:n,toggle:G}}g.showScreenReaderLabel=a;g.hasScrubber=b;g.getTimerTime=e;g.getDuration=v;g.getCurrentTime=w;g.isProgressing=x;g.isCompleted=y;g.getPlaybackLabel=z;g.getPlaybackIcon=A;g.useVoiceRecorder=D}),98);