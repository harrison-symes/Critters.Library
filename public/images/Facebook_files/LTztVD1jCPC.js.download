;/*FB_PKG_DELIM*/

__d("Base64Utils",["XPlatReactTextEncoder","base64Binary"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("base64Binary").encode(new(d("XPlatReactTextEncoder").TextEncoder)().encode(a))}function b(a){return d("base64Binary").encode(new Uint8Array(a))}function c(a){return d("base64Binary").decode(a).buffer}g.encodeUnicode=a;g.fromArrayBuffer=b;g.toArrayBuffer=c}),98);
__d("CryptoLogger",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("FBLogger")("labyrinth_web","crypto."+a)}function b(a,b){return b instanceof Error?a.catching(b):a}g.CryptoLogger=a;g.captureError=b}),98);
__d("EBBase64Encode",["Base64Utils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("Base64Utils").fromArrayBuffer(a)}g["default"]=a}),98);
__d("EBDeps",["FBLogger","err"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function a(){if(h==null)throw c("err")("EBDeps is not initialized");return h}function b(a,b){if(h!=null)return;var d={},e=function(e){var f=a[e];if(f==null)return 1;f instanceof Function?d[e]=function(){c("FBLogger")("wmi_eb").info("EBDeps: function %s, reason %s",e,b);for(var d=arguments.length,g=new Array(d),h=0;h<d;h++)g[h]=arguments[h];return f.apply(a,g)}:(c("FBLogger")("wmi_eb").info("EBDeps: %s is not function",e),d[e]=f)};for(var f of Object.keys(a))if(e(f))continue;h=d}g.getDeps=a;g.setDeps=b}),98);
__d("EBGating",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("15195")}function b(){return c("gkx")("4877")}function d(){return c("gkx")("17208")}g.isEBSMv2Phase1Enabled=a;g.isFetchBackupIdsFromWorker=b;g.isRemoveLSDataTrace=d}),98);
__d("LSEncryptedBackupsBackupTenancy",[],(function(a,b,c,d,e,f){a=Object.freeze({PRODUCTION:1,SHADOW:2,OPEN:3});f["default"]=a}),66);
__d("WAPubSub",["err"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){function a(){this.$1=new Set()}var b=a.prototype;b.publish=function(a){this.$1.forEach(function(b){return b(a)})};b.subscribe=function(a){var b=this;this.$1.add(a);return function(){b.$1["delete"](a)}};return a}();b=function(){function a(){this.$1=new Map()}var b=a.prototype;b.publish=function(a,b){a=this.$2(a);a.forEach(function(a){return a(b)})};b.$2=function(a){(!this.$1.has(a)||this.$1.get(a)==null)&&this.$1.set(a,new Set());a=this.$1.get(a);if(a==null)throw c("err")("Key space should not be null");return a};b.subscribe=function(a,b){var c=this.$2(a);c.add(b);return function(){c["delete"](b)}};return a}();function a(){return new h()}g.WAPubSub=h;g.WAKeyedPubSub=b;g.simplePubSub=a}),98);
__d("WAGenericStateManager",["Promise","WAPubSub"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a){this.$2=d("WAPubSub").simplePubSub(),this.$1=a}var c=a.prototype;c.onSet=function(a){return this.$2.subscribe(a)};c.set=function(a){this.$1=a;this.$2.publish(a);return this.$1};c.get=function(){return this.$1};c.waitForValue=function(a){var c=this;return this.$1===a?(h||(h=b("Promise"))).resolve():new(h||(h=b("Promise")))(function(b){var d=c.onSet(function(c){c===a&&(d(),b())})})};return a}();g.WAGenericStateManager=a}),98);
__d("MAWEBEnabledStateManager",["WAGenericStateManager"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){function b(){return a.call(this,null)||this}babelHelpers.inheritsLoose(b,a);var c=b.prototype;c.isEnabled=function(){return this.get()===!0};c.waitForEBEnabled=function(){return this.waitForValue(!0)};return b}(d("WAGenericStateManager").WAGenericStateManager);g.MAWEBEnabledStateManager=a}),98);
__d("MAWEBSwitch",["EBGating","ExecutionEnvironment","MAWEBEnabledStateManager","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h;a=c("requireDeferred")("EBIsEbEnabledSubscriber").__setRef("MAWEBSwitch");var i=new(d("MAWEBEnabledStateManager").MAWEBEnabledStateManager)();((h||(h=c("ExecutionEnvironment"))).isInMainThread===!0||d("EBGating").isEBSMv2Phase1Enabled())&&void a.load().then(function(a){return a.subscribeToEbChanges(function(a){i.set(a)})});b=i;g["default"]=b}),98);
__d("LSDataTraceCheckPoint",[],(function(a,b,c,d,e,f){a=Object.freeze({CLIENT_DB_OUTBOUND:1,CLIENT_NETWORK_OUTBOUND:2,CLIENT_NETWORK_INBOUND:10,CLIENT_DB_INBOUND:11,CLIENT_EVALUATE_DASM:12,CLIENT_APP_STATE_CHANGE:13,CLIENT_CREATE_TASK:20,CLIENT_RECIPIENT_PRESENCE:21,CLIENT_EVALUATE_DASM_BEGIN:22,MQTT_PUBLISH:30,MQTT_PUBLISH_ACK:31,MQTT_DISCONNECTED:32,MQTT_CONNECTING:33,MQTT_CONNECTED:34,MQTT_CONNECTION_ACKED:35,TINCAN_RECEIVE_MESSAGE:36,TINCAN_RECEIVE_DECRYPTION_COMPLETE:37,TINCAN_RECEIVE_DECRYPTION_FAILED:38,TINCAN_RECEIVE_DR_QUEUED:39,TINCAN_RECEIVE_DR_SENT_TO_NETWORK:40,TINCAN_RECEIVE_DR_PUBLISH_TO_MQTT:41,TINCAN_RECEIVE_DRMQTT_PUBACK:42,TINCAN_RECEIVE_BOUNCE_TASK_QUEUED:43,TINCAN_RECEIVE_BOUNCE_TASK_SENT_TO_NETWORK:44,TINCAN_RECEIVE_BOUNCE_TASK_PUBLISH_TO_MQTT:45,RICH_MEDIA_DOWNLOAD_START:50,RICH_MEDIA_DOWNLOAD_END:51,RICH_MEDIA_DOWNLOAD_ERROR:52,RICH_MEDIA_UPLOAD_START:53,ARMADILLO_ACT:60,ARMADILLO_ACT_TASK_PICK:61,ARMADILLO_ACT_SERIALIZE:62,ARMADILLO_ACT_GROUP_SEND:63,ARMADILLO_ACT_SEND_FAILURE:64,ARMADILLO_ACT_MESSAGE_SEND:65,NETWORK_DISCONNECTED:70,NETWORK_CONNECTED:71,NETWORK_UNKNOWN:72,FLOW_CREAT:80,FLOW_END:81,FLOW_INTERRUPTED:82,FLOW_CONNECT_ID:83,FLOW_END_AND_FLUSH:84,FLOW_END_FOR_FAILURE:85,TRACE_CREATED:98,CLIENT_READY_TO_FLUSH:99,PENDING_DELTA:100,NO_PENDING_DELTA:101,INIT_SYNC:102,RESNAPSHOT:103,CATCH_UP:104,PERIODIC_SYNC:105,CATCH_UP_FROM_REVISION:106,RESNAPSHOT_CONTINUE:107,RESNAPSHOT_END:108,PERIODIC_SYNC_CONTINUE:109,PERIODIC_SYNC_END:110,CONTACT_SYNC_OPTIMISTIC:111,CONTACT_SYNC_FROM_OMNISTORE:112,CONTACT_SYNC_TAM_OPTIMISTC:113,CONTACT_SYNC_TAM_FROM_OMNISTORE:114,CONTACT_SYNC_TAM_ERROR:115,VERIFY_USER_FOR_SYNC:116,SNAPSHOT_START:117,SNAPSHOT_CONTINUE:118,SNAPSHOT_END:119,FETCH_DELTA:120,DELTA_SUMMARY:130,RECEIVE_DELIVERY_RECEIPT:200,TASK_DESERIALIZATION_ERROR:201,OPTIMISIC_MESSAGE_FAILED:202,SEND_SERVER_AUTHORITATIVE:203,THREAD_RANGE_QUERY_COMPLETE:204,THREAD_RANGE_QUERY_FAILURE:205,THREAD_POINT_QUERY_COMPLETE:206,SEND_SERVER_PARTIAL:207,MARK_AS_OPTIMISTIC_SENT:208,XMS_TRANSPORT_MESSAGE_SEND_START:300,XMS_TRANSPORT_MESSAGE_SEND_FAIL:301,SKIP_TASK_DISPATCH:900,ADVANCED_CRYPTO_MEM_ENCRYPT_TASK_START:1200,ADVANCED_CRYPTO_MEM_ENCRYPT_TASK_COMPLETE:1201,ADVANCED_CRYPTO_MEM_WA_PUBLISH:1202,ADVANCED_CRYPTO_MEM_PUBLISH_ACK:1203,ADVANCED_CRYPTO_MEM_SEND_TASK_COMPLETE:1204,ADVANCED_CRYPTO_MEM_WA_CONNECTION_DISCONNECTED:1205,ADVANCED_CRYPTO_MEM_WA_CONNECTION_CONNECTING:1206,ADVANCED_CRYPTO_MEM_WA_CONNECTION_CONNECTED:1207,ADVANCED_CRYPTO_MEM_FAILURE:1208,ADVANCED_CRYPTO_MEM_SEND_SUCCESS_WITH_RETRY:1209,ADVANCED_CRYPTO_MEM_DELIVERY_RECEIPT_RECEIVED:1210,ADVANCED_CRYPTO_REGISTRATION_CAT_DISK_FETCH_START:1211,ADVANCED_CRYPTO_REGISTRATION_CAT_DISK_FETCH_END:1212,ADVANCED_CRYPTO_REGISTRATION_CAT_NETWORK_FETCH_START:1213,ADVANCED_CRYPTO_REGISTRATION_CAT_NETWORK_FETCH_RETRYSTART:1214,ADVANCED_CRYPTO_REGISTRATION_CAT_NETWORK_FETCH_END:1215,ADVANCED_CRYPTO_REGISTRATION_WA_REQUEST_SEND_START:1216,ADVANCED_CRYPTO_REGISTRATION_WA_REQUEST_SEND_END:1217,ADVANCED_CRYPTO_REGISTRATION_WCR_REGISTER:1218,ADVANCED_CRYPTO_REGISTRATION_SAVE_WA_DEVICE_ID_ERROR:1219,ADVANCED_CRYPTO_MEM_DEVICE_FETCH_START:1220,ADVANCED_CRYPTO_MEM_DEVICE_FETCH_END:1221,ADVANCED_CRYPTO_MEM_ENCRYPTION_BEGIN:1222,ADVANCED_CRYPTO_MEM_ENCRYPTION_END:1223,ADVANCED_CRYPTO_MEM_ENCRYPTION_DEVICE_COUNT:1224,ADVANCED_CRYPTO_DUAL_SEND:1225,ADVANCED_CRYPTO_REGISTRATION_SERVER_SUCCESS:1226,ADVANCED_CRYPTO_REGISTRATION_RETRY_REGISTER:1227,ADVANCED_CRYPTO_REGISTRATION_CAT_NULL:1228,ADVANCED_CRYPTO_REGISTRATION_WCR_MANAGER_NULL:1229,ADVANCED_CRYPTO_REGISTRATION_RESPONSE_NULL:1230,ADVANCED_CRYPTO_REGISTRATION_SELF_NULL:1231,ADVANCED_CRYPTO_REGISTRATION_EMPTY_DEVICE_ID:1232,ADVANCED_CRYPTO_REGISTRATIONRETRY_REGISTER_FAILURE:1233,ADVANCED_CRYPTO_GROUP_DUAL_SEND:1234,RAVEN_IMAGE_MESSAGE:1235,RAVEN_VIDEO_MESSAGE:1236,ADVANCED_CRYPTO_REGISTRATION_RETRY_REGISTER_CAT:1237,ADVANCED_CRYPTO_REGISTRATION_RETRY_REGISTER_NETWORK:1238,ADVANCED_CRYPTO_CAT_DISK_FETCH_CAT_INVALID:1239,ADVANCED_CRYPTO_RECONNECT_GENERIC_ERROR:1240,ADVANCED_CRYPTO_RECONNECT_CAT_INVALID:1241,ADVANCED_CRYPTO_RECONNECT_CAT_EXPIRED:1242,ADVANCED_CRYPTO_CAT_MEMORY_FETCH_NULL:1243,ADVANCED_CRYPTO_FIRST_CONNECTION_START:1244,LABYRINTH_INITIALIZE_BACKUP_SPROC:1400,LABYRINTH_INITIALIZE_BACKUP_SUCCESS_SPROC:1401,LABYRINTH_INITIALIZE_BACKUP_FAILURE:1402,LABYRINTH_CREATE_BACKUP_MAILBOX_SPROC:1403,LABYRINTH_HANDLE_CREATE_BACKUP_MAILBOX_SUCCESS_SPROC:1404,LABYRINTH_OPEN_EPOCH_SPROC:1405,LABYRINTH_HANDLER_OPEN_EPOCH_SUCCESS_SPROC:1406,LABYRINTH_HANDLER_OPEN_EPOCH_FAILURE_SPROC:1407,LABYRINTH_CREATE_VIRTUAL_DEVICE_SPROC:1410,LABYRINTH_HANDLE_CREATE_VIRTUAL_DEVICE_SUCCESS_SPROC:1411,LABYRINTH_HANDLE_CREATE_VIRTUAL_DEVICE_FAILURE_SPROC:1412,LABYRINTH_ADD_DEVICE_SPROC:1413,LABYRINTH_ADD_DEVICE_FROM_VIRTUAL_SPROC:1414,LABYRINTH_HANDOLE_WRONG_RECOVERY_CODE_SPROC:1415,LABYRINTH_HANDLE_ADD_DEVICE_SUCCESS_SPROC:1416,LABYRINTH_HANDLE_ADD_DEVICE_FAILURE_SPROC:1417,LABYRINTH_ADD_DEVICE_SPROC_ADD_DEVICE_ALREADY_PENDING:1600,LABYRINTH_ADD_DEVICE_SPROC_UPDATE_RECOVERY_DATA_TABLE_START:1601,LABYRINTH_ADD_DEVICE_SPROC_ADD_DEVICE_NO_VD_TABLE:1602,LABYRINTH_ADD_DEVICE_SPROC_GENERATE_RECOVERY_SECRETS_START:1603,LABYRINTH_ADD_DEVICE_SPROC_WRONG_RC:1604,LABYRINTH_ADD_DEVICE_SPROC_NULL_VD:1605,LABYRINTH_ADD_DEVICE_SPROC_NO_RC_STATUS_TABLE_FOUND:1606,LABYRINTH_ADD_DEVICE_SPROC_ISSUE_FETCH_VD_TASK:1607,LABYRINTH_ADD_DEVICE_SPROC_SUCCESS:1608,LABYRINTH_INITIALIZE_RESTORE_SPROC:1418,LABYRINTH_DECRYPT_THREADS_SPROC:1419,LABYRINTH_REQUEST_MESSAGES_FROM_THREADS_SPROC:1420,LABYRINTH_REQUEST_MESSAGES_FROM_RANGE_QUERY_SPROC:1421,LABYRINTH_DECRYPT_MESSAGES_SPROC:1422,LABYRINTH_DELETE_BACKUP_ON_CLIENT_SPROC:1423,LABYRINTH_DELETE_BACKUPS_SPROC:1424,LABYRINTH_HANDLE_DELETE_MAILBOX_SPROC:1425,LABYRINTH_ISSUE_DELETE_BACKUP_TASK_SPROC:1426,LABYRINTH_BACKUP_UPLOAD_BEGIN:1427,LABYRINTH_BACKUP_UPLOAD_SUCCESS_SPROC:1428,LABYRINTH_CREATE_EXTRA_VIRTUAL_DEVICE_SPROC:1429,LABYRINTH_QR_INIT_ADD_DEVICE_SPROC:1430,LABYRINTH_QR_INIT_ADD_DEVICE_SUCCESS_SPROC:1431,LABYRINTH_QR_INIT_GET_SECRETS_SPROC:1433,LABYRINTH_QR_FINISH_ADD_PEER_DEVICE_SPROC:1434,LABYRINTH_SYNC_EPOCHS_STORED_PROCEDURE_SPROC:1436,LABYRINTH_SYNC_EPOCHS_SUCCESS_SPROC:1437,LABYRINTH_SYNC_EPOCHS_FORWARD_DERIVATION_END:1438,LABYRINTH_SYNC_EPOCHS_BACKWARD_DERIVATION_END:1439,LABYRINTH_SYNC_EPOCHS_OPEN_NEW_EPOCH:1440,LABYRINTH_PREPARE_OPEN_EPOCH_SPROC:1441,LABYRINTH_PREPARE_OPEN_EPOCH_SUCCESS_SPROC:1442,LABYRINTH_MEB_MANAGER_ADD_DEVICE:1443,LABYRINTH_BACKUP_UPLOAD_FAIL:1450,LABYRINTH_DECRYPT_SINGLE_MESSAGE_SPROC:1498,LABYRINTH_DECRYPT_SINGLE_MESSAGE_SUCCESS:1499,LABYRINTH_MEDIA_BACKUP_START:1455,LABYRINTH_MEDIA_BACKUP_SUCCESS:1456,LABYRINTH_MEDIA_BACKUP_FAILURE:1458,LABYRINTH_MEDIA_RESTORE_START:1459,LABYRINTH_MEDIA_RESTORE_SUCCESS:1460,LABYRINTH_MEDIA_RESTORE_FAILURE:1462,LABYRINTH_REMOVE_VIRTUAL_DEVICE_SPROC:1484,LABYRINTH_HANDLE_REMOVE_VIRTUAL_DEVICE_RESULT_SUCCESS:1485,LABYRINTH_HANDLE_REMOVE_VIRTUAL_DEVICE_RESULT_FAILURE:1486,LABYRINTH_REMOVE_VIRTUAL_DEVICE_BACKUP_NOT_FOUND:1493,LABYRINTH_REMOVE_VIRTUAL_DEVICE_WRITE_TASK:1494,LABYRINTH_BACKUP_UPLOAD_ENQUEUE_TASK_EXECUTER:1495,LABYRINTH_BACKUP_UPLOAD_ENQUEUE_SERIALIZER:1496,LABYRINTH_BACKUP_UPLOAD_SERIALIZE:1451,LABYRINTH_BACKUP_UPLOAD_SERIALIZE_SUCCEED:1463,LABYRINTH_BACKUP_UPLOAD_SERIALIZE_FAIL:1464,LABYRINTH_UPDATE_BACKUP_TABLE_SPROC:1467,LABYRINTH_FETCH_BACKUP_IDS_SPROC:1468,LABYRINTH_PROCESS_BACKUP_IDS_SPROC:1487,LABYRINTH_BACKUP_STATUS_NO_INFO:1488,LABYRINTH_BACKUP_STATUS_FETCH_ERROR:1489,LABYRINTH_BACKUP_STATUS_NOT_ONBOARDED:1490,LABYRINTH_BACKUP_STATUS_ONBOARDED:1491,LABYRINTH_BACKUP_STATUS_NO_BACKUPS_PRESENT:1492,LABYRINTH_OPT_OUT_OF_BACKUP_SPROC:1469,LABYRINTH_TRIGGER_THIRD_PARTY_ID_GENERATION_SPROC:1470,LABYRINTH_HANDLE_TRIGGER_THIRD_PARTY_ID_GENERATION_SPROC:1471,LABYRINTH_FETCH_BACKUPS_METADATA_SPROC:1478,LABYRINTH_HANDLE_BACKUPS_METADATA_RESULT_SPROC:1480,LABYRINTH_RESTORE_THREADS_SUCCESS:1481,LABYRINTH_RESTORE_MESSAGES_SUCCESS:1482,LABYRINTH_POINT_QUERY_MESSAGE_RESTORE:2511,LABYRINTH_RESTORE_MESSAGE_NEWER_DIRECTION:2514,LABYRINTH_RESTORE_SURROUNDING_MESSAGES:2515,LABYRINTH_BACKUP_UPLOAD_GET_ECHO_DOC:1497,LABYRINTH_MEBMANAGER_ADD_DEVICE_FETCH_BACKUP_STATE:1800,LABYRINTH_MEBMANAGER_ADD_DEVICE_FETCH_BACKUP_STATE_SUCCESS:1801,LABYRINTH_MEBMANAGER_ADD_DEVICE_FETCH_BACKUP_STATE_FAILURE:1802,LABYRINTH_MEBMANAGER_ADD_DEVICE_ADD_DEVICE_SPROC_CALLED:1803,LABYRINTH_MEBMANAGER_ADD_DEVICE_ADD_DEVICE_SPROC_RETURN_SUCCESS:1804,LABYRINTH_MEBMANAGER_ADD_DEVICE_ADD_DEVICE_SPROC_RETURN_FAILURE:1805,LABYRINTH_MEBMANAGER_ADD_DEVICE_NOTOFICATION_TRIGGERED:1806,LABYRINTH_MEBMANAGER_ADD_DEVICE_FETCH_ADD_DEVICE_STATE:1807,LABYRINTH_MEBMANAGER_ADD_DEVICE_FETCH_ADD_DEVICE_STATEFAILURE:1808,LABYRINTH_MEBMANAGER_ADD_DEVICE_INIT_RESTORE_SPROC_CALLED:1809,LABYRINTH_MEBMANAGER_ADD_DEVICE_INIT_RESTORE_SPROC_RETURN_SUCCESS:1810,LABYRINTH_MEBMANAGER_ADD_DEVICE_INIT_RESTORE_SPROC_RETURN_FAILURE:1811,LABYRINTH_MEBMANAGER_CREATE_EXTRA_VIRTUAL_DEVICE_SPROC_CALLED:1812,LABYRINTH_MEBMANAGER_CREATE_EXTRA_VIRTUAL_DEVICE_SPROC_RETURN_SUCCESS:1813,LABYRINTH_MEBMANAGER_CREATE_EXTRA_VIRTUAL_DEVICE_SPROC_RETURN_FAILURE:1814,LABYRINTH_MEBMANAGER_CREATE_EXTRA_VIRTUAL_DEVICE_NOTIFICATION_TRIGGERRED:1815,LABYRINTH_MEBMANAGER_CREATE_EXTRA_VIRTUAL_DEVICE_FETCH_RECOVERY_CODE_STATUS:1816,LABYRINTH_MEBMANAGER_CREATE_EXTRA_VIRTUAL_DEVICE_FETCH_RECOVERY_CODE_STATUS_FAILURE:1817,LABYRINTH_MEBMANAGER_CREATE_EXTRA_VIRTUAL_DEVICE_CREATE_EXTRA_VIRTUAL_DEVICE_SUCCESS:1818,LABYRINTH_MEBMANAGER_CREATE_EXTRA_VIRTUAL_DEVICE_CREATE_EXTRA_VIRTUAL_DEVICE_FAILURE:1819,LABYRINTH_MEBMANAGER_WRONG_RECOVERY_CODE:1823,LABYRINTH_ENCRYPT_MESSAGE_FAIL:1828,LABYRINTH_ENCRYPT_MESSAGE_GENERATED_PAYLOAD:1824,LABYRINTH_ENCODE_DOCUMENT:1820,LABYRINTH_ENCODE_DOCUMENT_FAIL:1821,LABYRINTH_ENCODE_DOCUMENT_SUCCESS:1822,LABYRINTH_UPLOAD_CANCEL:1850,LABYRINTH_DELETE_BACKUP_ON_CLIENT_STARTING_CANCEL:1851,LABYRINTH_DELETE_BACKUP_ON_CLIENT_DID_CANCEL:1852,LABYRINTH_DELETE_BACKUP_ON_CLIENT_FAILED_CANCEL:1853,LABYRINTH_BACKUP_RETRY_DELETE_MESSAGE_BACKUP_STATUS_ENTRY:1865,LABYRINTH_MESSAGE_INTEGRITY_CHECKER_BEGIN:1881,LABYRINTH_MESSAGE_INTEGRITY_CHECKER_GOT_MESSAGE_IDS_FROM_ACT:1882,LABYRINTH_MESSAGE_INTEGRITY_CHECKER_BEGIN_OCMF_OPE_OPERATIONS:1883,LABYRINTH_MESSAGE_INTEGRITY_CHECKER_END_OCMF_OPE_OPERATIONS:1884,LABYRINTH_MESSAGE_INTEGRITY_CHECKER_FETCH_MESSAGE_RANGE_ERROR:1885,LABYRINTH_MESSAGE_INTEGRITY_CHECKER_ISSUE_COMPARATOR_TASK:1886,LABYRINTH_CLEAR_BACKUP_TABLE_ON_CLIENT:1891,LABYRINTH_CLEAR_VIRTUAL_DEVICES_TABLE_ON_CLIENT:1892,LABYRINTH_CLEAR_BACKUP_METADATA_TABLE_ON_CLIENT:1893,SAP_VESTA_FETCH_VESTA_KEY_AND_SECRET_BEGIN:2400,LABYRINTH_PLUGIN_CALLING_GENERATE_RECOVERY_CODE:2401,SAP_FESTA_FETCH_KEY_AND_SECRET_COMPLETION:2402,SAP_VESTA_CALLING_VESTA_REGISTRATION:2403,SAP_VESTA_REGISTRATION_COMPLETION:2404,LABYRINTH_PLUGIN_CALLING_CREATE_EXTRA_VIRTUAL_DEVICE:2405,SAP_VESTA_NOTIFY_SECRET_STORED_COMPLETION:2406,SAP_VESTA_NOTIFY_CLIENT_ABOUT_VESTA_REGISTRATION:2407,SAP_VESTA_CALLING_VESTA_LOGIN:2411,SAP_VESTA_LOGIN_COMPLETION:2412,LABYRINTH_PLUGIN_CALLING_ADD_DEVICE:2413,LABYRINTH_PLUGIN_CALLING_INITIALIZE_BACKUP:2416,LABYRINTH_PIN_SETUP_BEGIN:2417,LABYRINTH_PIN_SETUP_SUCCESS:2418,LABYRINTH_PIN_SETUP_FAILURE:2419,LABYRINTH_PIN_RESTORE_BEGIN:2420,LABYRINTH_PIN_RESTORE_SUCCESS:2421,LABYRINTH_PIN_RESTORE_FAILURE:2422,LABYRINTH_PLUGIN_CALLING_INITIALIZE_RESTORE:2423,LABYRINTH_FETCH_THREAD_IDS_SPROC:2500,LABYRINTH_FETCH_THREAD_IDS_NATIVE_OP_SUCCESS:2501,LABYRINTH_FETCH_THREAD_IDS_NATIVE_OP_FAILURE:2502,LABYRINTH_REQUEST_MESSAGES_FROM_FETCH_THREAD_IDS_SPROC:2503,LABYRINTH_REQUEST_MESSAGES_FROM_INIT_RESTORE_SPROC:2506,LABYRINTH_POINT_QUERY_RESTORE_TASK_SPROC_START:2512,LABYRINTH_POINT_QUERY_RESTORE_TASK_SPROC_END:2513,LABYRINTH_VERSIONING_UPSERT_DEVICE_ENCRYPTION_VERSIONS_TO_CLIENT_SPROC_START:2800,LABYRINTH_VERSIONING_UPSERT_DEVICE_ENCRYPTION_VERSIONS_TO_CLIENT_SPROC_END:2801,LABYRINTH_VERSIONING_DELETE_AND_SYNC_DEVICE_ENCRYPTION_VERSION_DATA_SPROC:2802,LABYRINTH_VERSIONING_UPSERT_DEVICE_DELETE_DEVICE_ENCRYPTION_VERSION_DATA:2803,LABYRINTH_VERSIONING_SYNC_ENCRYPTION_VERSION_DATA_SPROC:2804,LABYRINTH_VERSIONING_VERSION_SUPPORTED:2805,LABYRINTH_VERSIONING_SYNC_UPDATE_VERSION_DATA:2806,LABYRINTH_VERSIONING_SYNC_NO_VERSION_DATA:2807,LABYRINTH_VERSIONING_VERSION_SELECTED:2808,LABYRINTH_VERSIONING_DELETE_AND_SYNC_DEVICE_DELETE_DEVICE_ENCRYPTION_VERSION_DATA:2809,LABYRINTH_VERSIONING_VERSION_NOT_SUPPORTED:2810,LABYRINTH_VERSIONING_UPSERT_DEVICE_INVALID_SIGNATURE:2811,LABYRINTH_PREPARE_OPEN_EPOCH_SPROC_ISSUE_REQUEST_ASSOC_DEVICES:2821,LABYRINTH_PREPARE_OPEN_EPOCH_FAILURE_NO_BACKUP:2822,LABYRINTH_PREPARE_OPEN_EPOCH_FAILURE_FLOW_ALREADY_IN_PROGRES:2823,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC:2824,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_NUM_EDGES:2825,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_PROCESS_EDGE_FROM:2826,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_PROCESS_EDGE_TO:2827,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_FORWARD_EDGE_SOURCE:2828,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_FORWARD_SOURCE_EPOCH_LOADED:2829,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_DERIVE_CHAINING_KEY_PSK:2830,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_DECRYPT_FORWARD_EDGE_ENTROPY:2831,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_FORWARD_EDGE_DECRYPTION_SUCCESS:2832,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_FORWARD_EDGE_DECRYPTION_FAIL:2833,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_FORWARD_FAIL_TO_LOAD_SOURCE_EPOCH:2834,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_BACKWARD_EDGE_SOURCE:2835,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_BACKWARD_SOURCE_EPOCH_LOADED:2836,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_DECRYPT_BACKWARD_EDGE:2837,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_BACKWARD_EDGE_DECRYPTION_SUCCESS:2838,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_BACKWARD_EDGE_DERIVATION_FAIL:2839,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_BACKWARD_FAIL_TO_LOAD_SOURCE_EPOCH:2840,LABYRINTH_DERIVE_AND_STORE_EPOCHS_SPROC_FAILURE:2841,LABYRINTH_GET_OPEN_EPOCH_KEYS_SPROC:2842,LABYRINTH_GET_OPEN_EPOCH_KEYS_NO_EPOCHS_ON_CLIENT:2843,LABYRINTH_GET_OPEN_EPOCH_KEYS_GET_ALL_EPOCH_ANON_IDS:2844,LABYRINTH_GET_OPEN_EPOCH_KEYS_NUM_ANON_IDS:2845,LABYRINTH_GET_OPEN_EPOCHS_KEYS_EPOCH_ANON_ID_LIST_EMPTY:2846,LABYRINTH_GET_OPEN_EPOCH_KEYS_GET_KEYS_FOR_ANON_ID:2847,LABYRINTH_GET_OPEN_EPOCH_KEYS_ANON_ID_NOT_FOUND:2848,LABYRINTH_SYNC_EPOCHS_SPROC_DOWNLOAD_EPOCHS_V2_WRITE_TASK:2849,LABYRINTH_OPEN_EPOCH_SPROC_OPEN_INITIAL_EPOCH:2850,LABYRINTH_OPEN_EPOCH_SPROC_OPEN_EPOCH_WITH_LAST_EPOCH_METADATA:2851,LABYRINTH_OPEN_EPOCH_SPROC_OPEN_AFTER_FIRST_EPOCH:2852,LABYRINTH_OPEN_EPOCH_SPROC_FAILURE_LAST_EPOCH_NOT_FOUND:2853,LABYRINTH_OPEN_EPOCH_SPROC_ERROR:2854,LABYRINTH_PREPARE_OPEN_EPOCH_SPROC_CLOSE_LAST_EPOCH:2855,LABYRINTH_PREPARE_OPEN_EPOCH_SPROC_DERIVE_AND_STORE_EPOCH:2856,LABYRINTH_HANDLER_OPEN_EPOCH_SUCCESS_SPROC_DERIVE_AND_STORE:2857,LABYRINTH_HANDLER_OPEN_EPOCH_SUCCESS_SPROC_UPDATE_AUTHORITY:2858,LABYRINTH_HANDLER_OPEN_EPOCH_SUCCESS_SPROC_UPDATE_EPOCH_ID:2859,LABYRINTH_INCLUDE_FALLBACK_KEY_DURING_ENCRYPTION:2860,LABYRINTH_DERIVE_FALLBACK_KEY:2861,LABYRINTH_FAILED_TO_INCLUDE_FALLBACK_KEY:2862,LABYRINTH_GET_OPEN_EPOCH_KEYS_ANON_ID_VALUE:2863,LABYRINTH_GET_OPEN_EPOCH_KEYS_ANON_ID_NULL_VALUE:2864,LABYRINTH_MESSAGE_RESTORE_EPOCH_ANON_ID_NULL:2865,LABYRINTH_WEB_EPOCH_ROTATION_ENABLED:2866,LABYRINTH_WEB_EPOCH_ROTATION_DISABLED:2867,LABYRINTH_MOBILE_EPOCH_ROTATION_ENABLED:2868,LABYRINTH_MOBILE_EPOCH_ROTATION_DISABLED:2869,LABYRINTH_DECRYPT_MESSAGE_SPROC_SINGLE_EPOCH_KEY:2870,LABYRINTH_DECRYPT_MESSAGE_SPROC_EPOCH_NOT_FOUND_ERROR:2871,LABYRINTH_DECRYPT_MESSAGE_SPROC_MULTIPLE_EPOCHS_ERROR:2872,LABYRINTH_WEB_ECHO_MESSAGE_RESTORE_BEGIN:3600,LABYRINTH_WEB_ISSUE_RESTORE_JOB_DONE:3601,LABYRINTH_WEB_INSERT_TO_BAKCUP_MESSAGE_TABLE_DONE:3602,LABYRINTH_WEB_RESTORE_WITH_SERIALIZER_START:3603,LABYRINTH_WEB_ISSUE_RESTORE_JOB_STARTED:3604,LABYRINTH_WEB_INSERT_TO_RESTORE_PAYLOAD_CONTEXT_TABLE_DONE:3605,LABYRINTH_WEB_XMA_RESTORE_STARTED:3606,LABYRINTH_WEB_XMA_RESTORE_ENDED:3607,LABYRINTH_WEB_XMA_RESTORE_MEDIAID_NULL:3608,LABYRINTH_WEB_XMA_RESTORE_DBXMA_NULL:3609,LABYRINTH_WEB_ISSUE_MESSAGE_RANGE_QUERY:3610,LABYRINTH_WEB_ECHO_MESSAGE_UPLOAD_INVALID_REQUEST:3700,LABYRINTH_WEB_ECHO_MESSAGE_UPLOAD_BEGIN:3701,LABYRINTH_WEB_ECHO_MESSAGE_UPLOAD_FAILURE:3702,LABYRINTH_WEB_UPLOAD_THREAD_NOT_PRESENT:3703,LABYRINTH_WEB_UPLOAD_THREAD_PRESENT:3704,LABYRINTH_WEB_UPLOAD_GET_SENDER_INFO_UNSUCCESSFUL:3705,LABYRINTH_WEB_UPLOAD_GET_SENDER_INFO_SUCCESSFUL:3706,LABYRINTH_WEB_UPLOAD_CONTACT_NAME_NULL:3707,LABYRINTH_WEB_UPLOAD_CONTACT_NAME_NOT_NULL:3708,LABYRINTH_WEB_UPLOAD_GET_RECEIPT_STATUS_LIST_SUCCESSFUL:3709,LABYRINTH_WEB_UPLOAD_GET_SENDER_DISPLAY_NAME_FOR_QUOTED_MSG_NULL:3710,LABYRINTH_WEB_UPLOAD_GET_SENDER_DISPLAY_NAME_FOR_QUOTED_MSG_NOT_NULL:3711,LABYRINTH_WEB_UPLOAD_XMA_DATA_UPLOAD_SUCCESSFUL:3712,LABYRINTH_WEB_UPLOAD_XMA_DATA_UPLOAD_UNSUCCESSFUL:3713,LABYRINTH_WEB_UPLOAD_INVALID_MSG_TYPE_FOR_MEDIA_TYPE:3714,LABYRINTH_WEB_UPLOAD_IS_MEDIA_MSG_TRUE:3715,LABYRINTH_WEB_UPLOAD_IS_MEDIA_MSG_FALSE:3716,LABYRINTH_WEB_UPLOAD_UNSUPPORTED_MEDIA_TYPE:3717,LABYRINTH_WEB_UPLOAD_NO_MEDIA_ID_FOUND_IN_MEDIA_MSG:3718,LABYRINTH_WEB_UPLOAD_NO_MEDIA_ENTRY_FOR_MEDIA_ID:3719,LABYRINTH_WEB_UPLOAD_GET_REACTION_DATA_SUCCESSFUL:3720,LABYRINTH_WEB_UPLOAD_GET_QUOTE_MSG_SUCCESSFUL:3721,LABYRINTH_WEB_UPLOAD_GET_QUOTE_SENDER_NAME_SUCCESSFUL:3722,LABYRINTH_WEB_UPLOAD_FB_ID_NULL_FOR_XMA_MSG:3723,LABYRINTH_WEB_UPLOAD_GET_XMA_DATA_SUCCESSFUL:3724,LABYRINTH_WEB_UPLOAD_NO_XMA_DB_ENTRY_FOR_EXTERNAL_ID:3725,LABYRINTH_WEB_UPLOAD_ECHO_MESSAGE_CREATION_SUCCESSFUL:3726,LABYRINTH_WEB_UPLOAD_MISSING_MEDIA_DATA_FOR_MEDIA_MSG:3727,LABYRINTH_WEB_UPLOAD_INVOKE_MESSAGE_UPLOAD_SPROC:3728,LABYRINTH_WEB_UPLOAD_ISSUE_MESSAGE_UPLOAD_UI_EVENT:3729,LABYRINTH_WEB_UPLOAD_USER_DEVICE_NOT_ENROLLED:3730,LABYRINTH_WEB_GET_BACKUP_TENANCY:3731,LABYRINTH_WEB_UPLOAD_ERROR_OCCURRED_ON_ISSUE_MESSAGE_UPLOAD_UI_EVENT:3739,LABYRINTH_WEB_UPLOAD_XMA_NOT_FOUND_IN_IDB:3740,LABYRINTH_WEB_UPLOAD_MEDIA_NOT_FOUND_FOR_XMA_IN_IDB:3741,LABYRINTH_WEB_UPLOAD_INVALID_ECHO_MESSAGE_SERIALIZATION_RESPONSE:3742,LABYRINTH_WEB_UPLOAD_DUPLICATE_REQUEST:3743,LABYRINTH_WEB_RETROACTIVE_BACKUPS_START_UPLOAD_MSG:3744,LABYRINTH_WEB_RETROACTIVE_BACKUPS_START_UPLOAD_MEDIA:3745,LABYRINTH_WEB_RETROACTIVE_BACKUPS_UPLOAD_MSG_ERROR:3746,LABYRINTH_WEB_RETROACTIVE_BACKUPS_UPLOAD_MEDIA_ERROR:3747,LABYRINTH_WEB_UPLOAD_XMA_DATA_IS_NULL:3748,LABYRINTH_WEB_UPLOAD_REPLIED_MESSAGE_NOT_IN_DB:3749,LABYRINTH_WEB_UPLOAD_REPLIED_MESSAGE_IN_DB:3750,MQTT_STATE_DISCONNECTED_EVENT:10000001,MQTT_STATE_CONNECTED_EVENT:10000002,APP_STATEBACKGROUND:10000003,APP_STATEFOREGROUND:10000004,MQTT_STATE_CONNECTING_EVENT:10000005,GLOBAL_CONNECTIVITY_BANNER_DISPLAY:10000006,GLOBAL_CONNECTIVITY_BANNER_VANISH:10000007,SWITCH_ACCOUNT_EVENT:10000008,ADVANCED_CRYPTO_MEM_WA_CONNECTION_DISCONNECTED_EVENT:10001205,ADVANCED_CRYPTO_MEM_WA_CONNECTION_CONNECTING_EVENT:10001206,ADVANCED_CRYPTO_MEM_WA_CONNECTION_CONNECTED_EVENT:10001207});f["default"]=a}),66);
__d("LSShape",["LSDict"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("LSDict").fromObject(a)}function b(a){return c("LSDict").shapeToRecord(a)}g.ofRecord=a;g.toRecord=b}),98);
__d("LSDataTraceTag",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;e=4;var g=5,h=6,i=7,j=20,k=21,l=22,m=23,n=24,o=25,p=26,q=27,r=28,s=29,t=30,u=31,v=32,w=33,x=34,y=35,z=36,A=37,B=38,C=39,D=40,E=41,F=42;f.none=a;f.sticker=b;f.image=c;f.animatedImage=d;f.video=e;f.audio=g;f.file=h;f.xma=i;f.messageTypeNone=j;f.messageTypeText=k;f.messageTypeFutureproof=l;f.messageTypeCiphertext=m;f.messageTypeUnavailable=n;f.messageTypeImage=o;f.messageTypeVideo=p;f.messageTypePtt=q;f.messageTypeAdmin=r;f.messageTypeRevoked=s;f.messageTypeGif=t;f.messageTypeSticker=u;f.messageTypeExpiredEphemeral=v;f.messageTypeEphemeralSettingAdmin=w;f.messageTypeEphemeralSyncResponse=x;f.messageTypeEphemeralScreenshotAction=y;f.messageTypeDeleteForMe=z;f.messageTypeEphemeralSettingChangeFromCurrentDevice=A;f.messageTypeAlertICDC=B;f.messageTypeGroupInvite=C;f.messageTypeXMA=D;f.messageTypeReaction=E;f.messageTypeSenderKeyDistribution=F}),66);
__d("LSRequestId",["uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h="0123456789abcdef",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function a(){var a=c("uuidv4")().replace(/[^0-9a-f]/gi,""),b=0,d=["#"];while(b<33){var e=h.indexOf(a.charAt(b))<<8,f=h.indexOf(a.charAt(b+1))<<4,g=h.indexOf(a.charAt(b+2));g=g|(f|e);f=g>>6;d.push(i.charAt(f));d.push(i.charAt(g&63));b+=3}return d.join("")}b={generate:a};g["default"]=b}),98);
__d("MAWBridgeTrace",["WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g,h,i){var j=a.ack,k=a.externalId,l=a.ts;a=a.type;var m=d("WAJids").switchOnMsgrChatJidType(b,{group:function(a){return"Group"},user:function(a){return"User"}});return{ack:j,externalId:k,isFirstMsg:!!f,openMessageOtid:e,openMessageParticipantCount:g,participantCount:h,threadJid:b,threadKey:i,threadType:m,traceType:c,ts:l,type_:a}}function b(a,b,c){return{traceContext:c,traceId:b,traceType:a}}function c(a,b,c,d){return{errorMessage:d,event:b,externalIds:a,traceType:c}}function e(a,b,c,d,e,f){return{checkPointId:a,dataTraceId:b,errorMessage:c,shouldFlush:d,syncChannel:e,tags:f}}g.createBridgeStartTraceData=a;g.createBridgeStartTraceWithTraceIdData=b;g.createBridgeUpdateTraceData=c;g.createBridgeTraceRecordCheckpointData=e}),98);
__d("WAMsgType",[],(function(a,b,c,d,e,f){"use strict";a="Text";b="Futureproof";c="Ciphertext";d="Unavailable";e="Image";var g="Video",h="Ptt",i="Admin",j="Revoked",k="Gif",l="Sticker",m="DocumentFile",n="ExpiredEphemeral",o="EphemeralSettingAdmin",p="EphemeralSyncResponse",q="DeleteForMe",r="EphemeralSettingChangeFromCurrentDevice",s="AlertICDC",t="GroupInvite",u="NoteReply",v="Reaction",w="SenderKeyDistribution",x="EditAction",y="ReceiverFetch",z="Raven",A="GroupPollCreate",B="GroupPollUpdate",C={ADMIN:i,CIPHERTEXT:c,DELETE_FOR_ME:q,DOCUMENT_FILE:m,EDIT_ACTION:x,EPHEMERAL_SETTING_ADMIN:o,EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:r,EPHEMERAL_SYNC_RESPONSE:p,EXPIRED_EPHEMERAL:n,FUTUREPROOF:b,GIF:k,GROUP_INVITE:t,ICDC_ALERT:s,IMAGE:e,PTT:h,REACTION:v,REVOKED:j,SK_DISTRIBUTION:w,STICKER:l,TEXT:a,UNAVAILABLE:d,VIDEO:g,RECEIVER_FETCH:y,RAVEN:z,GROUP_POLL_CREATE:A,GROUP_POLL_UPDATE:B,NOTE_REPLY:u};f.TEXT=a;f.FUTUREPROOF=b;f.CIPHERTEXT=c;f.UNAVAILABLE=d;f.IMAGE=e;f.VIDEO=g;f.PTT=h;f.ADMIN=i;f.REVOKED=j;f.GIF=k;f.STICKER=l;f.DOCUMENT_FILE=m;f.EXPIRED_EPHEMERAL=n;f.EPHEMERAL_SETTING_ADMIN=o;f.EPHEMERAL_SYNC_RESPONSE=p;f.DELETE_FOR_ME=q;f.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE=r;f.ICDC_ALERT=s;f.GROUP_INVITE=t;f.NOTE_REPLY=u;f.REACTION=v;f.SK_DISTRIBUTION=w;f.EDIT_ACTION=x;f.RECEIVER_FETCH=y;f.RAVEN=z;f.GROUP_POLL_CREATE=A;f.GROUP_POLL_UPDATE=B;f.MSG_TYPE=C}),66);
__d("MAWMsgType",["WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return k.has(a)};var h=function(a){return l.has(a)||k.has(a)};b=function(a){return h(a)||m.has(a)};c="EphemeralScreenshotAction";e="Raven";f="RavenAction";var i="XMA",j="BumpExistingMessage";d=babelHelpers["extends"]({},d("WAMsgType").MSG_TYPE,{BUMP_EXISTING_MESSAGE:j,EPHEMERAL_SCREENSHOT_ACTION:c,RAVEN:e,RAVEN_ACTION:f,XMA:i});var k=new Set([d.IMAGE,d.VIDEO,d.PTT,d.GIF,d.STICKER,d.XMA,d.RAVEN,d.DOCUMENT_FILE,d.RECEIVER_FETCH]),l=new Set([d.TEXT,d.REVOKED,d.XMA,d.BUMP_EXISTING_MESSAGE,d.GROUP_POLL_CREATE]),m=new Set([d.FUTUREPROOF]),n=new Set([d.TEXT,d.IMAGE,d.VIDEO,d.PTT,d.GIF,d.STICKER,d.DOCUMENT_FILE,d.UNAVAILABLE,d.EXPIRED_EPHEMERAL,d.REVOKED,d.XMA,d.RAVEN,d.RECEIVER_FETCH]);j=function(a){return n.has(a)};g.isMAWSupportedMediaType=a;g.isEBSupportedMsgType=h;g.isProtobufUploadSupportedMsgType=b;g.EPHEMERAL_SCREENSHOT_ACTION=c;g.MSG_TYPE=d;g.mawSupportedMediaTypes=k;g.isQuotedMsgType=j}),98);
__d("MAWTraceUtils",["EBGating","LSDataTraceCheckPoint","LSDataTraceTag","LSIntEnum","LSRequestId","MAWBridge","MAWBridgeTrace","MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";var h,i="backup_upload",j="media_backup",k="vesta_registration",l="vesta_login";function m(){return c("LSRequestId").generate()}function a(a){return a}function b(a,b,c){c=c!=null?c:m();d("EBGating").isRemoveLSDataTrace()||d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"StartTraceWithTraceId",value:d("MAWBridgeTrace").createBridgeStartTraceWithTraceIdData(a,c,b)}]},!0);return c}function n(a,b,c,e,f){if(d("EBGating").isRemoveLSDataTrace())return;if(a!=null){c=c.length>0?c.map(function(a){return a.toString()}).join(","):void 0;d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"TraceRecordCheckpoint",value:d("MAWBridgeTrace").createBridgeTraceRecordCheckpointData(b,a,f,e,-1,c)}]},!0)}}function e(a,b,e,f){n(a,b,e,!1),n(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),e,!0,f)}function f(a,b,e){n(a,b,e,!1),n(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH),e,!0)}function o(a,b,e){n(a,b,e,!1),n(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH),e,!0)}function p(a){switch(a){case d("MAWMsgType").MSG_TYPE.TEXT:return d("LSDataTraceTag").messageTypeText;case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return d("LSDataTraceTag").messageTypeFutureproof;case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return d("LSDataTraceTag").messageTypeCiphertext;case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:return d("LSDataTraceTag").messageTypeUnavailable;case d("MAWMsgType").MSG_TYPE.IMAGE:return d("LSDataTraceTag").messageTypeImage;case d("MAWMsgType").MSG_TYPE.VIDEO:return d("LSDataTraceTag").messageTypeVideo;case d("MAWMsgType").MSG_TYPE.PTT:return d("LSDataTraceTag").messageTypePtt;case d("MAWMsgType").MSG_TYPE.ADMIN:return d("LSDataTraceTag").messageTypeAdmin;case d("MAWMsgType").MSG_TYPE.REVOKED:return d("LSDataTraceTag").messageTypeRevoked;case d("MAWMsgType").MSG_TYPE.GIF:return d("LSDataTraceTag").messageTypeGif;case d("MAWMsgType").MSG_TYPE.STICKER:return d("LSDataTraceTag").messageTypeSticker;case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return d("LSDataTraceTag").messageTypeExpiredEphemeral;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return d("LSDataTraceTag").messageTypeEphemeralSettingAdmin;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:return d("LSDataTraceTag").messageTypeEphemeralSyncResponse;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return d("LSDataTraceTag").messageTypeEphemeralScreenshotAction;case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:return d("LSDataTraceTag").messageTypeDeleteForMe;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:return d("LSDataTraceTag").messageTypeEphemeralSettingChangeFromCurrentDevice;case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:return d("LSDataTraceTag").messageTypeAlertICDC;case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:return d("LSDataTraceTag").messageTypeGroupInvite;case d("MAWMsgType").MSG_TYPE.XMA:return d("LSDataTraceTag").messageTypeXMA;case d("MAWMsgType").MSG_TYPE.REACTION:return d("LSDataTraceTag").messageTypeReaction;case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:return d("LSDataTraceTag").messageTypeSenderKeyDistribution;default:return d("LSDataTraceTag").messageTypeNone}}g.CONTEXT_BACKUP_UPLOAD=i;g.CONTEXT_MEDIA_BACKUP=j;g.CONTEXT_VESTA_REGISTRATION=k;g.CONTEXT_VESTA_LOGIN=l;g.createTraceId=m;g.stringToTraceId=a;g.startNewTrace=b;g.recordCheckpointForTrace=n;g.recordFailureAndFlushForTraceId=e;g.recordSuccessAndFlushForTraceId=f;g.recordInvalidUploadRequestAndFlushTrace=o;g.getTagForMsgType=p}),98);
__d("MAWEncryptedBackupUtils",["FBLogger","I64","LSAuthorityLevel","LSDataTraceCheckPoint","LSDict","LSIntEnum","LSShape","LSVec","MAWTraceUtils","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,c,e,f){d("MAWTraceUtils").recordCheckpointForTrace(a,b,c,e,f)}function a(a,b,e){j(b,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_GET_BACKUP_TENANCY),[],!1);return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.secure_encrypted_backups_client_state)).then(function(a){return k(a,e)})}function k(a,b){var e;if(a==null){b!=null&&b.addPoint("get_backup_tenancy_null_client_state_row");return}e=(e=a.backupTenancy)!=null?e:(i||(i=d("I64"))).one;a=a.authorityLevel;b!=null&&b.addPoint("get_backup_tenancy",{"int":{authorityLevel:(i||(i=d("I64"))).to_int32(a!=null?a:(i||(i=d("I64"))).zero),backupTenancy:i.to_int32(e!=null?e:(i||(i=d("I64"))).zero)}});if(e!=null&&(i||(i=d("I64"))).equal((h||(h=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),a))return e}function b(a,b){var d=new Set(),e=a.length;for(a of a.entries()){var f=a[0],g=a[1];d.has(g)&&c("FBLogger")("wmi_eb").warn("Duplicate messages returned from server for restoreType: %s, index: %s of batchSize: %s",b,f,e);d.add(g)}}function e(a){a=a.map(function(a){var b=a.toplevelProtobuf;b=d("LSShape").ofRecord({decrypted_protobuf:b.decryptedProtobuf,protobuf_timestamp_ms:(i||(i=d("I64"))).of_float(b.protobufTimestampMS)});var e=new(c("LSDict"))();a.supplementalProtobufs.forEach(function(a,b){e.set(b,d("LSShape").ofRecord({decrypted_protobuf:a.decryptedProtobuf,protobuf_timestamp_ms:(i||(i=d("I64"))).of_float(a.protobufTimestampMS)}))});return d("LSShape").ofRecord({otid:a.otid,supplemental_protobufs:e,toplevel_protobuf:b})});return c("LSVec").ofArray(a)}function f(a){a=c("LSVec").toArray(a);a=a.map(function(a){return d("LSShape").toRecord(a)});return a.map(function(a){var b=d("LSShape").toRecord(a.toplevel_protobuf);b={decryptedProtobuf:b.decrypted_protobuf,protobufTimestampMS:(i||(i=d("I64"))).to_float(b.protobuf_timestamp_ms)};var c=new Map(),e=a.supplemental_protobufs;e.forEach(function(a,b){a=d("LSShape").toRecord(a);c.set(b,{decryptedProtobuf:a.decrypted_protobuf,protobufTimestampMS:(i||(i=d("I64"))).to_float(a.protobuf_timestamp_ms)})});return{otid:a.otid,supplementalProtobufs:c,toplevelProtobuf:b}})}g.getBackupTenancy=a;g.getBackupTenancyFromClientStateRow=k;g.logIfDuplicateMessagesFoundInRestore=b;g.convertJSTypesToLSTypesForRestoreJob=e;g.convertLSTypesToJSTypesForRestoreJob=f}),98);
__d("EBIsEbEnabled",["EBDeps","FBLogger","I64","LSEncryptedBackupsBackupTenancy","LSIntEnum","MAWEBSwitch","MAWEncryptedBackupUtils","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,e){return d("MAWEncryptedBackupUtils").getBackupTenancy(a,b,e).then(function(a){return a!=null&&(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))})}function a(){try{return d("WAResultOrError").makeResult(c("MAWEBSwitch").isEnabled())}catch(a){c("FBLogger")("wmi_eb").catching(a).mustfix("Failed to check EB enabled");return d("WAResultOrError").makeResult(!1)}}async function b(){var a=await d("EBDeps").getDeps().getLSDB();return j(a.tables)}g.isEbEnabledLS=j;g.isEbEnabledEbSwitch=a;g.isEBEnabled=b}),98);
__d("EBIsEbEnabledSubscriber",["EBDeps","EBIsEbEnabled","I64","LSEncryptedBackupsBackupTenancy","LSIntEnum","ReQL","WAPubSub"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(){function a(a){this.$1=d("WAPubSub").simplePubSub(),this.$4=a,this.$2=!1}var b=a.prototype;b.initialize=async function(){this.$2=await d("EBIsEbEnabled").isEbEnabledLS(this.$4.tables),this.$5(this.$4)};b.$6=function(a){this.$2=a,this.$1.publish(a)};b.$5=function(a){var b=this;this.$3==null&&(this.$3=d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state).take(1).subscribe(function(a,e){e.operation==="delete"&&b.$6(!1),(e.operation==="add"||e.operation==="put")&&(e.value.backupTenancy!=null&&(h||(h=d("I64"))).equal(e.value.backupTenancy,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))?b.$6(!0):b.$6(!1))}));return this.$3};b.subscribe=function(a){return this.$1.subscribe(a)};b.isEnabled=function(){return this.$2};return a}(),k;async function l(a){if(k!=null)return Promise.resolve();k=new j(a);await k.initialize()}async function a(){if(k==null){var a=await d("EBDeps").getDeps().getLSDB();await l(a)}return k}async function b(a){if(k==null){var b=await d("EBDeps").getDeps().getLSDB();await l(b)}a(k.isEnabled());b=k.subscribe(a);return b}async function e(){if(k==null){var a=await d("EBDeps").getDeps().getLSDB();await l(a)}return k.isEnabled()}g.initIsEbEnabledPubSub=l;g.isEbEnabledSubscriber=a;g.subscribeToEbChanges=b;g.isEBEnabledValueFromSubscriber=e}),98);
__d("EBMarkerIdToQPLEvent",["I64","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a=(h||(h=d("I64"))).to_int32(a);switch(a){case 1021646192:return c("qpl")._(1021646192,"3099");case 1021656232:return c("qpl")._(1021656232,"3100");case 1021647318:return c("qpl")._(1021647318,"3101");case 1021651622:return c("qpl")._(1021651622,"3102");case 1021655799:return c("qpl")._(1021655799,"3103");case 1021648929:return c("qpl")._(1021648929,"3104");case 1021647593:return c("qpl")._(1021647593,"3105");case 1021653744:return c("qpl")._(1021653744,"3106");case 1021655355:return c("qpl")._(1021655355,"3107");case 1021648240:return c("qpl")._(1021648240,"3108");case 1021651939:return c("qpl")._(1021651939,"3109");case 1021656851:return c("qpl")._(1021656851,"3110");case 1021652813:return c("qpl")._(1021652813,"3111");case 1021653501:return c("qpl")._(1021653501,"3112");case 1021655710:return c("qpl")._(1021655710,"3114");case 1021655643:return c("qpl")._(1021655643,"3115");case 1021646076:return c("qpl")._(1021646076,"3116");case 1021642512:return c("qpl")._(1021642512,"3117");case 1021654781:return c("qpl")._(1021654781,"3118");case 1021649468:return c("qpl")._(1021649468,"3120");case 1021652080:return c("qpl")._(1021652080,"3121");case 1021652512:return c("qpl")._(1021652512,"3122");case 1021655828:return c("qpl")._(1021655828,"3124");case 1021642298:return c("qpl")._(1021642298,"3126");case 1021652377:return c("qpl")._(1021652377,"3127");case 521471316:return c("qpl")._(521471316,"2831");case 521478596:return c("qpl")._(521478596,"1329");case 521479468:return c("qpl")._(521479468,"3128");case 521473151:return c("qpl")._(521473151,"2593");case 521482563:return c("qpl")._(521482563,"3129");case 521482912:return c("qpl")._(521482912,"3131");case 521481876:return c("qpl")._(521481876,"1407");case 521471732:return c("qpl")._(521471732,"1454");case 521477507:return c("qpl")._(521477507,"1406");case 521478817:return c("qpl")._(521478817,"2806");case 521476801:return c("qpl")._(521476801,"3132");case 521484724:return c("qpl")._(521484724,"141");case 521473756:return c("qpl")._(521473756,"2768");case 521477113:return c("qpl")._(521477113,"2698");case 521478750:return c("qpl")._(521478750,"2850");case 521479165:return c("qpl")._(521479165,"3055");case 521484370:return c("qpl")._(521484370,"2995");case 521473213:return c("qpl")._(521473213,"27");case 521482281:return c("qpl")._(521482281,"2703");case 521476771:return c("qpl")._(521476771,"2454");case 521474469:return c("qpl")._(521474469,"2612");case 521471755:return c("qpl")._(521471755,"2586");case 521476367:return c("qpl")._(521476367,"2704");case 521473850:return c("qpl")._(521473850,"2910");case 521482558:return c("qpl")._(521482558,"2558");case 521482880:return c("qpl")._(521482880,"16");case 521473150:return c("qpl")._(521473150,"2143");case 521473369:return c("qpl")._(521473369,"2834");case 521485893:return c("qpl")._(521485893,"2835");case 521473922:return c("qpl")._(521473922,"2832");case 521479146:return c("qpl")._(521479146,"3133");case 521471468:return c("qpl")._(521471468,"2968");case 521480391:return c("qpl")._(521480391,"1167");case 521480745:return c("qpl")._(521480745,"3134");case 521481602:return c("qpl")._(521481602,"829");case 521475102:return c("qpl")._(521475102,"3135");case 521484676:return c("qpl")._(521484676,"2684");case 521485625:return c("qpl")._(521485625,"1876");case 521482085:return c("qpl")._(521482085,"409");case 521471024:return c("qpl")._(521471024,"2275");case 521474385:return c("qpl")._(521474385,"263");case 521479842:return c("qpl")._(521479842,"2163");case 521485383:return c("qpl")._(521485383,"2200");case 521478580:return c("qpl")._(521478580,"3136");case 521485815:return c("qpl")._(521485815,"3137");case 521482969:return c("qpl")._(521482969,"1519");case 521485406:return c("qpl")._(521485406,"272");case 521479972:return c("qpl")._(521479972,"3138");case 521474688:return c("qpl")._(521474688,"2714");case 521484777:return c("qpl")._(521484777,"2715");case 521483076:return c("qpl")._(521483076,"3140");case 521482858:return c("qpl")._(521482858,"1290");case 521472542:return c("qpl")._(521472542,"295");case 521472456:return c("qpl")._(521472456,"1646");case 521476140:return c("qpl")._(521476140,"378");case 521473194:return c("qpl")._(521473194,"1331");case 521482763:return c("qpl")._(521482763,"296");case 521484295:return c("qpl")._(521484295,"1460");case 521476165:return c("qpl")._(521476165,"2432");case 521477947:return c("qpl")._(521477947,"2395");case 521486220:return c("qpl")._(521486220,"827");case 521482576:return c("qpl")._(521482576,"1069");case 521479124:return c("qpl")._(521479124,"1939");case 521476098:return c("qpl")._(521476098,"504");case 521472095:return c("qpl")._(521472095,"2859")}return null}g.markerIdToQPLEvent=a}),98);
__d("EncryptedBackupUploadFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5728");b=d("FalcoLoggerInternal").create("encrypted_backup_upload_failure",a);e=b;g["default"]=e}),98);
__d("InstagramMediaProductTypeName",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({LIVE:"live",FEED:"feed",STORY:"story",DIRECT:"direct",IGTV:"igtv",NAMETAG:"nametag",DIRECT_AUDIO:"direct_audio",CAROUSEL_ITEM:"carousel_item",CAROUSEL_CONTAINER:"carousel_container",PROFILE_PIC:"profile_pic",AD:"ad",AR_EFFECT_PREVIEW:"ar_effect_preview",DIRECT_PERMANENT:"direct_permanent",SELFIE_STICKER:"selfie_sticker",COWATCH_LOCAL:"cowatch_local",CLIPS:"clips",GUIDE_MEDIA_FACADE:"guide_media_facade",FUNDRAISER_COVER:"fundraiser_cover",LIVE_ARCHIVE:"live_archive",HIGHLIGHT_POST_FACADE:"highlight_post_facade",DIRECT_THREAD:"direct_thread",SCHEDULED_LIVE:"scheduled_live",RATINGS_AND_REVIEWS:"ratings_and_reviews",DIRECT_HEADMOJI:"direct_headmoji",CLIPS_PREVIEW:"clips_preview",REPOST_MEDIA_FACADE:"repost_media_facade",STORY_INTERACTION_RESPONSE:"story_interaction_response",MEDIA_KIT:"media_kit",TEXT_POST:"text_post",NOTE_AUDIO:"note_audio",DIRECT_MESSAGE_COMMENT_FACADE:"direct_message_comment_facade"});c=a;f["default"]=c}),66);
__d("IGDThreadTTLCUtils",["IGDInstamadilloUtils","InstagramMediaProductTypeName","LSThreadBitOffset","ZenonRTWebBrowserFeatureSupport","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h=[225,235,226,227,228,229,230,231,232,233,234,236];function i(a,b){if(a==null||d("IGDInstamadilloUtils").isIGDDisappearingModeEnabled(a))return!1;return!c("qex")._("954")?!1:d("LSThreadBitOffset").has(b,a)}function j(a){return i(a,225)}function k(a){if(!c("gkx")("2400"))return!1;return!d("ZenonRTWebBrowserFeatureSupport").isInsertableStreamsSupported()?!1:i(a,235)}function l(a){return i(a,226)}function m(a){return i(a,227)}function n(a){return i(a,228)}function o(a){return i(a,229)}function p(a){return i(a,230)}function q(a){return i(a,231)}function r(a){return i(a,232)}function s(a){return i(a,233)}function t(a){return i(a,234)}function u(a){return i(a,236)}function v(a){return a==null||d("IGDInstamadilloUtils").isIGDDisappearingModeEnabled(a)||!c("qex")._("954")?!1:w(a)}function w(a){return a==null?!1:h.some(function(b){return d("LSThreadBitOffset").has(b,a)})}function a(a,b){var d=a.isDisappearingModeSettingOn,e=a.isTTLCClipEnabled,f=a.isTTLCGenericXMAShareEnabled,g=a.isTTLCMediaShareEnabled;a=a.isTTLCStoryShareEnabled;b=c("InstagramMediaProductTypeName").cast(b);if(b==null||d)return!1;if(!c("qex")._("954"))return!1;switch(b){case"feed":case"carousel_container":case"ad":return g;case"clips":return e;case"story":return a;case"live":return f;default:return!1}}function b(a){return new Map([["Text",j(a)],["Clip",l(a)],["Reel Share",m(a)],["Media Share",n(a)],["Story Share",o(a)],["Link",p(a)],["Generic XMA",q(a)],["Profile",u(a)],["Image",r(a)],["Video",s(a)],["Audio",t(a)],["Gif/Sticker/Avatar",void 0],["Raven",void 0],["Media Collection",void 0],["Calling",k(a)],["Rest of Message Types",void 0]])}function e(a){return{is_instamadillo_ttlc:String(v(a)),is_instamadillo_ttlc_audio:String(t(a)),is_instamadillo_ttlc_clip:String(l(a)),is_instamadillo_ttlc_generic_xma:String(q(a)),is_instamadillo_ttlc_image:String(r(a)),is_instamadillo_ttlc_link:String(p(a)),is_instamadillo_ttlc_media_share:String(n(a)),is_instamadillo_ttlc_profile:String(u(a)),is_instamadillo_ttlc_reel_share:String(m(a)),is_instamadillo_ttlc_story_share:String(o(a)),is_instamadillo_ttlc_text:String(j(a)),is_instamadillo_ttlc_video:String(s(a))}}function f(a){return{is_instamadillo_ttlc:v(a),is_instamadillo_ttlc_audio:t(a),is_instamadillo_ttlc_clip:l(a),is_instamadillo_ttlc_generic_xma:q(a),is_instamadillo_ttlc_image:r(a),is_instamadillo_ttlc_link:p(a),is_instamadillo_ttlc_media_share:n(a),is_instamadillo_ttlc_profile:u(a),is_instamadillo_ttlc_reel_share:m(a),is_instamadillo_ttlc_story_share:o(a),is_instamadillo_ttlc_text:j(a),is_instamadillo_ttlc_video:s(a)}}function x(a,b){if(a==null)return!1;switch(a.__typename){case"XMSGIgReceiverFetchXmaFeedFetchParams":return n(b);case"XMSGIgReceiverFetchXmaProfileFetchParams":return q(b);case"XMSGIgReceiverFetchXmaClipFetchParams":return l(b);default:return!1}}function y(a){return a==null?!1:d("LSThreadBitOffset").has(261,a)}g.isInstamadilloTTLCTextEnabled=j;g.isInstamadilloTTLCCallingEnabled=k;g.isInstamadilloTTLCClipEnabled=l;g.isInstamadilloTTLCReelShareEnabled=m;g.isInstamadilloTTLCMediaShareEnabled=n;g.isInstamadilloTTLCStoryShareEnabled=o;g.isInstamadilloTTLCLinkEnabled=p;g.isInstamadilloTTLCGenericXmaEnabled=q;g.isInstamadilloTTLCImageEnabled=r;g.isInstamadilloTTLCVideoEnabled=s;g.isInstamadilloTTLCAudioEnabled=t;g.isInstamadilloTTLCProfileEnabled=u;g.isIGDTTLCEnabledForThread=v;g.threadHasInstamadilloTTLCCapability=w;g.isIGDTTLCEnabledForIGDCandidate=a;g.getTtlcMessageTypeMap=b;g.getTTLCLoggingExtraData=e;g.getTTLCBooleanAnnotations=f;g.isXmaReceiverFetchTTLCEnabled=x;g.isInstamadilloOptionalE2EE=y}),98);
__d("IGDInstamadilloUtils",["ExecutionEnvironment","IGDThreadTTLCUtils","LSThreadBitOffset","gkx","isInstamadillo","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return(a==null?void 0:a.transportKey)==="Instamadillo"}function j(a){return a==null?!1:d("LSThreadBitOffset").has(214,a)}function a(a){return a==null?!1:d("LSThreadBitOffset").has(212,a)}function k(a){return a==null?!1:d("LSThreadBitOffset").has(38,a)}function b(a){return a==null?!1:d("LSThreadBitOffset").has(211,a)}function e(a){var b=j(a);a=l(a);return a||b}function l(a){if(c("gkx")("6650"))return!1;var b=k(a),e=j(a);a=d("IGDThreadTTLCUtils").threadHasInstamadilloTTLCCapability(a);return b&&(e||a)}function f(a,b){a=i(a)&&a.ephemeralExpirationTs!=null;return b&&a||!b&&!a}function m(a){a=i(a);return!a?!0:c("isInstamadillo")()}var n=function(){var a={browser:(h||(h=c("ExecutionEnvironment"))).isInBrowser,isLegacyArmadilloTLC:c("qex")._("121")===!0,isMobileDM:c("gkx")("2553"),isMobileInstamadilloTLC:c("gkx")("2322"),isMobileOrWebTTLC:c("gkx")("2406"),isWebTTLC:c("qex")._("954")===!0,sharedWorker:h.isInSharedWorker,worker:h.isInWorker},b="";for(a of Object.entries(a)){var d=a[0],e=a[1];b+=d+": "+String(e)+"\n"}return b};g.isInstamadilloMessage=i;g.isInstamadilloCutover=j;g.isInstamadilloDMToggleEnabled=a;g.isIGDDisappearingModeEnabled=k;g.isInstamadilloTransportEnabled=b;g.isInstamadilloHardblockEnabled=e;g.isDMHardblockedEnabled=l;g.shouldRenderMessageReply=f;g.canMutateIGDMessage=m;g.getE2EEGatingStateAsString=n}),98);
__d("IGDRouteProvider.react",["react","react-compiler-runtime","useCurrentRoute"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));e=h;f=e.createContext;var j=e.useContext;function k(a){var b;a=a==null||(b=a.params)==null?void 0:b.thread_key;return a!=null&&typeof a==="string"?a:null}var l=f();function a(a){var b=d("react-compiler-runtime").c(5);a=a.children;var e=c("useCurrentRoute")(),f;b[0]!==e?(f=k(e),b[0]=e,b[1]=f):f=b[1];e=f;b[2]!==a||b[3]!==e?(f=i.jsx(l.Provider,{value:e,children:a}),b[2]=a,b[3]=e,b[4]=f):f=b[4];return f}function b(){return j(l)}g.IGDRouteContextProvider=a;g.useThreadKeyFromCurrentRoute=b}),98);
__d("IGDInteractionTraceAnnotations",["I64","IGDInstamadilloUtils","IGDRouteProvider.react","IGDThreadTTLCUtils","Int64Hooks","InteractionTracing","LSIntEnum","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(h||d("react")).useEffect;function a(a){return babelHelpers["extends"]({},d("IGDThreadTTLCUtils").getTTLCBooleanAnnotations(a),{is_dm:d("IGDInstamadilloUtils").isIGDDisappearingModeEnabled(a),is_instamadillo:d("IGDInstamadilloUtils").isInstamadilloTransportEnabled(a),is_instamadillo_tlc:d("IGDInstamadilloUtils").isInstamadilloCutover(a)})}function l(a,b){var c=d("IGDInstamadilloUtils").isInstamadilloCutover(a),e=d("IGDInstamadilloUtils").isInstamadilloTransportEnabled(a),f=d("IGDInstamadilloUtils").isIGDDisappearingModeEnabled(a);b.addAnnotationBoolean("is_instamadillo",e);b.addAnnotationBoolean("is_instamadillo_tlc",c);b.addAnnotationBoolean("is_dm",f);b.addAnnotationBoolean("is_instamadillo_ttlc",(e=d("IGDThreadTTLCUtils")).isIGDTTLCEnabledForThread(a));b.addAnnotationBoolean("is_instamadillo_ttlc_audio",e.isInstamadilloTTLCAudioEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_clip",e.isInstamadilloTTLCClipEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_generic_xma",e.isInstamadilloTTLCGenericXmaEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_image",e.isInstamadilloTTLCImageEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_link",e.isInstamadilloTTLCLinkEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_media_share",e.isInstamadilloTTLCMediaShareEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_profile",e.isInstamadilloTTLCProfileEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_reel_share",e.isInstamadilloTTLCReelShareEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_story_share",e.isInstamadilloTTLCStoryShareEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_text",e.isInstamadilloTTLCTextEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_video",e.isInstamadilloTTLCVideoEnabled(a))}function b(a){var b=d("react-compiler-runtime").c(3),e,f;b[0]!==a?(e=function(){c("InteractionTracing").getPendingInteractions().forEach(function(b){l(a,b)})},f=[a],b[0]=a,b[1]=e,b[2]=f):(e=b[1],f=b[2]);d("Int64Hooks").useEffectInt64(e,f)}var m=new Set();function e(a){var b=d("react-compiler-runtime").c(7),e;b[0]!==a.consistentThreadFbid||b[1]!==a.threadKey||b[2]!==a.threadSubtype||b[3]!==a.threadType?(e=function(){var b=(i||(i=d("I64"))).to_string(a.threadKey);c("InteractionTracing").getPendingInteractions().forEach(function(c){var e=m.has(b);c.addAnnotationBoolean("is_thread_visited",e);c.addAnnotation("thread_key",(i||(i=d("I64"))).to_string(a.threadKey));a.consistentThreadFbid!=null&&c.addAnnotation("consistent_thread_fbid",(i||(i=d("I64"))).to_string(a.consistentThreadFbid));c.addAnnotationInt("thread_type",(j||(j=d("LSIntEnum"))).toNumber(a.threadType));a.threadSubtype!=null&&c.addAnnotation("thread_subtype",(i||(i=d("I64"))).to_string(a.threadSubtype))});return function(){m.add(b)}},b[0]=a.consistentThreadFbid,b[1]=a.threadKey,b[2]=a.threadSubtype,b[3]=a.threadType,b[4]=e):e=b[4];var f;b[5]!==a?(f=[a],b[5]=a,b[6]=f):f=b[6];d("Int64Hooks").useEffectInt64(e,f)}function f(){var a=d("react-compiler-runtime").c(3),b=d("IGDRouteProvider.react").useThreadKeyFromCurrentRoute(),e,f;a[0]!==b?(e=function(){c("InteractionTracing").getPendingInteractions().forEach(function(a){if(b==null){a.addAnnotationInt("rendered_direct_null_state",1);a.addAnnotationInt("has_thread_key",0);return}a.addAnnotationInt("has_thread_key",1);a.addAnnotationInt("rendered_direct_null_state",0)})},f=[b],a[0]=b,a[1]=e,a[2]=f):(e=a[1],f=a[2]);k(e,f)}g.getInstamadilloBooleanAnnotations=a;g.addInstamadilloAnnotationsToInteractionTrace=l;g.useAddInstamadilloAnnotationsToInteractionTraces=b;g.useAddThreadAnnotationToInteractionTraces=e;g.useAddThreadRouteAnnotations=f}),98);
__d("LSResult",[],(function(a,b,c,d,e,f){"use strict";function a(a){return[a]}f["default"]=a}),66);
__d("LSBase64Encode.nop",["EBBase64Encode","LSResult","LSSynchronousPromise"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,e){return d("LSSynchronousPromise").makeSynchronousPromise(c("LSResult")(e?c("EBBase64Encode")(e):void 0))};a.__nop_name__="LSBase64Encode";g["default"]=a}),98);
__d("LSCheckIfAuthoritativeThreadMissingMiActMapping",["gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,b=a[a.length-1],d=[],e=[];return b.sequence([function(f){return b.sequence([function(e){return c("gkx")("4792")?b.sequence([function(c){return b.db.table(173).fetch([[[a[0]]]]).next().then(function(c,e){e=c.done;c=c.value;return e?b.sequence([function(c){return b.db.table(9).fetch([[[a[0]]]]).next().then(function(a,c){var e=a.done;a=a.value;return e?d[3]=!1:(c=a.item,d[3]=b.i64.eq(c.authorityLevel,b.i64.cast([0,80])))})},function(a){return d[1]=d[3]}]):(c.item,d[1]=!1)})},function(a){return d[0]=d[1]}]):b.resolve(d[0]=!1)},function(a){return e[0]=d[0]}])},function(a){return b.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxCheckIfAuthoritativeThreadMissingMiActMappingStoredProcedure";a.__tables__=["mi_act_mapping_table","threads"];b=a;g["default"]=b}),98);
__d("LSContactUserBlockAction",[],(function(a,b,c,d,e,f){a=Object.freeze({MN_UNBLOCK:0,MN_BLOCK:1,FB_UNBLOCK:2,FB_BLOCK:3});f["default"]=a}),66);
__d("LSCreateOfflineThreadingID",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return c[0]=b.i64.random(),d[0]=b.i64.and_(b.i64.or_(b.i64.lsl_(a[0],b.i64.to_int32(b.i64.cast([0,22]))),b.i64.and_(c[0],b.i64.cast([0,4194303]))),b.i64.cast([2147483647,4294967295])),b.resolve(d)}a.__sproc_name__="LSMailboxCreateOfflineThreadingIDStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSGroupParticipantJoinState",[],(function(a,b,c,d,e,f){a=Object.freeze({MEMBER:0,PENDING:1,INVITED:2});f["default"]=a}),66);
__d("LSInitSyncCompleteSubscription",["I64","LSIntEnum","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,c){return new(j||(j=b("Promise")))(function(b,e){var f=d("ReQL").fromTableAscending(a.tables.sync_groups).getKeyRange(c).subscribe(function(a,c){if(c.operation==="delete")return;if((h||(h=d("I64"))).equal(c.value.syncStatus,(i||(i=d("LSIntEnum"))).ofNumber(2))){f();return b()}})})}function a(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.sync_groups).getKeyRange(b)).then(function(c){if(c!=null&&(h||(h=d("I64"))).equal(c.syncStatus,(i||(i=d("LSIntEnum"))).ofNumber(2)))return;return k(a,b)})}function c(a){return k(a,(i||(i=d("LSIntEnum"))).ofNumber(1))}g.maybeWaitForSyncGroup=a;g.use=c}),98);
__d("LSIsEncryptionVersionSecure",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.i64.eq(a[0],b.i64.cast([0,4]))?c[0]=!1:(b.i64.eq(a[0],b.i64.cast([0,3]))?c[1]=!0:(b.i64.eq(a[0],b.i64.cast([0,2]))?c[2]=!0:(b.i64.eq(a[0],b.i64.cast([0,0]))?c[3]=!0:(b.i64.eq(a[0],b.i64.cast([0,99]))?c[4]=!1:c[4]=!1,c[3]=c[4]),c[2]=c[3]),c[1]=c[2]),c[0]=c[1]),d[0]=c[0],b.resolve(d)}a.__sproc_name__="LSEncryptedBackupsVersioningIsEncryptionVersionSecureStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSIssueNewEbTaskAndGetTaskIDV2",["LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),a[0],a[1],a[2],void 0,void 0,c.i64.cast([0,0]),a[3],a[4],void 0,a[5],a[7]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueNewEbTaskAndGetTaskIDV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSIssueNewError",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return c[0]=b.i64.of_float(Date.now()),b.db.table(6).add({errorId:void 0,taskId:a[0],errorCode:a[1],errorTitleText:a[2],errorBodyText:a[3],issuedTimestampMs:c[0],errorExtraData:a[4],presentationStyle:a[5]})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSCoreIssueNewErrorStoredProcedure";a.__tables__=["user_visible_errors"];e.exports=a}),null);
__d("MebClientLogsFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("3226");b=d("FalcoLoggerInternal").create("meb_client_logs",a);e=b;g["default"]=e}),98);
__d("LSLogMebClientEvent.nop",["I64","LSVec","MebClientLogsFalcoEvent","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f,g,j,k){c("MebClientLogsFalcoEvent").log(function(){return{calling_class:f,device_family_id:void 0,device_registration_id:void 0,log_level:(i||(i=d("I64"))).to_string(k),msg:g,trace_ids:c("LSVec").toArray(j)}});return(h||(h=b("Promise"))).resolve()};a.__nop_name__="LSLogMebClientEvent";g["default"]=a}),98);
__d("WAHashStringToNumber",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=0;for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);b=(b<<5)-b+d;b|=0}return Math.abs(b)}f.hashStringToNumber=a}),66);
__d("LSQplAnnotateString.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g,i,j){try{a=c("nullthrows")(d("EBMarkerIdToQPLEvent").markerIdToQPLEvent(f));e=d("WAHashStringToNumber").hashStringToNumber(g);c("QPLUserFlow").addAnnotations(a,{string:(f={},f[i]=j,f)},{instanceKey:e});return(h||(h=b("Promise"))).resolve()}catch(a){return(h||(h=b("Promise"))).resolve()}};a.__nop_name__="LSQplAnnotateString";g["default"]=a}),98);
__d("LSQplMarkPoint.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g,i){try{a=c("nullthrows")(d("EBMarkerIdToQPLEvent").markerIdToQPLEvent(f));e=d("WAHashStringToNumber").hashStringToNumber(g);c("QPLUserFlow").addPoint(a,i,{instanceKey:e});return(h||(h=b("Promise"))).resolve()}catch(a){return(h||(h=b("Promise"))).resolve()}};a.__nop_name__="LSQplMarkPoint";g["default"]=a}),98);
__d("LSQplStartTrace.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g,i,j){try{a=c("nullthrows")(d("EBMarkerIdToQPLEvent").markerIdToQPLEvent(f));e=d("WAHashStringToNumber").hashStringToNumber(g);c("QPLUserFlow").start(a,{instanceKey:e});return(h||(h=b("Promise"))).resolve()}catch(a){return(h||(h=b("Promise"))).resolve()}};a.__nop_name__="LSQplStartTrace";g["default"]=a}),98);
__d("LSVerifyE2EEMetadataThreadExistsV2",["LSCheckIfAuthoritativeThreadMissingMiActMapping","LSCreateOfflineThreadingID","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return c.i64.neq(a[1],void 0)?c.sequence([function(b){return c.db.table(9).fetch([[[a[1]]]]).next().then(function(b,c){var e=b.done;b=b.value;return e?(e=[void 0,void 0],d[3]=e[0],d[4]=e[1],e):(c=b.item,e=[a[1],c.authorityLevel],d[3]=e[0],d[4]=e[1])})},function(a){return a=[d[3],d[4]],d[0]=a[0],d[1]=a[1],a}]):c.resolve((b=[void 0,void 0],d[0]=b[0],d[1]=b[1],b))},function(e){return c.i64.neq(d[0],void 0)?c.sequence([function(e){return c.i64.neq(d[1],void 0)?c.sequence([function(a){return c.storedProcedure(b("LSCheckIfAuthoritativeThreadMissingMiActMapping"),d[0]).then(function(a){return a=a,d[3]=a[0],a})},function(b){return c.i64.gt(a[2],d[1])?c.forEach(c.db.table(9).fetch([[[d[0]]]]),function(b){var c=b.update;b.item;return c({authorityLevel:a[2]})}):c.resolve()},function(e){return d[3]||c.i64.gt(a[2],d[1])?(d[4]=new c.Map(),d[4].set("thread_fbid",d[0]),d[4].set("force_upsert",!1),d[4].set("use_open_messenger_transport",!1),d[4].set("sync_group",c.i64.cast([0,95])),d[4].set("metadata_only",!1),d[4].set("preview_only",!1),d[5]=d[4].get("thread_fbid"),d[6]=c.toJSON(d[4]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[5]),c.i64.cast([0,209]),d[6],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.resolve()}]):c.resolve()},function(a){return d[2]=d[0]}]):c.sequence([function(e){return c.i64.neq(a[1],void 0)?c.sequence([function(e){return c.i64.neq(a[2],c.i64.cast([0,20]))?(d[11]=new c.Map(),d[11].set("thread_fbid",a[1]),d[11].set("force_upsert",!1),d[11].set("use_open_messenger_transport",!1),d[11].set("sync_group",c.i64.cast([0,95])),d[11].set("metadata_only",!1),d[11].set("preview_only",!1),d[12]=d[11].get("thread_fbid"),d[13]=c.toJSON(d[11]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[12]),c.i64.cast([0,209]),d[13],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.resolve()},function(b){return d[3]=a[1]}]):c.sequence([function(a){return d[11]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSCreateOfflineThreadingID"),d[11]).then(function(a){return a=a,d[12]=a[0],a})},function(a){return d[3]=d[12]}])},function(b){return c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))?(b=["inbox",c.i64.cast([0,0])],d[4]=b[0],d[5]=b[1],b):(c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,1]))?(b=["pending",c.i64.cast([-1,4294967295])],d[11]=b[0],d[12]=b[1],b):(c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,2]))?(b=["other",c.i64.cast([-1,4294967294])],d[13]=b[0],d[14]=b[1],b):(c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,3]))?(b=["spam",c.i64.cast([-1,4294967293])],d[15]=b[0],d[16]=b[1],b):(c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,5]))?(b=["hidden",c.i64.cast([-1,4294967292])],d[17]=b[0],d[18]=b[1],b):(c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,4]))?(b=["archived",c.i64.cast([-1,4294967286])],d[19]=b[0],d[20]=b[1],b):(c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,15]))?(b=["restricted",c.i64.cast([-1,4294967281])],d[21]=b[0],d[22]=b[1],b):(b=["inbox",c.i64.cast([0,0])],d[21]=b[0],d[22]=b[1],b),b=[d[21],d[22]],d[19]=b[0],d[20]=b[1]),b=[d[19],d[20]],d[17]=b[0],d[18]=b[1]),b=[d[17],d[18]],d[15]=b[0],d[16]=b[1]),b=[d[15],d[16]],d[13]=b[0],d[14]=b[1]),b=[d[13],d[14]],d[11]=b[0],d[12]=b[1]),b=[d[11],d[12]],d[4]=b[0],d[5]=b[1]),d[6]=c.i64.cast([0,1083495711]),d[7]=c.i64.cast([0,1024]),d[8]=c.i64.cast([0,0]),d[9]=c.i64.cast([0,0]),d[10]=c.i64.cast([0,134217728]),c.forEach(c.filter(c.db.table(9).fetch([[[d[3]]]]),function(b){return c.i64.eq(b.threadKey,d[3])&&c.i64.lt(b.authorityLevel,a[2])}),function(a){return a["delete"]()})},function(b){return c.db.table(9).add({threadKey:d[3],mailboxType:c.i64.cast([0,4096]),threadType:a[0],folderName:d[4],lastActivityTimestampMs:c.i64.cast([-1,4294967295]),lastReadWatermarkTimestampMs:c.i64.cast([-1,4294967295]),removeWatermarkTimestampMs:c.i64.cast([-1,4294967295]),ongoingCallState:c.i64.cast([0,0]),parentThreadKey:d[5],authorityLevel:a[2],capabilities:d[6],capabilities2:d[7],capabilities3:d[8],capabilities4:d[9],capabilities5:d[10],unsendLimitMs:c.i64.cast([-1,4294967295]),syncGroup:c.i64.cast([0,95]),isHidden:!0,clientThreadKey:d[3]})},function(a){return d[2]=d[3]}])},function(a){return e[0]=d[2]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxVerifyE2EEMetadataThreadExistsV2StoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSVerifyE2EEMetadataThreadExistsV2StoredProcedure",["LSSynchronousPromise","LSVerifyE2EEMetadataThreadExistsV2","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSVerifyE2EEMetadataThreadExistsV2"),e.threadType,e.threadKey,e.authorityLevel);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MAWBlockUtils",["I64","LSContactUserBlockAction","LSIntEnum","LSThreadBitOffset","ReQL","promiseDone","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;(k||d("react")).useCallback;var l=[0,31,35,55,56,58,24,25,19,85],m=[0,31,35,55,56,58,24,25,19,85,8,22],n=[35,19,85,56,24,25];function a(){var a=d("react-compiler-runtime").c(2),b=(h||(h=c("useReStore")))(),e;a[0]!==b?(e=function(a,e){c("promiseDone")(async function(){var g=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.participants).getKeyRange(a));if(g==null)return;var h=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.threads).getKeyRange(g.threadKey).filter(o));if(h==null)return;g=(i||(i=d("I64"))).equal(e,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactUserBlockAction").MN_BLOCK))?d("LSThreadBitOffset").clear(l,h.capabilities,h.capabilities2,h.capabilities3,h.capabilities4,h.capabilities5):(i||(i=d("I64"))).equal(e,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactUserBlockAction").FB_BLOCK))?d("LSThreadBitOffset").clear(m,h.capabilities,h.capabilities2,h.capabilities3,h.capabilities4,h.capabilities5):d("LSThreadBitOffset").set(n,h.capabilities,h.capabilities2,h.capabilities3,h.capabilities4,h.capabilities5);var k=g[0],p=g[1];await b.runInTransaction(function(a){var b=babelHelpers.extends({},h,{capabilities:k,capabilities2:p});return a.threads.put(b)},"readwrite",void 0,void 0,f.id+":137")}())},a[0]=b,a[1]=e):e=a[1];return e}function o(a){return(i||(i=d("I64"))).equal(a.threadType,(j||(j=d("LSIntEnum"))).ofNumber(15))}g.clearedMnBlockCapabilities=l;g.clearedFbBlockCapabilities=m;g.useChangeThreadBlockCapabilities=a}),98);
__d("MAWReliabilityMonitor",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["PENDING","OK","ERROR","UNKNOWN"]);c=function(){function a(){this.$1=new Map(),this.$2=new Map(),this.$3=[]}var b=a.prototype;b.startMonitoring=function(a,b){b=new h(a,b,this);this.$1.set(a,b);this.recordReport(b);return b};b.stopMonitoring=function(a){this.$1["delete"](a.identifier),this.$2["delete"](a.identifier)};b.recordReport=function(a){this.$2.set(a.identifier,babelHelpers["extends"]({},a.selfAssessmentFn(),{identifier:a.identifier,timestamp:Date.now()})),this.$4()};b.onAggregatedReportChange=function(a){this.$3.push(a)};b.$4=function(){var a=this.getAggregatedReportEntity();this.$3.forEach(function(b){return b(a)})};b.getAggregatedReportEntity=function(){return new g(this.$2)};b.triggerAllSelfAssessments=function(){var a=this;this.$1.forEach(function(b){a.recordReport(b)})};b.getAggregatedReport=function(){this.triggerAllSelfAssessments();return this.$2};b.TEST_ONLY_reset=function(){this.$1.clear(),this.$2.clear(),this.$3=[]};return a}();var g=function(){function a(a){this.$1=a}var b=a.prototype;b.toAckPayloadFormat=function(){return Array.from(this.$1.values())};b.toString=function(){var a=Object.fromEntries(this.$1);return JSON.stringify(a)};return a}(),h=function(){function a(a,b,c){this.identifier=a,this.selfAssessmentFn=b,this.$1=c}var b=a.prototype;b.stopMonitoring=function(){this.$1.stopMonitoring(this)};b.updateState=function(){this.$1.recordReport(this)};return a}();d=new c();f.HealthReportState=a;f.ReliabilityAggregatedReport=g;f.ReportableModule=h;f.MAWReliabilityMonitorSingleton=d}),66);
__d("MAWSetupWorkerAuxStateForLogging",["nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h=[],i=3,j={getWorkerAge:function(){if(j.workerStartTime!=null)return Math.floor((Date.now()-c("nullthrows")(j.workerStartTime))/1e3)},restartMessageTypes:[],restartReasons:[],workerStartTime:null,workerTerminatedPermanently:!1};function a(){j.workerStartTime=Date.now()}function b(a){h.push(a),h.length>i&&h.shift()}function d(){return h.join(",")}g.HEART_BEAT_HISTORY=h;g.WorkerLifeCycleState=j;g.resetWorkerCreationTime=a;g.addWorkerHeartbeatToHistory=b;g.getHeartbeatHistoryAsString=d}),98);
__d("MAWTrackPendingOccamadilloThreads",["Deferred","LSDatabaseSingleton","LSInitSyncCompleteSubscription","LSIntEnum","LSPlatformLsInitLog","MAWMIC","MAWMICSchema","QuickPerformanceLogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=(h={},h[d("MAWMICSchema").ANNOTATIONS.occamadilloBatchesSentToWorker]=0,h[d("MAWMICSchema").ANNOTATIONS.occamadilloPendingThreadsAfterInitSync]=0,h[d("MAWMICSchema").ANNOTATIONS.occamadilloDuplicateThreads]=0,h);(function(){Object.keys(l).forEach(function(a){d("MAWMIC").addIntAnnotation(a,0)})})();function m(a){d("MAWMIC").addIntAnnotation(a,++l[a])}function a(){return l.occamadilloBatchesSentToWorker}var n=new(c("Deferred"))(),o=new Set(),p=new Set(),q=new Set(),r=new Set();function b(a){a=a.callingSource;r.add((k||(k=d("LSIntEnum"))).toNumber(a));d("MAWMIC").addIntArrayAnnotation(d("MAWMICSchema").ANNOTATIONS.occamadilloCallingSources,Array.from(r))}function e(a){d("MAWMIC").addPoint(d("MAWMICSchema").POINTS.thread_mapping_start);if(o.has(a)){m(d("MAWMICSchema").ANNOTATIONS.occamadilloDuplicateThreads);return}p.add(a);d("LSPlatformLsInitLog").LsSync.isRunning()&&q.add(a);(i||(i=c("QuickPerformanceLogger"))).currentTimestamp();o.add(a);d("MAWMIC").addIntAnnotation("occamadilloThreadCount",o.size);d("LSPlatformLsInitLog").LsSync.hasEnded()&&m(d("MAWMICSchema").ANNOTATIONS.occamadilloPendingThreadsAfterInitSync)}function f(){d("MAWMIC").addBoolAnnotation("threadMappingAcked",!0)}async function s(a){if(c("gkx")("2661"))await n.getPromise();else{var b=await (j||(j=d("LSDatabaseSingleton"))).LSDatabaseSingleton;await d("LSInitSyncCompleteSubscription").maybeWaitForSyncGroup(b,(k||(k=d("LSIntEnum"))).ofNumber(95))}p.delete(a);q.delete(a);d("MAWMIC").addIntAnnotation("occamadilloCompleteThreadCount",o.size-p.size);u()}function t(){n.resolve(),u()}function u(){d("MAWMIC").addIntAnnotation("occamadilloThreadCount",o.size);if(d("LSPlatformLsInitLog").LsSync.hasEnded()&&q.size===0){d("MAWMIC").addPoint(d("MAWMICSchema").POINTS.thread_mapping_end);return}p.size===0&&d("MAWMIC").addPoint(d("MAWMICSchema").POINTS.thread_mapping_end)}g.incrementCounter=m;g.getBatchesSentNumber=a;g.markThreadPassedToNativeOp=b;g.addPendingThread=e;g.markBridgeCallAcked=f;g.removePendingThread=s;g.completeSync=t;g.maybeEndOccamadilloThreadMapping=u}),98);
__d("MAWInitError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){function b(b,c){var d;d=a.call(this,b)||this;d.error=void 0;d.name="MAWInitError";d.message=b;d.error=c;return d}babelHelpers.inheritsLoose(b,a);return b}(babelHelpers.wrapNativeSuper(Error));f.MAWInitError=a}),66);
__d("MAWInit",["MAWCurrentUser","MAWInitError","MAWMIC","MWQPLJoinId","MultipleTabsLogger","QPLUserFlow","QuickPerformanceLogger","WAGetStorageQplAnnotations","gkx","qpl","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("qpl")._(25310776,"6155"),j=!1,k=[],l=[],m=!1;function n(){if(m)return;m=!0;c("QPLUserFlow").addAnnotations(i,{bool:{armadillo_init_sync_api_improvements:c("gkx")("24025"),isArmadilloPublicLaunchUser:c("gkx")("23405"),isTlcPublicUser:d("MAWCurrentUser").isTlcPublicUser(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()}})}var o=!1,p=function(){return document.visibilityState!==void 0?document.visibilityState==="hidden":document.hidden},q=function(){r("visibility_change_"+(p()?"hidden":"visible"))};function a(){if(o)return;d("MAWMIC").addPoint("maw_init_start");o=!0;c("QPLUserFlow").start(i,babelHelpers.extends({annotations:{bool:{initiallyHidden:p()},string:{hostname:window.location.hostname}},cancelOnUnload:!0},d("MWQPLJoinId").allowJoinId?{joinOptions:{joinId:d("MWQPLJoinId").MWQPLJoinId}}:{}));c("QPLUserFlow").addAlignmentPointForJoin(i,0,{requestId:d("MWQPLJoinId").MWQPLJoinId});d("MultipleTabsLogger").addAnnotationToQPLEvent(i);void d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){c("QPLUserFlow").addAnnotations(i,a)});n();document.addEventListener("visibilitychange",q);k.forEach(function(a){return a()});l.forEach(function(a){return a()});k.splice(0,k.length);l.splice(0,l.length)}function r(a,b){if(!o||j){if(!o&&b!=null&&b.allowEarlyLogPoints){var d=(h||(h=c("QuickPerformanceLogger"))).currentTimestamp();l.push(function(){c("QPLUserFlow").addPoint(i,a,{timestamp:d})})}return}n();c("QPLUserFlow").addPoint(i,a)}function b(a,b,d){if(!o||j){!o&&d!=null&&d.allowEarlyAnnotations&&k.push(function(){var d;c("QPLUserFlow").addAnnotations(i,{bool:(d={},d[a]=b,d)})});return}c("QPLUserFlow").addAnnotations(i,{bool:(d={},d[a]=b,d)})}function e(a,b,d){if(!o||j){!o&&d!=null&&d.allowEarlyAnnotations&&k.push(function(){var d;c("QPLUserFlow").addAnnotations(i,{string:(d={},d[a]=b,d)})});return}c("QPLUserFlow").addAnnotations(i,{string:(d={},d[a]=b,d)})}function f(a,b,d){if(!o||j){!o&&d!=null&&d.allowEarlyAnnotations&&k.push(function(){var d;c("QPLUserFlow").addAnnotations(i,{string_array:(d={},d[a]=b,d)})});return}c("QPLUserFlow").addAnnotations(i,{string_array:(d={},d[a]=b,d)})}function s(a,b,d){if(!o||j){!o&&d!=null&&d.allowEarlyAnnotations&&k.push(function(){var d;c("QPLUserFlow").addAnnotations(i,{int:(d={},d[a]=b,d)})});return}c("QPLUserFlow").addAnnotations(i,{int:(d={},d[a]=b,d)})}function t(){n(),j=!0,m=!1,document.removeEventListener("visibilitychange",q)}function u(a,b){t();b=b instanceof d("MAWInitError").MAWInitError&&b.error?b.error:b;c("QPLUserFlow").addAnnotations(i,{string:{errorDescription:b==null?void 0:b.message}});c("QPLUserFlow").endFailure(i,a,{error:b});d("MAWMIC").fail(a,b)}function v(a,b){t(),c("QPLUserFlow").addAnnotations(i,{string:{cancelReason:a}}),b&&c("QPLUserFlow").markError(i,"maw_init_cancel_with_error",{error:b}),c("QPLUserFlow").endCancel(i),d("MAWMIC").addStringAnnotation("mawInitCancelReason",a),d("MAWMIC").cancel("maw_init_cancel",b),c("QPLUserFlow").addAnnotations(c("qpl")._(29818881,"6702"),{string:{maw_cancel_reason:a,maw_error_message:b==null?void 0:b.message}})}function w(a){if(j)return;t();d("MAWMIC").addStringAnnotation("mawInitDropReason",a);(h||(h=c("QuickPerformanceLogger"))).markerDrop(i)}function x(){t(),c("QPLUserFlow").endSuccess(i),d("MAWMIC").addPoint("maw_init_end")}async function y(a,b){var c=a+"_start";a=a+"_end";r(c);c=await b();r(a);return c}var z={isCompleted:function(){return j}};b={addBoolAnnotation:b,addIntAnnotation:s,addStringAnnotation:e,addStringArrayAnnotation:f,cancel:v,drop:w,endSuccess:x,fail:u,logPoint:r,measurePerformance:y,start:a};g.MAWInitState=z;g.MAWInit=b}),98);
__d("MAWStartupLoggingUtils",["FBLogger","MAWInit","MAWMIC","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f;f=(f=b==null?void 0:b.message)!=null?f:"";f.indexOf("Failed to execute 'importScripts'")>=0?d("MAWInit").MAWInit.fail("import_scripts_failure",c("getErrorSafe")(b)):d("MAWInit").MAWInit.fail("worker_error",c("getErrorSafe")(b));c("FBLogger")("messenger_web").mustfix("[MAWWebWorkerSingletonAsync: "+a+"]: %s:%s:%s:%s:%s:%s:%s",JSON.stringify(b==null?void 0:b.message),b==null?void 0:b.lineno,b==null?void 0:b.colno,b==null?void 0:b.filename,JSON.stringify(b,window.Object.getOwnPropertyNames(b)),b==null?void 0:b.name,e)}function b(a){var b=function(d){d=d==null?void 0:d.data;if(typeof d==="object")if((d==null?void 0:d.type)==="importScripts_error"){var e,f;a.removeEventListener("message",b);var g=c("FBLogger")("messenger_web");g=g.addMetadata("FBLOGGER","ERROR_STACK",(e=typeof (d==null?void 0:d.stack)==="string"?d==null?void 0:d.stack:JSON.stringify(d==null?void 0:d.stack))!=null?e:"no_stack");e=d!=null?d:{};var h=e.error_code,i=e.error_msg,j=e.error_name;e=e.source;f=(f=d==null?void 0:d.perfEntry)!=null?f:{};var k=f.duration,l=f.encodedBodySize,m=f.responseStatus;f=f.transferSize;g.mustfix("[MAWWebWorkerSingletonAsync Script Import Error Details]: %s:%s:%s || errCode:%s || respStatus:%s || encBodySize:%s || duration:%s || transferSize:%s",e!=null&&JSON.stringify(e)||"no_source",j!=null&&JSON.stringify(j)||"no_name",i!=null&&JSON.stringify(i)||"no_msg",h!=null&&JSON.stringify(h)||"none",(g=JSON.stringify(m))!=null?g:"none",(e=JSON.stringify(l))!=null?e:"none",(j=JSON.stringify(k))!=null?j:"none",(i=JSON.stringify(f))!=null?i:"none")}else(d==null?void 0:d.type)==="importScripts_success"&&a.removeEventListener("message",b)};a.addEventListener("message",b)}var h=new Set(["worker_connection_established","worker_init_point_hsdp_end","worker_init_point_hblp_end","get_worker_rev_ack_received","old_worker_shutdown_end","old_worker_shutdown_start"]);function e(a){var b=a.data.annotations;if(b!=null){var c={allowEarlyAnnotations:!0};Object.keys(b).forEach(function(a){var e;e=(e=b[a])!=null?e:{};Object.entries(e).forEach(function(b){var e=b[0];b=b[1];e="workerInit"+e.charAt(0).toUpperCase()+e.substring(1);a==="int"&&typeof b==="number"?(d("MAWInit").MAWInit.addIntAnnotation(e,b,c),d("MAWMIC").addIntAnnotation(e,b)):a==="string"&&typeof b==="string"?(d("MAWInit").MAWInit.addStringAnnotation(e,b,c),d("MAWMIC").addStringAnnotation(e,b)):a==="bool"&&typeof b==="boolean"&&(d("MAWInit").MAWInit.addBoolAnnotation(e,b,c),d("MAWMIC").addBoolAnnotation(e,b))})})}var e={allowEarlyLogPoints:!0};if(a.type==="point"){if(h.has(a.data.event)){var f="worker_"+a.data.event;d("MAWInit").MAWInit.logPoint(f,e);d("MAWMIC").addPoint(f)}}else a.type==="end"&&(a.data.cancel===!0?d("MAWInit").MAWInit.logPoint("worker_creation_cancel",e):a.data.errorName!=null&&(d("MAWInit").MAWInit.addStringAnnotation("errorDescription",a.data.errorName,{allowEarlyAnnotations:!0}),d("MAWInit").MAWInit.logPoint("worker_creation_fail",e)))}g.logWorkerError=a;g.setImportScriptsErrorListener=b;g.logSharedWorkerQPLEvents=e}),98);
__d("MAWWorkerWatchdogRecovery",[],(function(a,b,c,d,e,f){"use strict";var g=null;function a(a){g=a}function b(){return g}f.setRecoveryForWatchdog=a;f.getWorkerRecoveryForWatchdog=b}),66);
__d("SharedWorkerDevChangeManager",["gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=!1,i=new Set();function a(a,b){var c=b.storageWorkerResource;b=b.tabResource;if(!h)return!0;if(i.has(a))return!0;if(new URLSearchParams(window.location.search).has("force_shared_worker_updates"))return!1;if(c.version===2&&b.version===2&&c.sandboxOnlyChecksum!=null)return c.sandboxOnlyChecksum===b.sandboxOnlyChecksum;return c.version===2&&c.rsrcBundleUrl==null||b.version===2&&b.getJSModuleBundleResource().url==null?!1:c.rsrcBundleUrl===b.getJSModuleBundleResource().url}function b(a){if(!h)return!1;if(i.has(a))return!1;return new URLSearchParams(window.location.search).has("force_shared_worker_updates")?!0:!1}function c(a){h&&i.add(a)}g.shouldUseStorageWorkerForDev=a;g.shouldUpgradeWorkerForDevExperimental=b;g.trackCreatedWorker=c}),98);
__d("SharedWorkerEventManager",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var d=function(a){var d;if(typeof a.data==="object"&&((d=a.data)==null?void 0:d.type)==="console"&&typeof ((d=a.data)==null?void 0:d.response)==="object"&&((d=a.data)==null?void 0:d.response)!=null){d=a.data.response;a=d.method;d=d.args;if(typeof a!=="string"||!["log","error","info","debug","warn"].includes(a)){c("FBLogger")("worker").mustfix("Unexpected console method: %s",String(a));return}if(!Array.isArray(d)){c("FBLogger")("worker").mustfix('Expected console args "%s" to be an array',JSON.stringify(d));return}b({method:a,args:d})}},e=a.port;e.addEventListener("message",d);return function(){return e.removeEventListener("message",d)}}function i(a,b){var c=function(a){var c;if(typeof a.data==="object"&&((c=a.data)==null?void 0:c.type)==="sw-uncaught-error"){a=typeof ((c=a.data)==null?void 0:c.e)==="object"?(c=a.data.e)!=null?c:{}:{};c=a.error;var d=a.lineno,e=a.colno,f=a.filename;a=a.message;b({error:c instanceof Error?c:null,errorObject:{lineno:typeof d==="number"?d:null,colno:typeof e==="number"?e:null,filename:typeof f==="string"?f:null,message:typeof a==="string"?a:null}})}},d=a.port;d.addEventListener("message",c);return function(){return d.removeEventListener("message",c)}}function a(a,b,d){var e=function(a){var e;if(typeof a.data==="object"&&((e=a.data)==null?void 0:e.type)==="sw-get-rev"&&typeof a.data.response==="object"){b==null||b.markPoint("get_worker_rev_ack_received");a=typeof a.data==="object"&&typeof ((e=a.data)==null?void 0:e.response)==="object"?(e=a.data)==null?void 0:e.response:{};e=a==null?void 0:a.workerRevision;var f=a==null?void 0:a.spinTime;a=a==null?void 0:a.workerChecksum;if(e==null||typeof e!=="number"){b==null||b.addAnnotations({string:{malformedData:"rev is non-number"}});c("FBLogger")("worker").mustfix("Expected worker rev to be non-null number, but instead received: %s",String(e));return}if(f==null||typeof f!=="number"){b==null||b.addAnnotations({string:{malformedData:"spin_time is non-number"}});c("FBLogger")("worker").mustfix("Expected worker spin time to be non-null number, but instead received: %s",String(f));return}d({rev:e,spinTime:f,workerChecksum:typeof a==="string"?a:void 0})}},f=a.port;f.addEventListener("message",e);return function(){return f.removeEventListener("message",e)}}function b(a,b,c){var d=function(e){var f;if(typeof e.data==="object"&&((f=e.data)==null?void 0:f.type)==="sw-shutdown"&&typeof e.data.response==="object"){var g,h;f=typeof ((f=e.data.response)==null?void 0:f.reason)==="string"?(f=e.data.response)==null?void 0:f.reason:null;g=typeof ((g=e.data.response)==null?void 0:g.workerID)==="string"?(g=e.data.response)==null?void 0:g.workerID:null;e=typeof ((h=e.data.response)==null?void 0:h.isInitialized)==="boolean"?(h=e.data.response)==null?void 0:h.isInitialized:null;b({reason:f,workerID:g,isInitialized:e});(c==null?void 0:c.once)===!0&&a.port.removeEventListener("message",d)}},e=a.port;e.addEventListener("message",d);return function(){return e.removeEventListener("message",d)}}function d(a,b){a.port.addEventListener("message",function(a){var c;typeof a.data==="object"&&((c=a.data)==null?void 0:c.type)==="sw-uptime-tracking"&&typeof ((c=a.data)==null?void 0:c.response)==="object"&&typeof ((c=a.data)==null||(c=c.response)==null?void 0:c.trackerID)==="number"&&b({trackerID:a.data.response.trackerID})})}function e(a,b,d){var e=function(a){var e;if(typeof a.data==="object"&&((e=a.data)==null?void 0:e.type)==="execute-worker-ack"&&typeof ((e=a.data)==null?void 0:e.response)==="object"){e=typeof a.data==="object"&&typeof ((e=a.data)==null?void 0:e.response)==="object"?(a=(e=a.data)==null?void 0:e.response)!=null?a:{}:{};a=e.workerRevision;var f=e.spinMode,g=e.spinTime,h=e.firstInit,i=e.errorGettingSiteData;e=e.error;if(typeof h!=="boolean"){b==null||b.addAnnotations({string:{malformedData:"firstInit is non-boolean"}});c("FBLogger")("worker").mustfix("Expected firstInit to be a boolean, but instead received: %s",String(h));return}i=i!=null?i:e;if(typeof i==="string")return d({err:i,isFirstInit:h});if(typeof a==="number"&&typeof f==="number"&&typeof g==="number")return d({workerRev:a,workerSpinTime:g,workerSpinMode:f,isFirstInit:h});else b==null||b.addAnnotations({string:{malformedData:"workerRevision, spinMode, and/or spinTime are non-numbers"}}),c("FBLogger")("worker").mustfix("Expected workerRevision, spinMode, and spinTime to be non-null number, but instead received: %s %s %s",String(a),String(f),String(g))}},f=a.port;f.addEventListener("message",e);return function(){return f.removeEventListener("message",e)}}function f(a,b,d,e){var f=function(g){var h;if(typeof g.data==="object"&&((h=g.data)==null?void 0:h.type)==="execute-worker-imports"&&typeof ((h=g.data)==null?void 0:h.response)==="object"){(e==null?void 0:e.once)===!0&&a.port.removeEventListener("message",f);b==null||b.markPoint("bundle_imports_ack");h=typeof g.data==="object"&&typeof ((h=g.data)==null?void 0:h.response)==="object"?(g=(h=g.data)==null?void 0:h.response)!=null?g:{}:{};g=h.err;h=h.attempts;if(g!=null&&typeof g!=="string"){b==null||b.addAnnotations({string:{malformedData:"err is neither null or a string"}});c("FBLogger")("worker").mustfix("Expected err to be null or a string, but instead receieved: %s",String(g));return}if(h!=null&&typeof h!=="number"){b==null||b.addAnnotations({string:{malformedData:"attempts is neither null or a number"}});c("FBLogger")("worker").mustfix("Expected attempts to be a number or null, but instead receieved: %s",String(h));return}d({err:g,attempts:h})}},g=a.port;g.addEventListener("message",f);return function(){return g.removeEventListener("message",f)}}function j(a,b,d){var e=function(a){var e;if(typeof a.data==="object"&&((e=a.data)==null?void 0:e.type)==="ww-hrp-init"){b==null||b.markEventEnd("hrp_init");e=typeof a.data==="object"&&typeof ((e=a.data)==null?void 0:e.response)==="object"?(a=(e=a.data)==null?void 0:e.response)!=null?a:{}:{};a=e.err;if(a!=null&&typeof a!=="string"){b==null||b.addAnnotations({string:{malformedData:"err is neither null or a string"}});c("FBLogger")("worker").mustfix("Expected err to be null or a string, but instead receieved: %s",String(a));return}d({err:a})}},f=a.port;f.addEventListener("message",e);return function(){return f.removeEventListener("message",e)}}function k(a,b){var c=function(a){var c;if(typeof a.data==="object"&&((c=a.data)==null?void 0:c.type)==="worker-init-mark"&&typeof ((c=a.data)==null?void 0:c.response)==="object"&&typeof ((c=a.data)==null||(c=c.response)==null?void 0:c.point)==="string"){b((c=a.data)==null||(c=c.response)==null?void 0:c.point)}},d=a.port;d.addEventListener("message",c);return function(){return d.removeEventListener("message",c)}}function l(a,b,c){var d=function(e){var f;if(typeof e.data==="object"&&((f=e.data)==null?void 0:f.type)==="self-terminate"&&typeof ((f=e.data)==null?void 0:f.response)==="object"&&typeof ((f=e.data)==null||(f=f.response)==null?void 0:f.from)==="string"){var g,h,i;f=(f=e.data)==null||(f=f.response)==null?void 0:f.from;g=typeof ((g=e.data)==null||(g=g.response)==null?void 0:g.reason)==="string"?(g=e.data)==null||(g=g.response)==null?void 0:g.reason:"unknown";h=typeof ((h=e.data)==null||(h=h.response)==null?void 0:h.workerID)==="string"?(h=e.data)==null||(h=h.response)==null?void 0:h.workerID:"unknown";e=typeof ((i=e.data)==null||(i=i.response)==null?void 0:i.error)==="string"?(i=e.data)==null||(i=i.response)==null?void 0:i.error:void 0;(c==null?void 0:c.once)===!0&&a.port.removeEventListener("message",d);b(f,g,h,e)}},e=a.port;e.addEventListener("message",d);return function(){return e.removeEventListener("message",d)}}function m(a,b){b=b!=null?b:{};var c=b.reason;b=b.upgrade;a.port.postMessage({type:"sw-shutdown",args:[{reason:c,upgrade:b}]})}function n(a){a.port.postMessage({type:"sw-get-rev",args:[]})}function o(a,b){b=b!=null?b:{};var c=b.jsModuleResource;b=b.isDev;a.port.postMessage({type:"execute-worker",args:[c!=null?c:{},b]})}var p=["no-hrp","initialized","processed"];function q(a,b,c){var d=function(e){var f;if(typeof e.data==="object"&&((f=e.data)==null?void 0:f.type)==="connection-ack"&&typeof ((f=e.data)==null?void 0:f.response)==="object"&&typeof ((f=e.data)==null||(f=f.response)==null?void 0:f.from)==="string"){var g;f=typeof ((f=e.data)==null||(f=f.response)==null?void 0:f.workerID)==="string"?(f=e.data)==null||(f=f.response)==null?void 0:f.workerID:void 0;g=typeof ((g=e.data)==null||(g=g.response)==null?void 0:g.hrpStatus)==="string"?(g=e.data)==null||(g=g.response)==null?void 0:g.hrpStatus:void 0;b((e=e.data)==null||(e=e.response)==null?void 0:e.from,f,g!=null&&p.includes(g)?g:void 0);(c==null?void 0:c.once)===!0&&a.port.removeEventListener("message",d)}},e=a.port;e.addEventListener("message",d);return function(){return e.removeEventListener("message",d)}}function r(a,b){var c=function(a){b(a.data)},d=a.port;d.addEventListener("message",c);return function(){return d.removeEventListener("message",c)}}function s(a){a.port.postMessage({type:"ww-connection-ack"})}function t(a,b,c){c=b.isDev;var d=b.hrp;b=b.js_env;a.port.postMessage({type:"ww-hrp-init",hrp:d,is_dev:c,js_env:b,tiered:!0})}function u(a,b){b=b.trackerID;a.port.postMessage({type:"sw-uptime-tracking",args:{trackerID:b}})}function v(a){var b=h(a,function(a){var b,c=a.args;a=a.method;(b=console)[a].apply(b,c)}),d=i(a,function(a){var b=a.error;a=a.errorObject;b!=null?c("FBLogger")("worker").catching(b).mustfix("Shared Worker uncaught error."):c("FBLogger")("worker").mustfix("Shared Worker uncaught error with no Error object. %s:%d:%d:%s",a.message,a.lineno,a.colno,a.filename)});return function(){b(),d()}}g.registerLogFowardingListener=h;g.registerUncaughtErrorForwardingListener=i;g.registerGetWorkerRevListener=a;g.registerWorkerShutdownListener=b;g.registerUptimeTrackerListener=d;g.registerExecuteWorkerAckListener=e;g.registerExecuteWorkerImportsListener=f;g.registerHrpInitListener=j;g.registerWorkerInitPointsListener=k;g.registerWorkerSelfTerminationListener=l;g.emitWorkerShutdown=m;g.emitGetRev=n;g.emitExecuteWorker=o;g.registerConnectionAckListener=q;g.registerAnyMessageListener=r;g.emitConnectionAckRequest=s;g.emitHrpInit=t;g.emitUptimeTracking=u;g.registerForwardListeners=v}),98);
__d("WebStorageLockManager",["FBLogger","LocalStorageWrapper","LockManager","Run","clearInterval","err","promiseDone","setInterval","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";function h(a){c("FBLogger")("messenger_web").mustfix(a)}function a(a,b){var e="Failed to execute 'request' on 'LockManager'",f="Lock broken by another request with the 'steal' option.",g=function(a,b,c){var d=a.get(b);if(d!=null)return d;d=c();a.set(b,d);return d};try{var i=d("LocalStorageWrapper").getStorage(h),j=function(a,c){d("LocalStorageWrapper").setItemGuarded(i,a,c,h,b==null?void 0:b.onQuotaExceeded)},k=function(a){d("LocalStorageWrapper").removeItemGuarded(i,a,h)},l=function(a){return d("LocalStorageWrapper").getItemGuarded(i,a,h)},m=function(){function a(a,b){this.lockName=a,this.tabId=b,this.lockA=this.lockName+"-a",this.lockB=this.lockName+"-b"}var b=a.prototype;b.run=function(a){return this.$1(a,0)};b.$1=function(a,b){var d=this,e=function(c){return window.requestAnimationFrame(function(){return d.$1(a,b+1).then(c)})},f=function(a){return l(a)==null};j(this.lockA,this.tabId);return new Promise(function(g){var h=function(){try{a(),g()}finally{k(d.lockB),k(d.lockA)}};f(d.lockB)||b>10?(b>10&&c("FBLogger")("messenger_web").warn("web-lock polyfill: Had to steal lock"),j(d.lockB,d.tabId),l(d.lockA)===d.tabId?h():window.requestAnimationFrame(function(){l(d.lockB)===d.tabId?h():e(g)})):e(g)})};return a}(),n=function(){function a(b){this.tabId=b,this.lock=new m(a.tabsKey,b),c("promiseDone")(this.$1()),this.$2(),this.keepOnlyTabs(function(b){return a.isAlive(b)})}a.isAlive=function(b){b=l(a.$3(b));return b==null?!1:Date.now()-parseFloat(b)<1e3};var b=a.prototype;b.keepOnlyTabs=async function(b){await this.lock.run(function(){var c;c=JSON.parse((c=l(a.tabsKey))!=null?c:"[]").filter(b);c.length>0?j(a.tabsKey,JSON.stringify(c)):k(a.tabsKey)})};b.$2=function(){var b=a.$3(this.tabId);j(b,Date.now().toString());var e=c("setInterval")(function(){j(b,Date.now().toString())},500);d("Run").onUnload(function(){c("clearInterval")(e),k(b)})};b.$1=async function(){var b=this;await this.lock.run(function(){var c;c=JSON.parse((c=l(a.tabsKey))!=null?c:"[]");j(a.tabsKey,JSON.stringify([].concat(c,[b.tabId])))});d("Run").onUnload(function(){return c("promiseDone")(b.keepOnlyTabs(function(a){return a!==b.tabId}))})};a.$3=function(a){return"$navigator.heartbeat-"+a};return a}();n.tabsKey="$navigator.heartbeat-tabs";var o=function(){function a(b,e){var f=this;this.requests=new Map();this.name=b;this.tabId=e;this.queueKey=a.storagePrefix+"-"+b+"-q";this.currentOwnerKey=a.storagePrefix+"-"+b+"-o";this.lock=new m(a.storagePrefix+"-"+b,this.tabId);d("Run").onUnload(function(){c("promiseDone")(f.keepOnlyRequests(function(a){return(a==null?void 0:a.t)!==f.tabId}))})}var b=a.prototype;b.enqueue=async function(b,d,a){var e=this,f=c("uuidv4")().toString(),g={t:this.tabId,u:f},h=function(){b(null),e.markRequestReleased(f)},i=function(){b(f),e.markRequestReleased(f)};this.requests.set(f,[function(){return b(f)},function(){d(),e.markRequestReleased(f)}]);if((a==null?void 0:a.signal)!=null){a.signal.onabort=function(){c("promiseDone")(e.keepOnlyRequests(function(a){return(a==null?void 0:a.u)!==f})),i()};if(a.signal.aborted)return i()}await this.lock.run(function(){var b=e.getOwner();(a==null?void 0:a.steal)===!0&&e.$1(b==null?void 0:b.u);if(b==null||(a==null?void 0:a.steal)===!0||!n.isAlive(b.t))e.$2(e.currentOwnerKey,babelHelpers.extends({},g,(a==null?void 0:a.steal)===!0?{s:!0}:{})),e.$3(f);else if((a==null?void 0:a.ifAvailable)!==!0){b=e.getQueue();b.push(g);e.$2(e.queueKey,b)}else h()})};b.dequeue=async function(b){var c=this,d,e=null;await this.lock.run(function(){var d=c.getOwner();if((d==null?void 0:d.t)!==c.tabId||(d==null?void 0:d.u)!==b)return;d=c.getQueue();d=a.getNextOwner(d);var f=d[0];d=d[1];e=f;c.$2(c.currentOwnerKey,f);c.$2(c.queueKey,d)});this.$3((d=e)==null?void 0:d.u)};b.storageChangedOnOtherTab=async function(a,b){var c=this;a==="o"&&await this.lock.run(function(){var a=c.getOwner();if(a==null)return;c.$3(a==null?void 0:a.u);if(a.s===!0){a=b==null?void 0:b.oldValue;if(a!=null){a=JSON.parse(a);a.t===c.tabId&&c.$1(a.u)}}})};b.getQueue=function(){var a;return(a=this.$4(this.queueKey))!=null?a:[]};b.getOwner=function(){return this.$4(this.currentOwnerKey)};a.getQueueNameAndStorageType=function(b){if(!b.startsWith(a.storagePrefix))return null;var d=b.slice(a.storagePrefix.length+1,b.length-2),e=b.charAt(b.length-1);switch(e){case"q":case"o":case"a":case"b":break;default:throw c("err")("Queue was stored with a suffix other than q or o. This is either a bug in the web lock api polyfill code, or it means that something overwrote localStorage with a weird key. Key: "+b)}return[d,e]};a.getNextOwner=function(a){for(var b=0;b<a.length;b+=1)if(n.isAlive(a[b].t))return[a[b],a.slice(b+1)];return[null,[]]};b.$4=function(a){a=l(a);return a!=null?JSON.parse(a):null};b.$2=function(a,b){b=b==null||Array.isArray(b)&&b.length===0?null:JSON.stringify(b);b==null?k(a):j(a,b)};b.keepOnlyRequests=async function(b){var c=this;await this.lock.run(function(){var d=c.getOwner(),e=c.getQueue().filter(b);if(b(d))c.$2(c.queueKey,e);else{d=a.getNextOwner(e);e=d[0];d=d[1];c.$2(c.currentOwnerKey,e);c.$2(c.queueKey,d)}})};b.markRequestReleased=function(a){a!=null&&this.requests.delete(a)};b.$3=function(a){if(a!=null){a=this.requests.get(a);if(a!=null){a=a[0];a()}}};b.$1=function(a){if(a!=null){a=this.requests.get(a);if(a!=null){a[0];a=a[1];a()}}};return a}();o.storagePrefix="$navigator.locks";var p=function(){function a(a){this.$1=new Map(),this.storage=d("LocalStorageWrapper").getStorage(h),this.tabId=a,new n(this.tabId),c("promiseDone")(this.$2()),this.$3()}var b=a.prototype;b.request=function(){var a=this;for(var b=arguments.length,g=new Array(b),h=0;h<b;h++)g[h]=arguments[h];return new Promise(function(b,h){c("promiseDone")(async function(i){var j=g[0],b=g.length===3?g[1]:null,k=g.length===2?g[1]:g[2];if(j.startsWith("-"))throw new DOMException("Names cannot start with '-'.",e);if((b==null?void 0:b.ifAvailable)===!0&&(b==null?void 0:b.signal)!=null)throw new DOMException("The 'signal' and 'ifAvailable' options cannot be used together.",e);var l=a.$4(j),m=await new Promise(function(a){c("promiseDone")(l.enqueue(a,function(){h(new DOMException(f,e))},b))});if((b==null||(i=b.signal)==null?void 0:i.aborted)===!0)throw new DOMException("The request was aborted.",e);try{await k(m!=null?{mode:(i=b==null?void 0:b.mode)!=null?i:d("LockManager").LockMode.Exclusive,name:j}:null)}finally{m!=null&&await l.dequeue(m),l.markRequestReleased(m)}}(),b,h)})};b.query=function(){var a=[],b=[];for(var c of this.$5())if(c!=null){var e={mode:d("LockManager").LockMode.Exclusive,name:c.name};if(c.getOwner()!=null)a.push(e);else for(var f of c.getQueue())b.push(e)}return Promise.resolve({held:a,pending:b})};b.$4=function(a){var b=this;return g(this.$1,a,function(){return new o(a,b.tabId)})};b.$3=function(){var a=this;window.addEventListener("storage",function(b){var d=b.key;if(b.storageArea!==a.storage||d==null)return;d=o.getQueueNameAndStorageType(d);if(d==null)return;var e=d[0];d=d[1];c("promiseDone")((e=a.$4(e))==null?void 0:e.storageChangedOnOtherTab(d,b))})};b.$2=async function(){await Promise.all(this.$5().map(function(a){return a==null?void 0:a.keepOnlyRequests(function(a){return a==null?!1:n.isAlive(a.t)})}))};b.$5=function(){var a=this;return i==null?[]:Object.keys(i).map(function(b){b=o.getQueueNameAndStorageType(b);if(b==null)return;b=b[0];return a.$4(b)})};return a}();return new p(a)}catch(a){return null}}g.make=a}),98);
__d("supportsNativeWebLock",[],(function(a,b,c,d,e,f){"use strict";function a(){return self.LockManager!=null&&self.navigator.locks instanceof self.LockManager}f["default"]=a}),66);
__d("SharedWorkerLockManager",["Deferred","FBLogger","WebStorageLockManager","emptyFunction","pageID","promiseDone","setTimeout","supportsNativeWebLock"],(function(a,b,c,d,e,f,g){"use strict";var h="shared_worker_mutex",i=6e5;function j(a){var b;b=(b=window)==null||(b=b.navigator)==null?void 0:b.locks;if(b!=null)return b;var e=d("WebStorageLockManager").make(c("pageID"));if(e!=null){a==null||a.addAnnotations({bool:{fallback_lock_manager:!0}});return{request:function(a,b){return e.request(a,b)}}}return null}function k(a,b,d){c("setTimeout")(function(){a.isSettled()||(b==null||b.endFailure("lock_timeout"),c("FBLogger")("worker").warn("[SharedWorkerLockManager]: lock timed out in %s ms",i),a.resolve(),d==null||d())},i)}function a(a,b){var d=b.workerQPLLogger,e=b.onLockTimeout;b=b.onLockFail;var f=j(d);d==null||d.addAnnotations({bool:{native_locks:f!=null?c("supportsNativeWebLock")():null}});if(f==null){d==null||d.markPoint("no_lock_manager");c("FBLogger")("worker").warn("Unable to initialize lock manager");a(c("emptyFunction"));return}d==null||d.markPoint("lock_requested");var g=new(c("Deferred"))();c("promiseDone")(f.request(h,function(){d==null||d.markPoint("lock_obtained");k(g,d,e);a(function(){d==null||d.markPoint("lock_released"),g.resolve()});return g.getPromise()}),void 0,b)}g.withWorkerLock=a}),98);
__d("SharedWorkerLoggingUtils",["ErrorSerializer","FBLogger","ODS","QPLUserFlow","getErrorSafe","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,e){(h||(h=d("ODS"))).bumpEntityKey(6653,"shared_worker_infra","worker_self_termination."+b+"."+a),i(a,b,c,e,!0)}function i(a,b,d,e,f){f===void 0&&(f=!1);var g=c("qpl")._(931600201,"1438");c("QPLUserFlow").start(g);c("QPLUserFlow").endSuccess(g,{annotations:{string:{workerName:a,workerID:e,reason:d,location:b,pageID:c("pageID")},bool:{isSelfTermination:f}}})}function b(a,b,c,d,e,f){a==null||a.markEventEnd("execute_worker"),a==null||a.addAnnotations({"int":{runningWorkerRev:e,runningWorkerSpinTime:b,runningWorkerSpinMode:f},string:{executeWorkerErr:c},bool:{isFirstInit:d}})}function e(a,b,d){var e;e=c("getErrorSafe")((e=b instanceof ErrorEvent&&(b==null?void 0:b.error))!=null?e:b);c("FBLogger")("worker").catching(e).warn("Worker %s onerror: %s type, %s message",d,String(b.type),c("ErrorSerializer").toReadableMessage(e));a==null||a.addAnnotations({string_array:{onErrorHandler:[(a=JSON.stringify((d=e==null?void 0:e.message)!=null?d:b==null?void 0:b.message))!=null?a:"undefined",String((d=b==null?void 0:b.lineno)!=null?d:e==null?void 0:e.lineno),String((a=b==null?void 0:b.colno)!=null?a:e==null?void 0:e.colno),String((d=b==null?void 0:b.filename)!=null?d:e==null?void 0:e.filename)]}})}g.logSelfTermination=a;g.logShutdown=i;g.logExecuteAck=b;g.logSharedWorkerError=e}),98);
__d("validateSharedWorkerReference",["ConstUriUtils","isRelativeURL","isSameOrigin","memoize"],(function(a,b,c,d,e,f,g){"use strict";var h=c("memoize")(function(){return d("ConstUriUtils").getUri(window.location.href)});function i(a){var b=h(),e=d("ConstUriUtils").getUri(a);e=b!=null&&e!=null?c("isSameOrigin")(e,b):!1;return e||c("isRelativeURL")(a)}function a(a){if(a==null||typeof a!=="object")return null;var b=a.rev,c=a.spin_time,d=a.url,e=a.version,f=a.rsrcBundleUrl;a=a.sandboxOnlyChecksum;return typeof b!=="number"||typeof c!=="number"||e!=null&&e!==1&&e!==2||!Number.isInteger(b)||!Number.isInteger(c)||typeof d!=="string"||!i(d)||f!=null&&typeof f!=="string"||a!=null&&typeof a!=="string"?null:{rev:b,spin_time:c,url:d,version:e!=null?e:1,rsrcBundleUrl:f,sandboxOnlyChecksum:a}}g["default"]=a}),98);
__d("SharedWorkerStorageManager",["Deferred","FBLogger","Promise","WebAsyncStorage","promiseDone","validateSharedWorkerReference"],(function(a,b,c,d,e,f,g){"use strict";var h,i="__swbundle__",j={};function k(a){return""+i+a}function l(a){var b=new(c("Deferred"))();c("WebAsyncStorage").removeItem(k(a),function(c){if(c)return b.reject(c);j[a]=null;b.resolve()});return b.getPromise()}function m(a,b){var d=new(c("Deferred"))();c("WebAsyncStorage").setItem(k(a),b,function(c){if(c!=null)return d.reject(c);j[a]=b;d.resolve()});return d.getPromise()}function n(a){var b=new(c("Deferred"))();c("WebAsyncStorage").getItem(k(a),function(c,d){if(c)return b.reject(c);j[a]=d;b.resolve(d)});return b.getPromise()}function a(){return j}function d(a,b){return n(a).then(function(a){a=c("validateSharedWorkerReference")(a);return a==null?null:a})["catch"](function(d){c("FBLogger")("worker").catching(d).mustfix("Failed to getSharedWorkerReference for bundleName %s",a);b==null||b.addAnnotations({bool:{failedToGetSharedWorkerResource:!0}});throw d})}function e(a,b){return l(a)["catch"](function(d){c("FBLogger")("worker").catching(d).mustfix("Failed to removeSharedWorkerReference for bundleName %s",a);b==null||b.addAnnotations({bool:{failedToDeleteSharedWorkerResource:!0}});throw d})}function f(a,d,e){var f=c("validateSharedWorkerReference")(d);if(f==null){c("FBLogger")("worker").mustfix('Failed to save worker reference for bundle "%s". Invalid reference: %s',a,JSON.stringify(d));return(h||(h=b("Promise"))).resolve()}return m(a,f)["catch"](function(b){c("FBLogger")("worker").catching(b).mustfix("Failed to saveSharedWorkerReference for bundleName %s",a);e==null||e.addAnnotations({bool:{failedToSaveSharedWorkerResource:!0}});throw b})}function o(a,b,d){var e=c("WebAsyncStorage").isOpenPromiseSettled();d==null||d.addAnnotations({bool:{isWebAsyncStorageIndexedDBOpened:e}});e&&c("promiseDone")(c("WebAsyncStorage").isOperational(),function(a){d==null||d.addAnnotations({string:{idb_open_error:a.success===!1?a.error.message:"No IDB open error"}})});var f=new(c("Deferred"))();c("WebAsyncStorage").upsertAndSaveAtomic(k(a),function(a){a=c("validateSharedWorkerReference")(a);return b(a)},function(b,e){d==null||d.markPoint("worker_reference_db_response");if(b){c("FBLogger")("worker").catching(b).mustfix("Failed to getOrUpdateWorkerReference for bundleName %s",a);return f.reject(b)}j[a]=e;f.resolve(e)});return f.getPromise()}g.SHARED_WORKER_STORAGE_KEY_BASE=i;g.getDebugState=a;g.getSharedWorkerReference=d;g.removeSharedWorkerReference=e;g.saveSharedWorkerReference=f;g.getOrUpdateWorkerReference=o}),98);
__d("createSharedWorkerV2BundleUrlExperimental",["XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder","nullthrows","supportsModuleWorker"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=c("supportsModuleWorker")(!0);return c("nullthrows")((b=c("XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder").buildUri({worker_type:b?"MODULE":"CLASSIC",name:a}))==null?void 0:b.toString())}g["default"]=a}),98);
__d("SharedWorkerMigrationUtils",["ConstUriUtils","Deferred","FBLogger","SharedWorkerEventManager","SharedWorkerStatusLock","SharedWorkerStorageManager","TrustedTypesWebWorkerScriptURLPolicy","clearTimeout","createSharedWorkerV2BundleUrlExperimental","err","justknobx","setTimeout","supportsModuleWorker","supportsNativeWebLock"],(function(a,b,c,d,e,f,g){"use strict";async function h(a){if(!c("supportsNativeWebLock")())return!0;var b=await self.navigator.locks.query();return b.held.some(function(b){return b.name===d("SharedWorkerStatusLock").getDynamicStringInitLockName(a)})}function a(){return c("supportsNativeWebLock")()}async function i(a){if(!c("supportsNativeWebLock")())return!0;var b=await self.navigator.locks.query();return b.held.some(function(b){return b.name===d("SharedWorkerStatusLock").getStatusLockName(a)})}async function b(a,b){if(!c("supportsNativeWebLock")())return!0;var e=await self.navigator.locks.query();return e.held.some(function(c){return c.name===d("SharedWorkerStatusLock").getWorkerIdStatusLockName(a,b)})}var j={SharedWorkerBundle:c("justknobx")._("2852"),MAWMainWebWorkerV2Bundle:c("justknobx")._("2920")};function e(a){return(a=j[a])!=null?a:!1}async function f(a){if(!await h(a))return!1;var b=new(c("Deferred"))(),e=c("createSharedWorkerV2BundleUrlExperimental")(a);e=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(e);e=c("supportsModuleWorker")(!0)?new SharedWorker(e,{name:a,type:"module"}):new SharedWorker(e,a);d("SharedWorkerEventManager").registerWorkerShutdownListener(e,function(a){b.resolve(!0)},{once:!0});d("SharedWorkerEventManager").emitWorkerShutdown(e,{upgrade:!1,reason:"dynamic_string_worker_rollback"});e.port.start();return b.getPromise()}function k(a){a=d("ConstUriUtils").getUri(a);return a!=null&&a.getQueryParam("hash")!=null}async function l(a){var b=a.name,e=a.logger;try{a=await Promise.all([i(b),h(b)]);var f=a[0];a=a[1];if(!f||c("supportsNativeWebLock")()&&a){e.markPoint("legacy_termination_skipped");e.addAnnotations({bool:{dynamicStringWorkerAlreadyRunning:a,workerAlreadyRunning:f,native_locks:c("supportsNativeWebLock")()}});return}a=await d("SharedWorkerStorageManager").getSharedWorkerReference(b);e.markPoint("storage_read");e.addAnnotations({bool:{storageResourceSet:a!=null}});if(a==null)return;try{await d("SharedWorkerStorageManager").removeSharedWorkerReference(b),e.markPoint("storage_cleaned")}catch(a){e.markPoint("storage_error"),e.addAnnotations({string:{storageError:a.toString()}}),c("FBLogger")("worker").catching(a).mustfix("Failed to remove reference from storage.")}f=k(a.url);e.markPoint(f?"legacy_termination_start":"termination_skipped");if(f){var g=new(c("Deferred"))();f=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a.url);a=c("supportsModuleWorker")(!0)?new SharedWorker(f,{name:b,type:"module"}):new SharedWorker(f,b);f=function(){e.markPoint("legacy_termination_end"),g.resolve(!0)};d("SharedWorkerEventManager").registerWorkerShutdownListener(a,f,{once:!0});d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(a,f,{once:!0});a.port.start();d("SharedWorkerEventManager").emitWorkerShutdown(a,{upgrade:!1,reason:"maw-request-refresh"});b=c("setTimeout")(function(){e.markPoint("legacy_termination_timeout"),g.reject(c("err")("Failed to close Shared Web Worker properly. SelfTerminationTimeout was exceeded."))},1e3);await g.getPromise();c("clearTimeout")(b)}}catch(a){e.markPoint("legacy_check_and_termination_error"),e.addAnnotations({string:{legacyCheckError:a.toString()}}),c("FBLogger")("worker").catching(a).mustfix("Failed to check storage and possibly terminate legacy worker.")}}g.isDynamicStringWorkerRunning=h;g.supportsNativeWebLocks=a;g.isStatusLockHeld=i;g.isWorkerIdStatusLockHeld=b;g.shouldCheckForDynamicStringWorker=e;g.maybeTerminateDynamicStringWorker=f;g.isLegacyWorkerURL=k;g.checkStorageAndTerminateLegacyWorker=l}),98);
__d("SharedWorkerUptimeTracker",["FBLogger","ODS","SharedWorkerEventManager","clearInterval","performanceNow","setInterval","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=1e4,k=45e3,l=new Map();function m(a){return Math.floor(((i||(i=c("performanceNow")))()-a)/1e3)}function n(a,b){var e=0,f={};d("SharedWorkerEventManager").registerUptimeTrackerListener(a,function(a){a=a.trackerID;var c=f[a];if(c==null)return;(h||(h=d("ODS"))).bumpFraction(6653,"shared_worker_infra","worker_uptime."+b,1,0);h.bumpEntityKey(6653,"shared_worker_infra","worker_uptime_elapsed_time_to_response_sec."+m(c.createdMs)+"."+b);delete f[a]});return c("setInterval")(function(){var g=e++;c("setTimeout")(function(){var a=f[g];if(a==null)return;delete f[g]},k);f[g]={createdMs:(i||(i=c("performanceNow")))()};(h||(h=d("ODS"))).bumpFraction(6653,"shared_worker_infra","worker_uptime."+b,0,1);d("SharedWorkerEventManager").emitUptimeTracking(a,{trackerID:g})},j)}function a(a,b){if(l.has(b)){c("FBLogger")("worker").mustfix('Uptime tracking for worker "%s" already started.',b);return}l.set(b,{intervalID:n(a,b)})}function b(a){var b=l.get(a);b!=null&&(c("clearInterval")(b.intervalID),l["delete"](a))}g.startUptimeTracking=a;g.stopUptimeTracking=b}),98);
__d("buildSharedWorkerInitQPLLogger",["QPLUserFlow","SiteData","checkForIndexedDbSupported","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(931595918,"2062"),i=0;function a(a){var b=!1,d=!1,e=i++;function f(f){var g=f.version,i=f.workerName,j=f.callReason,k=f.experimental_init;f=f.migrationEnabled;if(b||d)return;b=!0;g={"int":{version:g,clientRev:c("SiteData").client_revision},bool:{isDev:!1,supportsIDB:c("checkForIndexedDbSupported")(),experimental_init:k!=null?k:!1,migrationEnabled:f!=null?f:!1},string:{workerName:i,hostname:window.location.hostname,callReason:j,pageID:c("pageID")}};c("QPLUserFlow").start(h,{onFlowTimeout:function(){c("QPLUserFlow").addAnnotations(h,{bool:{setupTimeout:!0}},{instanceKey:e}),d=!0},cancelOnUnload:!0,annotations:g,timeoutInMs:66e4,instanceKey:e});a==null||a({type:"start",data:{annotations:g}})}function g(f,g){f=f+"_start";a==null||a({type:"point",data:{annotations:g,event:f}});if(!b||d)return;c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e})}function j(f,g){f=f+"_end";a==null||a({type:"point",data:{annotations:g,event:f}});if(!b||d)return;c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e});a==null||a({type:"point",data:{annotations:g,event:f}})}function k(f,g){a==null||a({type:"point",data:{annotations:g,event:f}});if(!b||d)return;c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e})}function l(f){a==null||a({type:"end",data:{annotations:f}});if(!b||d)return;c("QPLUserFlow").endSuccess(h,{annotations:f,instanceKey:e});d=!0}function m(f,g){a==null||a({type:"end",data:{errorName:f,annotations:g}});if(!b||d)return;c("QPLUserFlow").endFailure(h,f,{annotations:g,instanceKey:e});d=!0}function n(f){a==null||a({type:"end",data:{annotations:f,cancel:!0}});if(!b||d)return;c("QPLUserFlow").endCancel(h,{annotations:f,instanceKey:e});d=!0}function o(f){a==null||a({type:"annotate",data:{annotations:f}});if(!b||d)return;c("QPLUserFlow").addAnnotations(h,f,{instanceKey:e})}return{start:f,endFailure:m,addAnnotations:o,endSuccess:l,endCancel:n,markEventStart:g,markEventEnd:j,markPoint:k}}g["default"]=a}),98);
__d("buildSharedWorkerTerminateQPLLogger",["QPLUserFlow","SiteData","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(931600201,"1438"),i=0;function a(a){var b=!1,d=!1,e=i++;function f(f){var g=f.workerName;f=f.callReason;if(b||d)return;b=!0;g={"int":{clientRev:c("SiteData").client_revision},bool:{isDev:!1},string:{workerName:g,hostname:window.location.hostname,callReason:f,pageID:c("pageID")}};c("QPLUserFlow").start(h,{onFlowTimeout:function(){c("QPLUserFlow").addAnnotations(h,{bool:{setupTimeout:!0}},{instanceKey:e}),d=!0},cancelOnUnload:!0,annotations:g,timeoutInMs:3e4,instanceKey:e});a==null||a({type:"start",data:{annotations:g}})}function g(f,g){if(!b||d)return;f=f+"_start";c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e});a==null||a({type:"point",data:{annotations:g,event:f}})}function j(f,g){if(!b||d)return;f=f+"_end";c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e});a==null||a({type:"point",data:{annotations:g,event:f}})}function k(f,g){if(!b||d)return;c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e});a==null||a({type:"point",data:{annotations:g,event:f}})}function l(f){if(!b||d)return;c("QPLUserFlow").endSuccess(h,{annotations:f,instanceKey:e});a==null||a({type:"end",data:{annotations:f}});d=!0}function m(f,g){if(!b||d)return;c("QPLUserFlow").endFailure(h,f,{annotations:g,instanceKey:e});a==null||a({type:"end",data:{errorName:f,annotations:g}});d=!0}function n(f){if(!b||d)return;c("QPLUserFlow").endCancel(h,{annotations:f,instanceKey:e});a==null||a({type:"end",data:{annotations:f,cancel:!0}});d=!0}function o(f){if(!b||d)return;c("QPLUserFlow").addAnnotations(h,f,{instanceKey:e});a==null||a({type:"annotate",data:{annotations:f}})}return{start:f,endFailure:m,addAnnotations:o,endSuccess:l,endCancel:n,markEventStart:g,markEventEnd:j,markPoint:k}}g["default"]=a}),98);
__d("XCometFBMultiSiteSharedWorkerStaticInitScriptControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/static_resources/sharedworker/init_script/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("getSharedWorkerHash",["uuidv4"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("uuidv4")()}g["default"]=a}),98);
__d("createSharedWorkerBundleUrl",["XCometFBMultiSiteSharedWorkerStaticInitScriptControllerRouteBuilder","getSharedWorkerHash","getWorkerInitScriptSPINParams","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return c("nullthrows")((a=c("XCometFBMultiSiteSharedWorkerStaticInitScriptControllerRouteBuilder").buildUri({hash:c("getSharedWorkerHash")()}).addQueryParams(c("getWorkerInitScriptSPINParams")()))==null?void 0:a.toString())}g["default"]=a}),98);
__d("createSharedWorkerV2BundleUrl",["XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder","getSharedWorkerHash","getWorkerInitScriptSPINParams","gkx","justknobx","nullthrows","supportsModuleWorker"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=c("supportsModuleWorker")(!0),b=c("getWorkerInitScriptSPINParams")();b.set("hash",c("getSharedWorkerHash")());b.set("use_broadcast",c("justknobx")._("4177"));b.set("worker_id_in_terminate",c("gkx")("12766"));return c("nullthrows")((a=c("XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder").buildUri({worker_type:a?"MODULE":"CLASSIC"}))==null||(a=a.addQueryParams(b))==null?void 0:a.toString())}a=function(){return h()};g.createSharedWorkerV2BundleUrl=a}),98);
__d("handleWorkerWriteError",["FBLogger","WebStorageCleanupReason"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a instanceof Error){c("FBLogger")("worker").catching(a).mustfix("Error occured checking in shared worker reference");return}if(a==="writes disabled"){var b;c("FBLogger")("worker").warn("Writes to WebAsyncStorage is disabled. Unable to save shared worker reference. Reason: %s",(b=d("WebStorageCleanupReason").getLastCleanupReason())!=null?b:"n/a");return}c("FBLogger")("worker").mustfix("Error occured checking in shared worker reference: %s",JSON.stringify(a))}g["default"]=a}),98);
__d("SharedWorkerInitFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("4266");b=d("FalcoLoggerInternal").create("shared_worker_init",a);e=b;g["default"]=e}),98);
__d("logSharedWorkerInitStep",["SharedWorkerInitFalcoEvent","SiteData","gkx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h=c("uuidv4")();function a(a,b,d,e){if(!c("gkx")("21115"))return;c("SharedWorkerInitFalcoEvent").log(function(){return{client_id:h,bundle_name:a,client_rev:String(c("SiteData").client_revision),local_shared_worker_ref:b!=null?{bundle_url:b.url,rev:String(b.rev),spin_time:String(b.spin_time)}:null,new_shared_worker_ref:d!=null?{bundle_url:d}:null,init_step:e}})}g["default"]=a}),98);
__d("SharedWorkerBundleResource",["BootloaderPreloader","BrowserLockManager","Deferred","FBLogger","SharedWorkerDevChangeManager","SharedWorkerEventManager","SharedWorkerLockManager","SharedWorkerLoggingUtils","SharedWorkerMigrationUtils","SharedWorkerStatusLock","SharedWorkerStorageManager","SharedWorkerUptimeTracker","SharedWorkerV2ResourceExperimental","SiteData","StaticSiteData","TrustedTypesWebWorkerScriptURLPolicy","WebWorkerV2DynamicData","buildSharedWorkerInitQPLLogger","buildSharedWorkerTerminateQPLLogger","createSharedWorkerBundleUrl","createSharedWorkerV2BundleUrl","createSharedWorkerV2BundleUrlExperimental","err","getErrorSafe","handleWorkerWriteError","justknobx","logSharedWorkerInitStep","pageID","promiseDone","setTimeout","supportsModuleWorker","supportsNativeWebLock"],(function(a,b,c,d,e,f,g){"use strict";var h=5e3,i="shared_worker_broadcast_channel",j=function(a){function b(b){var c;c=a.call(this)||this;c.name="SelfTerminationError";c.message="Worker self terminated with the reason: "+b;c.reason=b;return c}babelHelpers.inheritsLoose(b,a);return b}(babelHelpers.wrapNativeSuper(Error));function k(a,b,e,f){f==null||f.markEventStart("shared_worker_construct");var g=new SharedWorker(c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a),b);f==null||f.markEventEnd("shared_worker_construct");g.addEventListener("error",function(a){d("SharedWorkerLoggingUtils").logSharedWorkerError(f,a,b)});var h=new Set();d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(g,function(a,c,e){d("SharedWorkerLoggingUtils").logSelfTermination(b,a,c,e)},{once:!0});var i=0;d("SharedWorkerEventManager").registerConnectionAckListener(g,function(a,b){i++;if(h.has("worker_connection_established")){f==null||f.addAnnotations({int:{connectionAckNum:i}});return}h.add("worker_connection_established");f==null||f.addAnnotations({string:{connectedFrom:a,workerID:b}});f==null||f.markPoint("worker_connection_established")});d("SharedWorkerEventManager").registerWorkerInitPointsListener(g,function(a){if(h.has(a))return;h.add(a);f==null||f.markPoint("worker_init_point_"+a)});g.port.start();d("SharedWorkerEventManager").registerExecuteWorkerImportsListener(g,f,function(a){var b=a.err;a=a.attempts;f==null||f.addAnnotations({string:{importsError:b},int:{importAttempts:a}});f==null||f.markPoint(b==null?"bundle_imports_success":"bundle_imports_failure")});var j=new(c("Deferred"))();d("SharedWorkerEventManager").registerExecuteWorkerAckListener(g,f,function(a){var b=a.workerSpinTime,e=a.err,g=a.isFirstInit,h=a.workerRev;a=a.workerSpinMode;d("SharedWorkerLoggingUtils").logExecuteAck(f,b,e,g,h,a);e!=null||b==null||h==null?j.reject(c("err")(e!=null?e:"no worker rev or spin time")):j.resolve({rev:h,spinTime:b})});f==null||f.markEventStart("execute_worker");d("SharedWorkerEventManager").emitExecuteWorker(g,{jsModuleResource:e,isDev:!1});return j.getPromise().then(function(a){var b=a.rev;a=a.spinTime;return{worker:g,rev:b,spinTime:a}})}function l(a,b,d){d==null||d.markEventStart("worker_constructor");a=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a);b=c("supportsModuleWorker")(!0)?new SharedWorker(a,{name:b,type:"module"}):new SharedWorker(a,b);d==null||d.markEventEnd("worker_constructor",{string:{workerUrl:a.toString()}});return b}function m(a,b,c){var e=[],f=new Set();e.push(d("SharedWorkerEventManager").registerWorkerInitPointsListener(a,function(a){if(f.has(a))return;f.add(a);c==null||c.markPoint("worker_init_point_"+a)}));e.push(d("SharedWorkerEventManager").registerHrpInitListener(a,c,function(){}));var g=function(a){d("SharedWorkerLoggingUtils").logSharedWorkerError(c,a,b)};a.addEventListener("error",g);e.push(function(){return a.removeEventListener("error",g)});return e}function n(a,b,e,f){d("SharedWorkerMigrationUtils").shouldCheckForDynamicStringWorker(b)&&(f==null||f.markEventStart("dynamic_string_worker_check"),c("promiseDone")(d("SharedWorkerMigrationUtils").maybeTerminateDynamicStringWorker(b),function(a){f==null||f.markEventEnd("dynamic_string_worker_check",{bool:{didTerminateDynamicStringWorker:a}})}));var g=l(a,b,f);d("SharedWorkerEventManager").registerConnectionAckListener(g,function(a,b,c){f==null||f.addAnnotations({string:{connectedFrom:a,workerID:b,hrpStatus:c}}),f==null||f.markPoint("worker_connection_established")});var h=new(c("Deferred"))();d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(g,function(a,c,e,g){f==null||f.addAnnotations({string:{selfTerminationError:g}}),d("SharedWorkerLoggingUtils").logSelfTermination(b,a,c,e),h.reject(new j(c))},{once:!0});m(g,b,f);g.port.start();d("SharedWorkerEventManager").emitConnectionAckRequest(g);f==null||f.markPoint("read_dynamic_data");c("promiseDone")(z(e,!1,f).then(function(a){a=a.hrp;f==null||f.markEventStart("hrp_init");d("SharedWorkerEventManager").emitHrpInit(g,{hrp:a.hrp,js_env:a.js_env,isDev:!1},f)},function(a){a=c("getErrorSafe")(a);f==null||f.addAnnotations({string:{hrpInitErr:a.toString()}})}));d("SharedWorkerEventManager").registerExecuteWorkerAckListener(g,f,function(a){var b=a.workerSpinTime,e=a.err,g=a.isFirstInit,i=a.workerRev;a=a.workerSpinMode;d("SharedWorkerLoggingUtils").logExecuteAck(f,b,e,g,i,a);e!=null||i==null||b==null?h.reject(c("err")(e!=null?e:"no worker rev or spin time")):h.resolve({rev:i,spinTime:b})});f==null||f.markEventStart("execute_worker");d("SharedWorkerEventManager").emitExecuteWorker(g);return h.getPromise().then(function(a){var b=a.rev;a=a.spinTime;return{worker:g,rev:b,spinTime:a}})}function o(a,b,e,f,g,h){var i=new(c("Deferred"))();d("SharedWorkerEventManager").registerGetWorkerRevListener(a,h,function(a){var j=a.rev;a=a.spinTime;c("promiseDone")(d("SharedWorkerStorageManager").saveSharedWorkerReference(e,{url:b,rev:j,spin_time:a,version:g.version,rsrcBundleUrl:g.getJSModuleBundleResource().url,sandboxOnlyChecksum:g.sandboxOnlyChecksum},h).then(function(){return d("SharedWorkerStorageManager").getSharedWorkerReference(e,h)}).then(function(a){c("logSharedWorkerInitStep")(e,a,g.resourceUrlForLogging,"after_worker_reference_save")}),function(){h.markEventEnd("get_worker_rev",{bool:{successfullySavedWorkerRef:!0}}),i.resolve(),f()},function(a){h.markEventEnd("get_worker_rev",{bool:{successfullySavedWorkerRef:!1}}),i.reject(a),c("handleWorkerWriteError")(a),f()})});h.markEventStart("get_worker_rev");d("SharedWorkerEventManager").emitGetRev(a);return i.getPromise()}function p(a,b,e,f){f===void 0;var g=[],h=function(c,a,f){g.forEach(function(a){return a()}),b(c,a,f),d("SharedWorkerUptimeTracker").stopUptimeTracking(e)};g.push(d("SharedWorkerEventManager").registerForwardListeners(a));g.push(d("SharedWorkerEventManager").registerWorkerShutdownListener(a,function(a){var b=a.reason;a=a.workerID;d("SharedWorkerLoggingUtils").logShutdown(e,null,b,a);b=b==="dynamic_string_worker_rollback"?"requested-upgrade":b;h(b,a,"sw-shutdown")}));g.push(d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(a,function(b,c,a){h(c,a,"self-terminate")}));d("SharedWorkerDevChangeManager").trackCreatedWorker(e);d("SharedWorkerUptimeTracker").startUptimeTracking(a,e);c("logSharedWorkerInitStep")(e,null,null,"create_worker_end")}async function q(a,b,e,f,g,h){h.addAnnotations({string:{initFlow:"use_existing_ref"}});c("logSharedWorkerInitStep")(a,null,null,"using_existing_worker_ref");var i=d("SharedWorkerMigrationUtils").isLegacyWorkerURL(b.url),j=await (b.version===2?i?n(b.url,a,e.getJSModuleBundleResource(),h):d("SharedWorkerV2ResourceExperimental").startV2Worker(b.url,a,e.getJSModuleBundleResource(),h):k(b.url,a,e.getJSModuleBundleResource(),h));j=j.worker;f();b.version===2&&!i&&void o(j,b.url,a,f,e,h);p(j,g,a);return j}async function r(a,b,e,f){e.markPoint("terminate_on_upgrade");var g=new(c("Deferred"))(),h=d("SharedWorkerMigrationUtils").isStatusLockHeld(a);if(await d("SharedWorkerMigrationUtils").isDynamicStringWorkerRunning(a)&&c("supportsNativeWebLock")()&&f===!1)g.resolve(),e.addAnnotations({string:{oldWorkerShutdown:"not_needed_for_dynamic_string"}});else if(self.BroadcastChannel!=null){var i=y(a);i.postMessage({type:"terminate",reason:"requested-upgrade",pageID:c("pageID")});g.resolve();e.addAnnotations({string:{oldWorkerShutdown:"broadcast"}})}else if(await h){b.version===2&&c("supportsModuleWorker")(!0)?i=new SharedWorker(b.url,{name:a,type:"module"}):i=new SharedWorker(b.url,a);d("SharedWorkerEventManager").registerWorkerShutdownListener(i,function(a){var b=a.workerID,h=a.isInitialized;f?c("setTimeout")(function(){e.markEventEnd("old_worker_shutdown",{string:{oldWorkerID:b},bool:{oldWorkerWasInitialized:h}}),g.resolve()},d("SharedWorkerV2ResourceExperimental").DELAY_FOR_WORKER_SHUTDOWN_MS):(e.markEventEnd("old_worker_shutdown",{string:{oldWorkerID:b},bool:{oldWorkerWasInitialized:h}}),g.resolve());e.addAnnotations({string:{oldWorkerShutdown:"success"}})},{once:!0});e.markEventStart("old_worker_shutdown");i.port.start();d("SharedWorkerEventManager").emitWorkerShutdown(i,{upgrade:!0})}else g.resolve(),e.addAnnotations({string:{oldWorkerShutdown:"not_needed"}});f===!0?await g.getPromise():g.resolve()}async function s(a,b,c,d,e,f,g){f.addAnnotations({string:{initFlow:"upgrade_worker_ref"}});await r(a,b,f,g);return u(a,c,d,e,f,"upgrading_worker_ref")}function t(a,b,c,d,e){e.addAnnotations({string:{initFlow:"new_worker_ref"}});return u(a,b,c,d,e,"new_worker_ref")}async function u(a,b,e,f,g,h){c("logSharedWorkerInitStep")(a,null,null,h);await d("SharedWorkerMigrationUtils").isStatusLockHeld(a)&&c("FBLogger")("worker").info("Trying to create a worker %s while old one is still running",a);var i=await b.createSharedWorker(),j=i[0];i=i[1].worker;h==="upgrading_worker_ref"&&await d("SharedWorkerStorageManager").removeSharedWorkerReference(a,g);await o(i,j,a,e,b,g);p(i,f,a);return i}function v(a,b){var e=d("SharedWorkerDevChangeManager").shouldUseStorageWorkerForDev(a.name,{storageWorkerResource:b,tabResource:a}),f=b.spin_time,g=b.version;b=b.rev;return b>=c("SiteData").client_revision&&(a.version===g||f>=c("SiteData")[c("StaticSiteData").spin_time_key])&&e}async function w(a,b,e,f,g){f.markEventStart("create_worker");var h=a.name;d("SharedWorkerUptimeTracker").stopUptimeTracking(h);f.addAnnotations({bool:{workerAlreadyRunning:c("supportsNativeWebLock")()?await d("SharedWorkerMigrationUtils").isStatusLockHeld(h):null}});var i=c("supportsNativeWebLock")()?await d("SharedWorkerMigrationUtils").isStatusLockHeld(h):!0;if(!g&&a.version===2)return D(a,b,e,f);var j=await d("SharedWorkerStorageManager").getSharedWorkerReference(h,f);c("logSharedWorkerInitStep")(h,j,a.resourceUrlForLogging,"create_worker_start");var k=j!=null&&d("SharedWorkerMigrationUtils").isLegacyWorkerURL(j==null?void 0:j.url);i=g&&i===!1&&k;if(j==null||i)return t(h,a,b,e,f);k=j.spin_time;i=j.version;var l=j.rev;f.addAnnotations({int:{storageWorkerSpinTime:k,storageWorkerVersion:i,storageWorkerRev:l}});if(v(a,j))return q(h,j,a,b,e,f);else return s(h,j,a,b,e,f,g)}function a(a,b,e){e=e!=null?e:{};var f=e.onQPLEvent;e=e.reason;var g=a.name,h=c("buildSharedWorkerInitQPLLogger")(f);h.start({version:1,workerName:g,callReason:e});var i=new(c("Deferred"))();d("SharedWorkerLockManager").withWorkerLock(function(d){var e;c("promiseDone")(w({name:g,version:1,resourceUrlForLogging:(e=a.url)!=null?e:"",getJSModuleBundleResource:function(){return a},createSharedWorker:async function(){var b=c("createSharedWorkerBundleUrl")();return[b,await k(b,g,a,h)]}},d,b,h,!1),function(a){h.markEventEnd("create_worker"),h.endSuccess(),i.resolve(a)},function(a){a=typeof a==="string"?c("err")(a):a;h.endFailure("worker_init_failure",{string:{workerInitFailureReason:a.message,errorName:a.name}});i.reject(a);d()})},{workerQPLLogger:h,onLockTimeout:function(){return i.reject(c("err")("Worker lock timeout"))}});return i.getPromise()}function x(a,b,e,f){f===void 0&&(f=0);var g=a.name,h=e!=null?e:{},i=h.onQPLEvent;h=h.reason;var k=c("buildSharedWorkerInitQPLLogger")(i);k.start({version:2,workerName:g,callReason:h,experimental_init:e==null?void 0:e.useDynamicStringInit});k.addAnnotations({bool:{usingModuleWorker:c("supportsModuleWorker")(!0)}});var l=new(c("Deferred"))();i=function(f){c("promiseDone")(w({name:g,version:2,getJSModuleBundleResource:function(){return a},sandboxOnlyChecksum:a.sandboxOnlyChecksum,createSharedWorker:(e==null?void 0:e.useDynamicStringInit)===!0?async function(){var b=c("createSharedWorkerV2BundleUrlExperimental")(g);return[b,await d("SharedWorkerV2ResourceExperimental").startV2Worker(b,g,a,k)]}:async function(){var b=d("createSharedWorkerV2BundleUrl").createSharedWorkerV2BundleUrl();return[b,await n(b,g,a,k)]}},f,b,k,(e==null?void 0:e.useDynamicStringInit)===!0),function(a){k.markEventEnd("create_worker"),k.endSuccess(),l.resolve(a)},function(a){a=typeof a==="string"?c("err")(a):a;l.reject(a);f()})};d("SharedWorkerLockManager").withWorkerLock(i,{workerQPLLogger:k,onLockTimeout:function(){return l.reject(c("err")("Worker lock timeout"))},onLockFail:function(a){l.reject(a)}});return l.getPromise().catch(function(d){if(d instanceof j&&f<2){k.endCancel({string:{workerInitCancelReason:d.message},int:{workerInitRetry:f}});return new Promise(function(d,g){c("setTimeout")(function(){c("promiseDone")(x(a,b,e,f+1),d,g)},f===0?200:500)})}k.endFailure("worker_init_failure",{string:{workerInitFailureReason:d.message,errorName:d.name}});throw d})}async function b(a,b,e){var f=b!=null?b:a.name,g=new(c("Deferred"))(),i=c("buildSharedWorkerTerminateQPLLogger")();i.start({workerName:f});c("promiseDone")(c("supportsNativeWebLock")()?d("SharedWorkerMigrationUtils").isStatusLockHeld(f):Promise.resolve(void 0),function(a){return i.addAnnotations({bool:{workerAlreadyRunning:a}})});i.addAnnotations({string:{reason:e,terminatingPageId:c("pageID")}});if(self.BroadcastChannel!=null){b=y(f);b.postMessage({type:"terminate",reason:e,pageID:c("pageID")});c("promiseDone")(d("SharedWorkerStorageManager").removeSharedWorkerReference(f,i).then(function(){i.endSuccess(),g.resolve()}));return g.getPromise()}d("SharedWorkerLockManager").withWorkerLock(function(b){c("promiseDone")(d("SharedWorkerStorageManager").getSharedWorkerReference(f,i).then(function(b){i.markPoint("read_worker_reference",{int:{storageWorkerVersion:b==null?void 0:b.version},bool:{storageReferenceExists:b!=null}});if(b!=null){var e=d("SharedWorkerMigrationUtils").isLegacyWorkerURL(b.url);i.addAnnotations({bool:{isLegacy:e}});var g=b.version===2?e?n(b.url,f,a,void 0).then(function(a){a=a.worker;return a}):d("SharedWorkerV2ResourceExperimental").startV2Worker(b.url,f,a,void 0).then(function(a){a=a.worker;return a}):k(b.url,f,a).then(function(a){a=a.worker;return a});e=c("justknobx")._("3569")?Promise.resolve(null):d("SharedWorkerStorageManager").removeSharedWorkerReference(f,i);return e.then(function(){return g})}i.markPoint("storage_resource_empty");return null}),function(a){try{b();d("SharedWorkerUptimeTracker").stopUptimeTracking(f);if(a==null){i.endSuccess();g.resolve();return}d("SharedWorkerEventManager").registerWorkerShutdownListener(a,function(a){var b=a.workerID;a=a.isInitialized;i.markPoint("worker_shut_down",{string:{workerID:b},bool:{wasInitialized:a}});b=c("justknobx")._("3569")?d("SharedWorkerStorageManager").removeSharedWorkerReference(f,i):Promise.resolve(null);c("promiseDone")(b,function(){return i.endSuccess()},function(a){i.endFailure("failed_to_remove_worker_reference",{string:{errorDescription:a.toString()}})});g.resolve()},{once:!0});d("SharedWorkerEventManager").emitWorkerShutdown(a,{reason:e})}catch(a){i.endFailure("terminate_worker_failure",{string:{workerTerminateFailReason:a.message}}),g.reject(a.message)}},function(a){c("FBLogger")("worker").catching(c("getErrorSafe")(a)).mustfix("Failed to terminate worker"),i.endFailure("connect_to_worker_failure",{string:{workerTerminateFailReason:a.message}}),g.reject(a.message),b()})},{workerQPLLogger:i});c("setTimeout")(function(){return g.reject()},h);return g.getPromise()}function y(a){return new self.BroadcastChannel(i+"_"+a)}async function e(a){a=await d("SharedWorkerStorageManager").getSharedWorkerReference(a.name);return a!=null}async function z(a,b,e){e==null||e.markEventStart("load_hrp");b=await d("WebWorkerV2DynamicData").readDynamicDataForWorker(a,b);var f=b.data;b=b.time;e==null||e.markEventEnd("load_hrp");try{var g,h=c("justknobx")._("1979");e==null||e.markEventStart("prefetch_worker_scripts",{bool:{prefetchWorkerScripts:h},int:{resourcesCount:(g=f.hrp.allResources)==null?void 0:g.length}});h&&d("BootloaderPreloader").preloadWorkerJSFromHRP(f.hrp)}catch(b){g=c("getErrorSafe")(b);e==null||e.markPoint("prefetch_worker_scripts_fail",{string:{hrpInitErr:g.toString()}});c("FBLogger")("worker").catching(g).warn("Failed to preload worker %s JS from HRP",a.name)}e==null||e.markEventEnd("prefetch_worker_scripts");return{hrp:f,time:b,rev:(h=f.hrp.hsrp)==null||(h=h.hblp)==null||(h=h.consistency)==null?void 0:h.rev}}function A(b,a,c){return d("SharedWorkerStorageManager").getOrUpdateWorkerReference(b.name,function(d){c.markPoint("worker_reference_retrieved");if(d==null)return a;if(v(b,d))return d;void r(b.name,d,c,!1);return a},c)}function B(a,b){if(self.BroadcastChannel!=null){var d=y(a),e=function(a){a=a.data;if(typeof a==="object"&&(a==null?void 0:a.type)==="terminate"){var d=typeof a.reason==="string"?a.reason:"unknown";a=typeof a.pageID==="string"?a.pageID:null;if(a!=null&&a===c("pageID")&&d==="requested-upgrade")return;b(d)}};d.addEventListener("message",e);return function(){return d.removeEventListener("message",e)}}return function(){}}function C(a,b,e,f){var g=new(c("Deferred"))();void d("SharedWorkerStorageManager").getOrUpdateWorkerReference(a,function(a){if(a==null||a.url!==b){g.resolve("url-was-changed");return a}return a.rev!==e||a.spin_time!==f?babelHelpers.extends({},a,{rev:e,spin_time:f}):a}).then(function(){g.resolve("success")});return g.getPromise()}async function D(a,b,e,f){if(a.version!==2)throw c("err")("Worker version must be 2");var g=a.name,h=await z(a.getJSModuleBundleResource(),!1,f),i=h.rev;if(i==null)throw c("err")("HRP rev or spin time is null");i={url:d("createSharedWorkerV2BundleUrl").createSharedWorkerV2BundleUrl(),rev:i,spin_time:h.time,version:a.version,rsrcBundleUrl:a.getJSModuleBundleResource().url,sandboxOnlyChecksum:a.sandboxOnlyChecksum};var k=new(c("Deferred"))(),n=new(c("Deferred"))(),o=[];try{var q=function(a){n.reject(a),k.reject(a)};o.push(B(g,function(a){q(new j("broadcast-"+a))}));f==null||f.markEventStart("get_worker_reference");var r=await A(a,i,f);f==null||f.markEventEnd("get_worker_reference");var s=l(r.url,g,f);o.push(d("SharedWorkerEventManager").registerConnectionAckListener(s,function(a,b,c){f==null||f.addAnnotations({string:{connectedFrom:a,workerID:b}}),k.resolve({hrpStatus:c!=null?c:"no-hrp",workerID:b})}));o.push(d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(s,function(a,b,c,e){f==null||f.addAnnotations({string:{selfTerminationError:e}}),d("SharedWorkerLoggingUtils").logSelfTermination(g,a,b,c),q(new j(b))},{once:!0}));o.push(d("SharedWorkerEventManager").registerWorkerShutdownListener(s,function(a){var b=a.reason;a=a.workerID;d("SharedWorkerLoggingUtils").logShutdown(g,null,b,a);q(new j(b!=null?b:"sw-shutdown-unknown"))}));o.push.apply(o,m(s,g,f));f.markEventStart("worker_connection");s.port.start();d("SharedWorkerEventManager").emitConnectionAckRequest(s);var t=await k.getPromise(),u=t.hrpStatus;t=t.workerID;f.markEventEnd("worker_connection");if(u==="no-hrp"){f==null||f.markPoint("read_dynamic_data");u=i.rev>=r.rev;i=u?Promise.resolve(h):z(a.getJSModuleBundleResource(),!0,f);c("promiseDone")(i.then(function(a){f==null||f.markEventStart("hrp_init"),d("SharedWorkerEventManager").emitHrpInit(s,{hrp:a.hrp.hrp,js_env:a.hrp.js_env,isDev:!1},f)},function(a){a=c("getErrorSafe")(a);f==null||f.markPoint("hrp_init_fail",{string:{hrpInitErr:a.toString()}});q(a)}))}o.push(d("SharedWorkerEventManager").registerExecuteWorkerAckListener(s,f,function(a){var b=a.workerSpinTime,e=a.err,g=a.isFirstInit,h=a.workerRev;a=a.workerSpinMode;d("SharedWorkerLoggingUtils").logExecuteAck(f,b,e,g,h,a);e!=null||b==null||h==null?n.reject(c("err")(e!=null?e:"no worker rev or spin time")):n.resolve({workerRev:h,workerSpinTime:b})}));f==null||f.markEventStart("execute_worker");d("SharedWorkerEventManager").emitExecuteWorker(s);u=await n.getPromise();h=u.workerRev;a=u.workerSpinTime;f==null||f.markEventStart("update_worker_ref");i=await C(g,r.url,h,a);f==null||f.markEventEnd("update_worker_ref",{string:{updateWorkerRef:i}});if(i==="url-was-changed"){d("SharedWorkerEventManager").emitWorkerShutdown(s,{reason:"url-was-changed"});throw new j("url-was-changed")}b();p(s,e,g,t);return s}finally{o.forEach(function(a){return a()})}}g.SHARED_WORKER_BROADCAST_CHANNEL=i;g.SelfTerminationError=j;g.createPushSafeSharedWebWorkerAsync=a;g.createPushSafeSharedWebWorkerV2Async=x;g.terminateSharedWorker=b;g.doesSharedWorkerReferenceExist=e}),98);
__d("SharedWorkerV2ResourceExperimental",["Deferred","SharedWorkerBundleResource","SharedWorkerDevChangeManager","SharedWorkerEventManager","SharedWorkerLoggingUtils","SharedWorkerMigrationUtils","SharedWorkerUptimeTracker","SiteData","StaticSiteData","TrustedTypesWebWorkerScriptURLPolicy","buildSharedWorkerInitQPLLogger","buildSharedWorkerTerminateQPLLogger","createSharedWorkerV2BundleUrlExperimental","justknobx","pageID","promiseDone","setTimeout","supportsModuleWorker","supportsNativeWebLock"],(function(a,b,c,d,e,f,g){"use strict";var h=50,i=5e3,j=2e3;function k(a,b,e,f){return d("SharedWorkerDevChangeManager").shouldUpgradeWorkerForDevExperimental(a)&&!f?!0:b<c("SiteData").client_revision&&e<c("SiteData")[c("StaticSiteData").spin_time_key]}async function a(a,b,e){var f=a.name,g=c("buildSharedWorkerInitQPLLogger")(e==null?void 0:e.onQPLEvent);g.start({version:2,workerName:f,experimental_init:!0,callReason:e==null?void 0:e.reason,migrationEnabled:!0});g.markEventStart("create_worker");c("supportsNativeWebLock")()&&c("promiseDone")(d("SharedWorkerMigrationUtils").isStatusLockHeld(f).then(function(a){g.addAnnotations({bool:{workerAlreadyRunning:a}})}));(e==null?void 0:e.migratedWorker)===!0&&await d("SharedWorkerMigrationUtils").checkStorageAndTerminateLegacyWorker({name:f,logger:g});e=await l(a,g);var i=e.worker,j=e.needsUpgrade;return new Promise(function(e,k){var m=function(a){return e(n(a,f,g,b))};j?(d("SharedWorkerEventManager").registerWorkerShutdownListener(i,function(b){var d=b.workerID;b=b.isInitialized;g.markEventEnd("old_worker_shutdown",{string:{oldWorkerID:d},bool:{oldWorkerWasInitialized:b}});c("setTimeout")(function(){return l(a,g).then(function(a){a=a.worker;return m(a)})},h)},{once:!0}),g.markEventStart("old_worker_shutdown"),d("SharedWorkerEventManager").emitWorkerShutdown(i,{upgrade:!0})):m(i)})}function l(a,b){var e=a.name,f=c("createSharedWorkerV2BundleUrlExperimental")(e);f=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(f);var g=c("supportsModuleWorker")(!0)?"module":"classic",h=new SharedWorker(f,{name:e,type:g}),i=new Set();d("SharedWorkerEventManager").registerWorkerInitPointsListener(h,function(a){if(i.has(a))return;i.add(a);b==null||b.markPoint("worker_init_point_"+a)});var j=new(c("Deferred"))();d("SharedWorkerEventManager").registerGetWorkerRevListener(h,b,function(c){var d=c.rev,f=c.spinTime;c=c.workerChecksum;c=k(e,d,f,a.sandboxOnlyChecksum===c);j.resolve(c);c?b.addAnnotations({int:{oldWorkerRev:d,oldWorkerSpinTime:f}}):b.addAnnotations({int:{workerRev:d,workerSpinTime:f}})});m(h,e,b);h.port.start();d("SharedWorkerEventManager").emitConnectionAckRequest(h);return j.getPromise().then(function(a){return{worker:h,needsUpgrade:a}})}function m(a,b,c,e){a.addEventListener("error",function(a){d("SharedWorkerLoggingUtils").logSharedWorkerError(c,a,b)});d("SharedWorkerEventManager").registerForwardListeners(a);d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(a,function(a,b,d,e){c.endFailure("worker_init_failure",{string:{selfTerminationError:e,selfTerminationReason:b}})},{once:!0});d("SharedWorkerEventManager").registerConnectionAckListener(a,function(a,b){c==null||c.addAnnotations({string:{connectedFrom:a,workerID:b}}),c==null||c.markPoint("worker_connection_established")},{once:!0});return a}function n(a,b,e,f){d("SharedWorkerEventManager").registerWorkerShutdownListener(a,function(a){var e=a.reason,g=a.workerID;d("SharedWorkerLoggingUtils").logShutdown(b,null,e,g);e==="requested-upgrade"?c("setTimeout")(function(){return f==null?void 0:f(e,g)},1e3):e==="dynamic_string_worker_rollback"?f==null||f("maw_request_refresh",g):f==null||f(e,g);d("SharedWorkerUptimeTracker").stopUptimeTracking(b)});e.markEventEnd("create_worker");e.endSuccess();d("SharedWorkerUptimeTracker").startUptimeTracking(a,b);d("SharedWorkerDevChangeManager").trackCreatedWorker(b);return a}function o(a,b,e,f,g){g===void 0&&(g=0);var h=e.name,i=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a),k=c("supportsModuleWorker")(!0)?"module":"classic",l=new SharedWorker(i,{name:h,type:k});f==null||f.markPoint("shared_worker_construct_done");f==null||f.addAnnotations({string:{workerUrl:i.toString()}});var m=new(c("Deferred"))(),n=[];n.push(d("SharedWorkerEventManager").registerConnectionAckListener(l,function(a,b){f==null||f.addAnnotations({string:{connectedFrom:a,workerID:b}}),f==null||f.markPoint("worker_connection_established"),m.resolve()},{once:!0}));n.push(d("SharedWorkerEventManager").registerWorkerInitPointsListener(l,function(a){f==null||f.markPoint("worker_init_point_"+a)}));n.push(d("SharedWorkerEventManager").registerForwardListeners(l));d("SharedWorkerEventManager").emitConnectionAckRequest(l);l.addEventListener("error",function(a){d("SharedWorkerLoggingUtils").logSharedWorkerError(f,a,b)});var p=new(c("Deferred"))();n.push(d("SharedWorkerEventManager").registerGetWorkerRevListener(l,f,function(a){var b=a.rev;a=a.spinTime;f==null||f.addAnnotations({int:{initialWorkerRev:b,initialSpinTime:a}});p.resolve({worker:l,rev:b,spinTime:a})}));n.push(d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(l,function(a,c,e,g){f==null||f.addAnnotations({string:{selfTerminationError:g}}),d("SharedWorkerLoggingUtils").logSelfTermination(b,a,c,e),p.reject(new(d("SharedWorkerBundleResource").SelfTerminationError)(c))},{once:!0}));n.push(d("SharedWorkerEventManager").registerWorkerShutdownListener(l,function(a){var c=a.reason;a=a.workerID;f==null||f.addAnnotations({string:{shutdownReason:c}});d("SharedWorkerLoggingUtils").logShutdown(b,null,c,a);p.reject(new(d("SharedWorkerBundleResource").SelfTerminationError)(c!=null?c:"unknownShutdown"))},{once:!0}));l.port.start();g===0&&c("justknobx")._("1707")&&void Promise.race([m.getPromise().then(function(){return"success"}),new Promise(function(a){c("setTimeout")(function(){a("timeout")},j)})]).then(function(c){if(c==="timeout"){c=l;var d=o(a,b,e,f,g+1);void d.then(function(a){return p.resolve(a)});n.forEach(function(a){return a()});c.port.close()}});return p.getPromise()}async function b(a,b){var e=a.name,f=new(c("Deferred"))();a=await d("SharedWorkerMigrationUtils").isStatusLockHeld(e);var g=c("buildSharedWorkerTerminateQPLLogger")();if(!a){g.start({workerName:e});g.markPoint("no_worker_running");g.endSuccess();return}g.start({workerName:e});g.addAnnotations({string:{reason:b,terminatingPageId:c("pageID")}});a=c("createSharedWorkerV2BundleUrlExperimental")(e);a=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a);var h=c("supportsModuleWorker")(!0)?"module":"classic";a=new SharedWorker(a,{workerName:e,type:h});g.markPoint("worker_created");d("SharedWorkerEventManager").registerWorkerShutdownListener(a,function(a){a=a.workerID;g.markPoint("worker_shut_down",{string:{workerID:a}});g.endSuccess();d("SharedWorkerUptimeTracker").stopUptimeTracking(e);f.resolve()},{once:!0});a.port.start();d("SharedWorkerEventManager").emitWorkerShutdown(a,{reason:b});c("setTimeout")(function(){return f.reject()},i);return f.getPromise()}g.DELAY_FOR_WORKER_SHUTDOWN_MS=h;g.createPushSafeSharedWebWorkerV2Async=a;g.startV2Worker=o;g.terminateSharedWorker=b}),98);
__d("MAWWebWorkerSingleton",["Deferred","MAWInit","MAWMIC","MAWStartupLoggingUtils","MAWWaitForBackendSetup","MAWWorkerWatchdogRecovery","Promise","SharedWorkerBundleResource","SharedWorkerMigrationUtils","SharedWorkerV2ResourceExperimental","WAResolvable","WebWorkerV2Resource","clearTimeout","cr:6600","err","gkx","promiseDone","setTimeout","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null,j=function(a){i=a},k=function(){return i},l=f,m=new(d("WAResolvable").Resolvable)(),n=null;function a(){return d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()?d("SharedWorkerMigrationUtils").isStatusLockHeld(b("cr:6600").name):(h||(h=b("Promise"))).resolve(n!==null)}function e(){var a={isSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker(),nativeLocksSupported:d("SharedWorkerMigrationUtils").supportsNativeWebLocks(),workerCreationPromiseExists:n!==null};if(a.isSharedWorker!==!0)return(h||(h=b("Promise"))).resolve(a.workerCreationPromiseExists===!0?{data:a,tag:"dedicated_exists"}:{data:a,tag:"dedicated_not_exists"});if(a.nativeLocksSupported!==!0)return(h||(h=b("Promise"))).resolve({data:a,tag:"shared_unknown_locks_not_supported"});var c=d("MAWWaitForBackendSetup").getCurrentWorkerID();return(h||(h=b("Promise"))).all([d("SharedWorkerMigrationUtils").isStatusLockHeld(b("cr:6600").name),c!=null?d("SharedWorkerMigrationUtils").isWorkerIdStatusLockHeld(b("cr:6600").name,c):(h||(h=b("Promise"))).resolve(!1)]).then(function(b){var c=b[0];b=b[1];a.sharedLockHeld=c;a.workerIdLockHeld=b;if(c&&b)return{data:a,tag:"shared_exists_and_connected"};if(c)return{data:a,tag:"shared_exists_not_connected"};return b?{data:a,tag:"shared_only_unique_lock_held"}:{data:a,tag:"shared_not_exists"}})}function f(){n=null}function o(a){if(n){d("MAWMIC").addPoint(a+"_wait_on_worker_creation");d("MAWInit").MAWInit.logPoint(a+"_wait_on_worker_creation");return n}d("MAWInit").MAWInit.logPoint(a+"_create_worker_start");d("MAWMIC").addPoint(a+"_create_worker_start");n=(d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()?p(a):q().then(function(a){return{worker:a,workerID:"dedicated"}})).then(function(b){var c=b.worker;b=b.workerID;d("MAWMIC").addPoint(a+"_create_worker_end");d("MAWInit").MAWInit.logPoint(a+"_create_worker_end");return{worker:c,workerID:b}},function(a){n=null;throw a});return n}function p(a){var e=function(a,b,d){c("promiseDone")(m.promise.then(function(){return l(a,b,d)}))};d("MAWWorkerWatchdogRecovery").setRecoveryForWatchdog(e);var f=new(c("Deferred"))(),g=c("gkx")("7313");d("MAWMIC").addBoolAnnotation("migrationEnabled",g);g=g?d("SharedWorkerV2ResourceExperimental").createPushSafeSharedWebWorkerV2Async(b("cr:6600"),e,{migratedWorker:!0,onQPLEvent:d("MAWStartupLoggingUtils").logSharedWorkerQPLEvents,reason:a}):d("SharedWorkerBundleResource").createPushSafeSharedWebWorkerV2Async(b("cr:6600"),e,{onQPLEvent:d("MAWStartupLoggingUtils").logSharedWorkerQPLEvents,reason:a,useDynamicStringInit:c("gkx")("8737")});return g.then(function(a){j(a);d("MAWMIC").addPoint("shared_worker_bundle_created");var b=c("setTimeout")(function(){d("MAWMIC").addPoint("shared_worker_connection_ack_timeout"),f.reject(c("err")("Worker connection ack timeout"))},1e4),e=function(a){var e;if(typeof a.data==="object"&&((e=a.data)==null?void 0:e.type)==="connection-ack"&&typeof ((e=a.data)==null?void 0:e.response)==="object"&&typeof ((e=a.data)==null||(e=e.response)==null?void 0:e.from)==="string"){a=typeof ((e=a.data)==null||(e=e.response)==null?void 0:e.workerID)==="string"?(e=a.data)==null||(e=e.response)==null?void 0:e.workerID:void 0;a!=null?(d("MAWMIC").addPoint("shared_worker_workerID_received"),d("MAWMIC").addStringAnnotation("workerID",a),b!=null&&c("clearTimeout")(b),f.resolve(a)):(d("MAWMIC").addPoint("shared_worker_null_workerID_received"),d("MAWMIC").addStringAnnotation("workerID","unknown"))}};a.port.addEventListener("message",e);a.port.postMessage({type:"ww-connection-ack"});a.addEventListener("error",function(a){d("MAWStartupLoggingUtils").logWorkerError("Shared Worker",a,"")});return f.getPromise().then(function(b){return{worker:a.port,workerID:b}})})}function q(){return(h||(h=b("Promise"))).resolve(d("WebWorkerV2Resource").createDedicatedV2WebWorker(b("cr:6600"))).then(function(a){var b=a.url;a=a.worker;a.onerror=function(a){return d("MAWStartupLoggingUtils").logWorkerError("Dedicated Worker",a,b)};d("MAWStartupLoggingUtils").setImportScriptsErrorListener(a);return a})}function r(a){l=a,m.resolve()}g.getSharedWorkerInstance__TEST_ONLY=k;g.doesWorkerExist=a;g.getWorkerHealthStatus=e;g.resetWorkerCreation=f;g.createWorkerIfNone=o;g.setOnCloseForWorkerInstance=r}),98);
__d("MAWWaitForBackendSetup",["ErrorSerializer","MAWInit","MAWInitError","MAWMIC","MAWSetupWorkerAuxStateForLogging","MAWWebWorkerSingleton","Promise","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=new(h||(h=b("Promise")))(function(a,b){i=a,j=b}),l=!1,m=!1,n=!1,o=!1,p=null,q=i,r=j;function s(a){return new(h||(h=b("Promise")))(function(b,e){k.then(b)["catch"](function(b){var f=a+" rejected because backend setup failed: "+b.message+".";b=b instanceof d("MAWInitError").MAWInitError?b.error:null;b!=null&&(f=f.concat(" More error detail: "+c("ErrorSerializer").toReadableMessage(b)));e(c("err")(f))})})}function a(a,b){c("promiseDone")(s(b).then(function(){a()}))}function t(){if(!o)return;k=new(h||(h=b("Promise")))(function(a,b){i=a,j=b});o=!1;l=!1;q=i;r=j;m=!0;n=!1}function e(a){l=!0,o=!0,n=!1,q==null||q(a)}function f(a){l=!1,o=!0,n=!1,r==null||r(a)}function u(){return l}function v(){return o}function w(){return m}function x(a){a!=null&&p!==a&&d("MAWSetupWorkerAuxStateForLogging").resetWorkerCreationTime(),p=a}function y(a){if(p==null||p!==a)return;z()}function z(){p=null,d("MAWWebWorkerSingleton").resetWorkerCreation(),t(),d("MAWInit").MAWInit.logPoint("reset_current_worker"),d("MAWMIC").addPoint("reset_current_worker")}function A(){return p}function B(){n=!0}function C(){return n}g.waitForBackendSetup=s;g.runAfterBackendSetup=a;g.resetBackendSetup=t;g.resolveBackendSetup=e;g.rejectBackendSetup=f;g.isBackendSetupSuccessful=u;g.isBackendSetupSettled=v;g.wasBackendSetupReset=w;g.setCurrentWorker=x;g.resetCurrentWorkerWithId=y;g.resetCurrentWorkerSkipIdCheck=z;g.getCurrentWorkerID=A;g.markBackendSetupStarted=B;g.isBackendSetupInProgress=C}),98);
__d("MAWWorkerEvent",["FBLogger","MAWMIC","MAWReliabilityMonitor","MAWSetupWorkerAuxStateForLogging","MAWTrackPendingOccamadilloThreads","MAWWaitForBackendSetup","MultipleTabsLogger","QPLUserFlow","pageID","performanceNow","promiseDone","qpl","requireDeferred","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("MAWBridgeObserver").__setRef("MAWWorkerEvent"),j=c("requireDeferred")("MAWWebWorkerSingleton").__setRef("MAWWorkerEvent"),k=new Set(),l=new Set(["addEbUploadTrackingWorkerQPL","ackWithInstanceKey","addMediaDownloadQpl","searchGetFTSRestoreSessionId","none"]),m=new Set(["bulkMaybeCreateOrUpdateThread","createOrUpdateThread"]),n=new Map(),o=function(a){switch(a){case"sendAndReceive":return 1e4;case"fireAndForget":return 4e3;case"waitUntilCompleted":return 1e4;case"waitUntilPersisted":return 1e4;default:return 1e4}},p=function(a,b,d){d=window.setTimeout(function(){v(a,"ack_timeout"),c("promiseDone")(i.load().then(function(a){a.notifyUnackedEvent({route:b,timestamp:(h||(h=c("performanceNow")))()})}))},o(d));n.set(a,d);return d},q=function(a){var b=n.get(a);b!=null&&(window.clearTimeout(b),c("promiseDone")(i.load().then(function(a){a.resetUnackedMessages()})),n["delete"](a))};function a(a,b,e){if(k.has(e)||l.has(b))return;k.add(e);c("QPLUserFlow").start(c("qpl")._(1056842055,"807"),{annotations:{bool:{duringMIC:d("MAWMIC").duringMIC(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker(),workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},"int":{key:e},string:{callType:a,event:b,pageID:c("pageID"),workerHeartbeatsOnStart:d("MAWSetupWorkerAuxStateForLogging").getHeartbeatHistoryAsString(),workerID:d("MAWWaitForBackendSetup").getCurrentWorkerID()},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},instanceKey:e});void d("MultipleTabsLogger").hasMultipleTabs().then(function(a){c("QPLUserFlow").addAnnotations(c("qpl")._(1056842055,"807"),{bool:{isMultiTabs:a}},{instanceKey:e})});void j.load().then(function(a){return a.getWorkerHealthStatus().then(function(a){c("QPLUserFlow").addAnnotations(c("qpl")._(1056842055,"807"),{string:{workerHealthStatusOnStart:a.tag}})})})}function b(a){if(!k.has(a))return;k["delete"](a);c("QPLUserFlow").endSuccess(c("qpl")._(1056842055,"807"),{instanceKey:a})}function e(a,b){if(!k.has(a))return;k["delete"](a);c("QPLUserFlow").endFailure(c("qpl")._(1056842055,"807"),"fail",{annotations:{bool:{workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},string:{error:b},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},instanceKey:a})}function f(a,b,e){if(!k.has(a))return;k["delete"](a);c("QPLUserFlow").endFailure(c("qpl")._(1056842055,"807"),"timeout",{annotations:{bool:{workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},string:{error:b,workerHealthStatus:e.tag},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},instanceKey:a})}function r(a,b){if(!k.has(a))return;c("QPLUserFlow").addAnnotations(c("qpl")._(1056842055,"807"),b,{instanceKey:a})}function s(a,b){if(!k.has(a))return;try{if(Array.isArray(b)){var e=b.every(function(a){return typeof a==="object"&&a!=null&&"state"in a&&a.state===d("MAWReliabilityMonitor").HealthReportState.OK.valueOf()});b=b.reduce(function(a,b){typeof b==="object"&&b!=null&&"state"in b&&"identifier"in b&&"reason"in b&&b.state!==d("MAWReliabilityMonitor").HealthReportState.OK.valueOf()&&typeof b.state==="string"&&typeof b.reason==="string"&&typeof b.identifier==="string"&&a.push([b.identifier,b.state,b.reason].join(":"));return a},[]);r(a,{bool:{workerHealthStatus:e},string:{error:(a=b[0])!=null?a:void 0},string_array:{errors:b}})}}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Failed to log ack result annotations");return!1}}function t(a,b,c){if(typeof c==="object"&&typeof (c==null?void 0:c.timestamp)==="number"){c=c.payload;q(a);v(a,"ack");s(a,c);m.has(b)&&d("MAWTrackPendingOccamadilloThreads").markBridgeCallAcked()}}function u(a,b,c){l.has(b)||p(a,b,c),v(a,"send")}function v(a,b,d){if(!k.has(a))return;c("QPLUserFlow").addPoint(c("qpl")._(1056842055,"807"),b,{instanceKey:a,timestamp:d})}g.getUnackedEventTimeout=o;g.logStart=a;g.logSuccess=b;g.logFailure=e;g.logTimeoutFailure=f;g.logAnnotations=r;g.logAck=t;g.logSend=u}),98);
__d("MAWBridgeLoggingUtils",["MAWWorkerEvent","ODS","Random","WAHashStringToNumber"],(function(a,b,c,d,e,f,g){"use strict";var h,i=3185,j="armadillo_worker_runtime",k="getWorkerHeartbeat",l=10,m=new Array(l);function n(a,b,c){(h||(h=d("ODS"))).bumpEntityKey(i,j,a+"_"+b+"_"+c)}function a(a){return d("WAHashStringToNumber").hashStringToNumber(a+Math.round(d("Random").random()*1e4)+1e4)}function b(a,b,c,e){n(b,c,"start");if(c===k)return;(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_start");d("MAWWorkerEvent").logStart(a,c,e);m.length===l&&m.shift();m.push(b+"_"+c)}function o(a){m.filter(Boolean).forEach(function(b){(h||(h=d("ODS"))).bumpEntityKey(i,j,b+a)})}function c(a,b,c){n(a,b,"success");if(b===k)return;(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_success");d("MAWWorkerEvent").logSuccess(c)}function e(a,b,c,e){n(a,b,"fail");if(b===k)return;(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_fail");d("MAWWorkerEvent").logFailure(e,c)}function f(a,b,c,e){n(a,b,"timeout");if(b===k)return;(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_timeout");d("MAWWorkerEvent").logTimeoutFailure(c,"Route timeout",e)}function p(){o("_before_unresponsive"),m.fill(null)}g.CAT_ID=i;g.ENT=j;g.HEARTBEAT_ROUTE=k;g.RECENT_ROUTES_NUM=l;g.getBridgeEventInstanceKey=a;g.routeStart=b;g.logRecentRoutes=o;g.routeSuccess=c;g.routeFail=e;g.routeTimeoutFail=f;g.logRecentBridgeEvents=p}),98);
__d("WAAbortError",["WACustomError"],(function(a,b,c,d,e,f,g){"use strict";b=function(a){function b(){return a.apply(this,arguments)||this}babelHelpers.inheritsLoose(b,a);return b}(d("WACustomError").customError("AbortError"));var h="AbortError";function a(a){return function(b){if(b.name===h)return a(b);else throw b}}g.AbortError=b;g.ABORT_ERROR=h;g.catchAbort=a}),98);
__d("WAPromiseDelays",["Promise","WAAbortError"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){return new(h||(h=b("Promise")))(function(b,e){if(c!=null&&c.aborted)throw new(d("WAAbortError").AbortError)();var f=setTimeout(g,a);c==null||c.addEventListener("abort",h);function g(){c==null||c.removeEventListener("abort",h),b()}function h(){c==null||c.removeEventListener("abort",h),clearTimeout(f),e(new(d("WAAbortError").AbortError)())}})}function c(a,c,d){return new(h||(h=b("Promise")))(function(b,e){var f=setTimeout(function(){try{b(d())}catch(a){e(a)}},c);a.then(function(a){clearTimeout(f),b(a)},function(a){clearTimeout(f),e(a)})})}g.delayMs=a;g.withTimeout=c}),98);
__d("MAWMaybeWithTimeout",["MAWODSProxy","WAOdsEnums","WAPromiseDelays"],(function(a,b,c,d,e,f,g){"use strict";function h(){return!0}function a(a,b,c,e){return h()?d("WAPromiseDelays").withTimeout(a.then(function(a){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_NON_TIMEOUT,key:e!=null?e:"unknown"});return a}),b,function(){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_TIMEOUT,key:e!=null?e:"unknown"});return c()}):a}g.maybeWithTimeout=a}),98);
__d("MAWTimedBridge",["MAWBridgeLoggingUtils","MAWMaybeWithTimeout","MAWWaitForBackendSetup","MAWWebWorkerSingleton","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=17e4;function a(a,b,c,e,f){f===void 0&&(f=i);return d("MAWWaitForBackendSetup").waitForBackendSetup(c).then(function(){return d("MAWMaybeWithTimeout").maybeWithTimeout(a(),f,function(){return d("MAWWebWorkerSingleton").getWorkerHealthStatus().then(function(a){d("MAWBridgeLoggingUtils").routeTimeoutFail(b,c,e,a);d("WALogger").COUNT(h||(h=babelHelpers.taggedTemplateLiteralLoose(["route.",""])),c).tags("bridge_timeout");throw new j("Bridge route "+c+" timed out, WorkerHealthStatus: "+a.tag)})},c)})}var j=function(a){function b(b){var c;c=a.call(this,b)||this;c.name="BridgeTimeoutError";c.message=b;return c}babelHelpers.inheritsLoose(b,a);return b}(babelHelpers.wrapNativeSuper(Error));g.DEFAULT_MAW_BRIDGE_TIMEOUT_MS=i;g.bridgeTimeout=a;g.MAWBridgeTimeoutError=j}),98);
__d("MAWBridgeFireAndForget",["MAWBridge","MAWBridgeLoggingUtils","MAWTimedBridge","MAWWaitForBackendSetup","MAWWorkerEvent","Promise","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("justknobx")._("1143");function a(a,c,e,f){return d("MAWWaitForBackendSetup").runAfterBackendSetup(function(){var g=d("MAWBridgeLoggingUtils").getBridgeEventInstanceKey(c);f!==!0&&d("MAWBridgeLoggingUtils").routeStart("fireAndForget",a,c,g);void d("MAWTimedBridge").bridgeTimeout(function(){return new(h||(h=b("Promise")))(function(b){d("MAWBridge").getBridge().fireAndForget(a,c,e,f,{onAck:function(e){f!==!0&&(d("MAWWorkerEvent").logAck(g,c,e),d("MAWBridgeLoggingUtils").routeSuccess(a,c,g)),b()},onSend:function(a){var b=a.queueMsgs;a=a.queueSize;f!==!0&&(d("MAWWorkerEvent").logSend(g,c,"fireAndForget"),d("MAWWorkerEvent").logAnnotations(g,{"int":{bridgeSize:a},string_array:{bridgeMsgs:b}}))}},{bridgeQPLInstanceKey:g})})},a,c,g,i)},c)}g.fireAndForget=a}),98);
__d("MAWClientConsistencyRefresh",["ClientConsistencyEventEmitter","CurrentAppID"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(d("CurrentAppID").getAppID()){case 772021112871879:c("ClientConsistencyEventEmitter").emit("hardRefresh",a);break;default:c("ClientConsistencyEventEmitter").emit("softRefresh",a)}}g["default"]=a}),98);
__d("WAShiftTimer",["err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){var b=this;this.$2=0;this.$3=0;this.ts=0;this.$4=0;this.$5=0;this.$6=0;this.$7=void 0;this.$8=function(){var a=b.$7,c=b.$1;b.$3=0;b.$2=0;b.ts=0;b.$4=0;b.$5=0;b.$6=0;b.$7=void 0;c(a)};this.onOrBefore=function(a,c){h(a);var d=Date.now();d=d+a;var e=b.$5;if(e!==0&&e<d)return;e=b.$6;if(e!==0&&d<e)return;b.$5=d;!b.$3&&(!b.$2||d<b.ts)&&b.$9(d,a,c)};this.forceRunNow=function(a){b.$2&&clearTimeout(b.$2),b.$3&&cancelAnimationFrame(b.$3),b.$7=a,b.$8()};this.cancel=function(){b.$2&&clearTimeout(b.$2),b.$3&&cancelAnimationFrame(b.$3),b.$2=0,b.$3=0,b.ts=0,b.$4=0,b.$5=0,b.$6=0,b.$7=void 0};this.$1=a}var b=a.prototype;b.onOrBeforeRepaint=function(a){if(this.$3)return;var b=Date.now(),c=this.$6;if(c!==0&&b<c)return;c=this.$5;(c===0||b<c)&&(this.$5=b);this.$2&&(clearTimeout(this.$2),this.$2=0);(!this.ts||this.ts>b)&&(this.ts=b);this.$7=a;this.$3=requestAnimationFrame(this.$8)};b.onOrAfter=function(a,b){h(a);var c=Date.now();c=c+a;var d=this.$6;if(d!==0&&c<d)return;d=this.$5;if(d!==0&&d<c)return;this.$6=c;(!this.$2||this.ts<c)&&this.$9(c,a,b)};b.debounce=function(a,b){h(a),this.$10(Date.now(),a,b)};b.debounceAndCap=function(a,b,c){h(a);h(b);var d=Date.now();b=d+b;var e=this.$6,f=this.$5;(e===0||e<=b)&&(f===0||b<f)&&(this.$5=b);this.$10(d,a,c)};b.forceRunNowIfScheduled=function(){this.$2?(clearTimeout(this.$2),this.$8()):this.$3&&(cancelAnimationFrame(this.$3),this.$8())};b.isScheduled=function(){return this.$2!==0||this.$3!==0};b.$10=function(a,b,c){var d=a+b,e=this.$6;if(e!==0&&d<e)return;e=this.ts;var f=this.$5;f!==0&&f<d?e<f&&this.$9(f,f-a,c):e<d&&this.$9(d,b,c)};b.$9=function(a,b,c){this.$3&&(cancelAnimationFrame(this.$3),this.$3=0);this.$7=c;this.ts=a;if(this.$2){c=a-this.$4;if(-16<c&&c<16)return;clearTimeout(this.$2)}this.$2=setTimeout(this.$8,b);this.$4=a};return a}();function h(a){if(!(a>=0))throw c("err")("ShiftTimer must be given delayMs >= 0")}g.ShiftTimer=a}),98);
__d("WABridgeBatcher",["WAShiftTimer"],(function(a,b,c,d,e,f,g){"use strict";var h=20,i=1e3;a=function(){function a(a,b,c){var e=this;this.$1=null;this.$6=Date.now();this.$7=new(d("WAShiftTimer").ShiftTimer)(function(){var a=e.$1;if(a==null)return;e.$1=null;e.$2(a)});this.$2=b;this.$3=a;this.$5=c!=null?c:h;this.$4=this.$5}var b=a.prototype;b.addEvent=function(a){var b=this.$1;this.$1=b?this.$3(b,a):[a];if(this.$7.isScheduled())return;b=this.$4;if(b<1){a=Date.now();var c=Math.max(a-this.$6,0)/i;b=Math.min(b+c,this.$5);this.$4=b;this.$6=a}b>=1?(c=0,this.$4=b-1):(c=Math.ceil(i*(1-b)),this.$4=0);this.$7.onOrBefore(c)};b.cancel=function(){this.$1=null,this.$7.cancel()};return a}();g.BridgeBatcher=a}),98);
__d("WALruCache",["WALogger","WAShiftTimer","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a,b){this.key=a,this.value=b,this.prev=null,this.next=null};a=function(){function a(a){var b=this,e;this.$2=new Map();this.purgeNow=function(){for(var a=b.$6.prev;b.$4>b.$3&&a!==b.$5;a=a?a.prev:null){if(a==null)throw c("err")("The linked list is not constructed properly.");var d=a,e=d.key;d=d.value;if(!b.$9(e,d))continue;b["delete"](e);b.$10&&b.$10(e,d)}b.$8&&b.$8(b.$2)};this.$3=a.sizeLimit;this.$7=a.getSize;this.$8=a.onPurge;this.$9=(e=a.shouldEvict)!=null?e:function(){return!0};this.$10=a.onEvict;this.$11=a.onAdd;this.$12=a.onDelete;this.$4=0;this.$5=new i("placeholder-head",null);this.$6=new i("placeholder-tail",null);this.$5.next=this.$6;this.$6.prev=this.$5;this.$1=new(d("WAShiftTimer").ShiftTimer)(function(){return b.purgeNow()})}var b=a.prototype;b.get=function(a){if(!this.$2.has(a))return null;a=this.$2.get(a);if(a==null)return null;var b=a.prev,d=a.next;b&&(b.next=d);d&&(d.prev=b);d=this.$5.next;if(d==null)throw c("err")("The linked list is not constructed properly.");this.$5.next=a;d.prev=a;a.prev=this.$5;a.next=d;return a.value};b.has=function(a){return this.$2.has(a)};b.touch=function(a){this.get(a)};b.put=function(a,b){if(this.$3===0)return;if(this.$7(b)>this.$3){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Blob size is larger than the limit of the whole store."])));return}this["delete"](a);this.$14(a,b);this.schedulePurge()};b.$14=function(a,b){var d=new i(a,b);this.$2.set(a,d);var e=this.$5.next;if(e==null)throw c("err")("The linked list is not constructed properly.");this.$5.next=d;e.prev=d;d.prev=this.$5;d.next=e;this.$4+=this.$7(b);this.$11&&this.$11(a,b)};b["delete"]=function(a){if(!this.$2.has(a))return;var b=this.$2.get(a);if(b==null)return;this.$4-=this.$7(b.value);var c=b.prev,d=b.next;c&&(c.next=d);d&&(d.prev=c);this.$2["delete"](a);this.$12&&this.$12(a,b.value)};b.clear=function(){this.$2.clear(),this.$4=0,this.$5.next=this.$6,this.$6.prev=this.$5,this.$13&&this.$13()};b.schedulePurge=function(){this.$1.onOrBefore(1e3)};b.getCurrentSize=function(){return this.$4};b.getPlaceholderHead=function(){return this.$5};b.forEach=function(a){if(this.$4===0)return;var b=this.$6.prev;if(b==null)throw c("err")("The linked list is not constructed properly.");while(b!=null&&b!==this.$5)a(b.value),b=b.prev};return a}();g.LruCache=a}),98);
__d("WACrossWorkerPortal",["Promise","WABridgeBatcher","WALogger","WALruCache","WAPromiseManagement","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t=function(){function a(a,b,c,e,f){var g=this;this.port=null;this.$2=1;this.openRequests=new Map();this.listeners=new Set();if((f==null?void 0:f.useLRUCache)===!0){var h,i=new(d("WALruCache").LruCache)({sizeLimit:(h=f.portalCacheSize)!=null?h:100,getSize:function(){return 1}});this.processedRequests={has:function(a){return i.has(a)},add:function(a){i.put(a,!0)}}}else{var j=new Set();this.processedRequests={has:function(a){return j.has(a)},add:function(a){j.add(a)}}}this.$1=a;this.clientId=e;this.config=f;this.sendStream=new(d("WABridgeBatcher").BridgeBatcher)(b,function(a){g.$3(a)},(h=this.config)==null?void 0:h.bridgeBatcherMaxTokens);c.forEach(function(b){a.setNamespaceHandler(b,g.$4(b))})}var e=a.prototype;e.$5=function(){var a=this.clientId!=null?this.clientId+"_":"";return""+a+this.$2++};e.$6=function(a){a=a.split("_");return a.length!==2?null:a[0]};e.addListener=function(a){var b=this;this.listeners.add(a);return function(){return b.listeners["delete"](a)}};e.setPort=function(a){var b=this;d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Bridge updating port"])));this.port=a;this.sendStream.cancel();a.onmessage=function(c){if(b.port!==a){d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Bridge received msg on old port"]))).devConsole(c.data);return}c=c.data;if(!c||!Array.isArray(c))return;c.forEach(function(c){b.$7(c,"incoming"),b.$8(a,c)})};this.openRequests.forEach(function(a){a=a.request;d("WALogger").DEV(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Bridge sending "," across (delayed)"])),a.name);b.sendStream.addEvent({type:"request",content:a})})};e.getBridge=function(){return this.$1};e.$4=function(a){var b=this;return function(c,d,e,f,g,h){b.$9(a,c,d,e,f,g,h)}};e.$9=function(a,b,c,d,e,f,g){var h,i=this.$5();h=babelHelpers["extends"]({fromClientId:(h=this.clientId)!=null?h:void 0},g);g={requestId:i,expectsResponse:!!d,namespace:a,name:b,arg:c,silentLog:e,opts:h};this.openRequests.set(i,{request:g,resolver:d,eventCallbacks:f});this.sendStream.addEvent({type:"request",content:g})};e.$10=function(a,b){if(a!==this.port)return;this.sendStream.addEvent({type:"result",content:b})};e.$3=function(a){var b=this,c=this.port;if(!c){d("WALogger").DEV(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Bridge queuing "," msgs"])),a.length);return}c.postMessage(a);var e=a.map(function(a){var b;b=(b=(b=a.content.arg)==null?void 0:b.type)!=null?b:"";return""+((a=a.content.name)!=null?a:"")+(b?":"+b:"")}).filter(Boolean);a.forEach(function(c){var d;b.$7(c,"outgoing");c=b.openRequests.get(c.content.requestId);(c==null||(d=c.eventCallbacks)==null?void 0:d.onSend)!=null&&c.eventCallbacks.onSend({queueSize:a.length,queueMsgs:e})})};e.$7=function(a,b){this.listeners.forEach(function(c){return c(a,b)})};e.$8=function(a,e){var f=this;if(e.type==="request"){var g=e.content,h=g.namespace,i=g.name,j=g.requestId,k=g.arg,r=g.expectsResponse,t=g.silentLog,u=g.opts;t||d("WALogger").LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Bridge "," request for ",""])),j,i);if((u==null?void 0:u.toClientId)!=null&&u.toClientId!==this.clientId){t||d("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Bridge "," not intended for client ",""])),j,this.clientId);return}g=this.$1;var v={type:"result",content:{requestId:j,type:"handled",result:{payload:g.getAckPayoad(),timestamp:Date.now()},silentLog:t,opts:u}};this.$7(v,"outgoing");a.postMessage([v]);if(r){v=g.sendAndReceive(h,i,k,t,void 0,u).then(function(b){f.$10(a,{requestId:j,type:"success",result:b,silentLog:t,opts:u})},function(b){f.$10(a,{requestId:j,type:"error",result:String(b),silentLog:t,opts:u})});d("WAPromiseManagement").preventGarbageCollection(v)}else g.fireAndForget(h,i,k,t,void 0,u)}else{e.type;r=e.content;v=r.requestId;g=r.type;h=r.result;i=r.silentLog;i||d("WALogger").DEV(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Bridge "," response of ",""])),v,g);k=this.$6(v);if(k!==this.clientId||this.processedRequests.has(v))return;e=this.openRequests.get(v);if(!e){d("WALogger").WARN(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Bridge unrecognized result ",""])),v);return}switch(g){case"success":case"error":this.openRequests["delete"](v);this.processedRequests.add(v);r=e.resolver;r?r(g==="success"?h:(s||(s=b("Promise"))).reject(c("err")(h!=null?h:""))):d("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Bridge unexpected result to cast: ",""])),h);break;case"handled":try{(i=e.eventCallbacks)==null||i.onAck==null||i.onAck(h)}catch(a){d("WALogger").ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Failed to execute onAck: ",""])),a.message)}e.resolver||(this.openRequests["delete"](v),this.processedRequests.add(v));break}}};return a}();function a(a,b,c,d,e){return new t(a,c,b,d,e)}function e(a){var b;(b=a.port)==null||b.close();a.port=null;a.sendStream.cancel();b=a.openRequests;a.openRequests=new Map();var c=a.getBridge();b.forEach(function(a){var b=a.request;a=a.resolver;var e=b.namespace,f=b.name,g=b.arg,h=b.silentLog;d("WALogger").LOG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["absorbPortal: transferring request #",""])),b.requestId);a?a(c.sendAndReceive(e,f,g,h)):c.fireAndForget(e,f,g,h)})}g.CrossWorkerPortal=t;g.attachPortal=a;g.killPortalAndSendPendingToBridge=e}),98);
__d("MAWCrossWorkerPortal",["FBLogger","WACrossWorkerPortal","pageID"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f){if(h!=null)return h;h=d("WACrossWorkerPortal").attachPortal(a,b,e,c("pageID"),f);return h}function b(){if(h==null){c("FBLogger")("messenger_web").warn("Trying to kill portal before its setup");return}d("WACrossWorkerPortal").killPortalAndSendPendingToBridge(h)}g.getOrCreateCrossWorkerPortal=a;g.killPortalWhenWorkerTerminating=b}),98);
__d("MAWWorkerOnClose",["MAWSetupWorkerAuxStateForLogging","MAWWaitForBackendSetup","MAWWebWorkerSingleton","QPLUserFlow","pageID","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(1056841865,"2862");function a(a,b,e){c("QPLUserFlow").start(h,{annotations:{string:{currentWorkerId:d("MAWWaitForBackendSetup").getCurrentWorkerID(),pageID:c("pageID"),terminationMsgType:b,terminationReason:a,workerID:e},string_array:{pastWorkerTerminationMsgTypes:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,pastWorkerTerminationReasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}}})}function b(a){c("promiseDone")(d("MAWWebWorkerSingleton").getWorkerHealthStatus(),function(b){return c("QPLUserFlow").endSuccess(h,{annotations:{bool:babelHelpers["extends"]({},b.data),string:{healthStatusAfter:b.tag,outcome:a}}})})}function e(a,b){c("promiseDone")(d("MAWWebWorkerSingleton").getWorkerHealthStatus(),function(d){return c("QPLUserFlow").endFailure(h,a,{annotations:{bool:babelHelpers["extends"]({},d.data),string:{healthStatusAfter:d.tag}},error:b})})}g.ON_WORKER_CLOSED_HANDLER_QPL=h;g.startQPL=a;g.success=b;g.fail=e}),98);
__d("MAWBridgeSendAndReceive",["MAWBridge","MAWBridgeLoggingUtils","MAWTimedBridge","MAWWorkerEvent"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){var f=d("MAWBridgeLoggingUtils").getBridgeEventInstanceKey(b),g=(e==null?void 0:e.isLoggingDisabled)!==!0,h=d("MAWTimedBridge").bridgeTimeout(function(){g&&d("MAWBridgeLoggingUtils").routeStart("sendAndReceive",a,b,f);return d("MAWBridge").getBridge().sendAndReceive(a,b,c,e==null?void 0:e.isLoggingDisabled,{onAck:function(a){g&&d("MAWWorkerEvent").logAck(f,b,a)},onSend:function(a){var c=a.queueMsgs;a=a.queueSize;g&&(d("MAWWorkerEvent").logSend(f,b,"sendAndReceive"),d("MAWWorkerEvent").logAnnotations(f,{"int":{bridgeSize:a},string_array:{bridgeMsgs:c}}))}},{bridgeQPLInstanceKey:f}).then(function(c){g&&d("MAWBridgeLoggingUtils").routeSuccess(a,b,f);return c})["catch"](function(c){g&&d("MAWBridgeLoggingUtils").routeFail(a,b,c.message,f);throw c})},a,b,f,e==null?void 0:e.timeoutMs);return h}g.sendAndReceive=a}),98);
__d("MAWWorkerWatchdog",["MAWBridgeLoggingUtils","MAWBridgeSendAndReceive","MAWSetupWorkerAuxStateForLogging","MAWWaitForBackendSetup","MAWWebWorkerSingleton","MAWWorkerWatchdogRecovery","Promise","QPLUserFlow","err","justknobx","promiseDone","qpl","setInterval","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("justknobx")._("4240"),j=i/2,k=c("qpl")._(1056847415,"2909"),l=!1,m=!1,n=["shared_not_exists","shared_exists_not_connected"];function o(){var a;c("QPLUserFlow").start(k,{annotations:{bool:{workerTerminatedPermanently:(a=d("MAWSetupWorkerAuxStateForLogging")).WorkerLifeCycleState.workerTerminatedPermanently},"int":{workerAge:a.WorkerLifeCycleState.getWorkerAge()},string:{currentWorkerId:d("MAWWaitForBackendSetup").getCurrentWorkerID()},string_array:{pastWorkerTerminationMsgTypes:a.WorkerLifeCycleState.restartMessageTypes,pastWorkerTerminationReasons:a.WorkerLifeCycleState.restartReasons}}});return(h||(h=b("Promise"))).race([d("MAWBridgeSendAndReceive").sendAndReceive("backend",d("MAWBridgeLoggingUtils").HEARTBEAT_ROUTE),new h(function(a,b){c("setTimeout")(function(){b(c("err")("Armadillo web worker heartbeat timed out."))},j)})]).then(function(){c("QPLUserFlow").endSuccess(k),d("MAWSetupWorkerAuxStateForLogging").addWorkerHeartbeatToHistory("OK")},function(a){p(),d("MAWSetupWorkerAuxStateForLogging").addWorkerHeartbeatToHistory("ERROR"),c("promiseDone")(d("MAWWebWorkerSingleton").getWorkerHealthStatus(),function(b){return c("QPLUserFlow").endFailure(k,"heartbeat_timeout",{annotations:{bool:babelHelpers["extends"]({},b.data),string:{workerHealthStatus:b.tag}},error:a})})})}function p(){c("QPLUserFlow").addPoint(k,"starting-lock-based-recovery"),c("promiseDone")(d("MAWWebWorkerSingleton").getWorkerHealthStatus().then(function(a){var b=d("MAWWorkerWatchdogRecovery").getWorkerRecoveryForWatchdog(),c=d("MAWWaitForBackendSetup").getCurrentWorkerID();if(n.includes(a.tag)&&b!=null)return b("locks_based_recovery",c,"locks_based_recovery")}))}function a(){if(m)return;c("setInterval")(function(){if(!l)return;c("promiseDone")(o())},i);d("MAWWaitForBackendSetup").runAfterBackendSetup(function(){l=!0},d("MAWBridgeLoggingUtils").HEARTBEAT_ROUTE);m=!0}g.HEARTBEAT_TIMEOUT_INTERVAL=j;g.MAW_WORKER_HEARTBEAT_QPL=k;g.startWatchdog=a}),98);
__d("MAWSetupWorker",["CurrentAppID","Deferred","IGDWebUtils","MAWBridgeObserver","MAWClientConsistencyRefresh","MAWCommonSetupWorker","MAWCrossWorkerPortal","MAWInit","MAWLoggerUtils","MAWMIC","MAWSetupWorkerAuxStateForLogging","MAWUnrecoverableDbErrors","MAWWaitForBackendSetup","MAWWebWorkerSingleton","MAWWorkerOnClose","MAWWorkerWatchdog","MWFBLogger","QPLUserFlow","SharedWorkerBundleResource","SharedWorkerV2ResourceExperimental","cr:6600","gkx","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n=d("MWFBLogger").MWLogger().tags([d("MAWLoggerUtils").Tag.WorkerSetup,d("MAWLoggerUtils").Tag.MAWInit]),o=d("IGDWebUtils").isInstagramWebSupportedApp(Number(d("CurrentAppID").getAppID())),p=o?"IGDAWMainWorker":"MAWMainWorker",q=null,r=!1;function s(a){r=a,d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently=a}function t(){return r}function u(a){switch(a){case"mawInit":return!0;case"mawReinitSetupMutex":case"mawReinitReregDevice":case"bridgeRecovery":case"workerUpgraded":case"rebootRequired":case"workerTerminated":default:return!1}}async function v(a,b,e,f,g,k,l){if(t())throw n.mustfixThrow("Worker is permanently killed.");d("MAWWaitForBackendSetup").markBackendSetupStarted();var m=function(c){return v(a,b,e,f,c,k,l)};(g==="bridgeRecovery"||g==="backendSetupFailure")&&c("QPLUserFlow").addPoint(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"create_worker_start");d("MAWWebWorkerSingleton").setOnCloseForWorkerInstance(function(a,b,e){d("MAWWorkerOnClose").startQPL(a,e,b);var f=a!=null?a:"unknown",h=A(f)&&d("MAWWaitForBackendSetup").isBackendSetupSettled();d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons.push(f);d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes.push(e!=null?e:"unknown");if(d("MAWWaitForBackendSetup").getCurrentWorkerID()==null||b!==d("MAWWaitForBackendSetup").getCurrentWorkerID()){d("MAWInit").MAWInit.logPoint(f+"_worker_termination_skipped");d("MAWMIC").addPoint(f+"_worker_termination_skipped");d("MAWWorkerOnClose").success(f+"_worker_restart_skipped");n.warn("Worker termination skipped %s. Terminate reason: %s, Worker: %s, current worker: %s",g,a,b,d("MAWWaitForBackendSetup").getCurrentWorkerID());return}d("MAWWaitForBackendSetup").resetCurrentWorkerSkipIdCheck();n.warn("Worker termination started %s. Terminate reason: %s, Worker: %s",g,a,b);d("MAWInit").MAWInit.logPoint(f+"_worker_terminated");d("MAWMIC").addPoint(f+"_worker_terminated");d("MAWInit").MAWInit.addStringArrayAnnotation("workerTerminationReason",d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons);d("MAWMIC").addStringArrayAnnotation("workerTerminationReason",d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons);d("MAWInit").MAWInit.addStringArrayAnnotation("workerTerminationMsgType",d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes);d("MAWMIC").addStringArrayAnnotation("workerTerminationMsgType",d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes);var i=a==="requested-upgrade"?"workerUpgraded":f+"_worker_terminated";c("promiseDone")(z(),function(){if(h){s(!0);n.warn("Tab displays soft refresh. Flow: %s",f);d("MAWInit").MAWInit.logPoint(f+"_soft_refresh");d("MAWMIC").addPoint(f+"_soft_refresh");c("MAWClientConsistencyRefresh")("maw_request_refresh");d("MAWWorkerOnClose").success("softRefresh");return}if(f!=="logout")return m(i).then(function(){return d("MAWWorkerOnClose").success(i)}).catch(function(a){d("MAWInit").MAWInit.fail("worker_restart_failed",a),d("MAWWorkerOnClose").fail("workerUpgradeFailed",a),d("MAWWaitForBackendSetup").rejectBackendSetup(a)});else d("MAWWorkerOnClose").success("skip_logout")})});var o=await d("MAWWebWorkerSingleton").createWorkerIfNone(g),r=o.worker;o=o.workerID;d("MAWWaitForBackendSetup").setCurrentWorker(o);o=new(c("Deferred"))();q=o.getPromise();(g==="bridgeRecovery"||g==="backendSetupFailure")&&c("QPLUserFlow").addPoint(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"create_worker_end");var u=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();n.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["worker setting up with reason: ",", use shared worker: ",""])),g,u);u&&r.addEventListener("message",function(a){var b;typeof a.data==="object"&&((b=a.data)==null?void 0:b.type)==="sw-shutdown"&&typeof a.data.response==="object"&&((b=a.data.response)==null?void 0:b.reason)==="maw-request-refresh"&&c("MAWClientConsistencyRefresh")("maw_request_refresh")});var w=new(d("MAWCommonSetupWorker").BridgeAdapter)(r,p);await b(w);o.resolve(w);n.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["bridge promise resolved"])));d("MAWMIC").addPoint(g+"_connect_to_backend");await d("MAWInit").MAWInit.measurePerformance(g+"-init_backend",async function(){var b=function(b){return d("MAWCommonSetupWorker").initWorker({bridge:w,ebState:b,onWorkerAlreadySetup:e,onWorkerRestart:m,reason:g,vaultMaterials:a})},c=u?await b(l):await w.fullyConnected.then(function(){return b(l)});d("MAWWaitForBackendSetup").resolveBackendSetup(c);n.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["backend setup successful"])))});return d("MAWWaitForBackendSetup").waitForBackendSetup("setup-worker")}function a(a,b,e,f,g,h,i){i=v(a,b,e,f,g,h,i);u(g)&&c("promiseDone")(d("MAWWaitForBackendSetup").waitForBackendSetup("init bridge recovery observer").then(function(){d("MAWBridgeObserver").initUnackedMessagesObserver({onConnectToExistingWorker:e,onTerminateWorker:f,onWorkerConnect:b,updateWorkerState:h,vaultMaterials:a}),d("MAWWorkerWatchdog").startWatchdog()}));return i}function e(){return q}async function w(a){n.debug("Terminating dedicated worker: %s. Bridge Promise: %s",a,!!q);if(!q){n.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["worker doesn't exist, no need to terminate"])));return!1}n.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["worker terminating: for ",""])),a);await z();return!0}async function f(){await w("terminateWorkerPermanently"),s(!0)}function x(a,e){var f=c("gkx")("7313");return f?d("SharedWorkerV2ResourceExperimental").terminateSharedWorker(b("cr:6600"),a?"maw-request-refresh":e!=null?e:"unknown"):d("SharedWorkerBundleResource").terminateSharedWorker(b("cr:6600"),null,a?"maw-request-refresh":e!=null?e:"unknown")}async function y(a){var b=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();if(b){n.debug("Terminating shared worker: %s",a);b=await x(!1,a).then(function(){return!0},function(){return!1});n.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Shared worker responded to termination request: ",""])),b)}else await w(a)}async function z(){var a;n.debug("Updating worker state on termination");(a=await q)==null||a.close();q=null;d("MAWWaitForBackendSetup").resetBackendSetup();d("MAWCrossWorkerPortal").killPortalWhenWorkerTerminating();d("MAWWebWorkerSingleton").resetWorkerCreation()}function A(a){if(a==="MAWEARKeychainDecryptionError"||d("MAWUnrecoverableDbErrors").isUnrecoverableDbErrorByName(a))return!0;return a==="update-required-fbid_change"||a==="update-required-vault_materials_change"?!0:!1}g.setPreventWorkerRestart=s;g.getOrSetupWorker=a;g.waitForWorkerSetup=e;g.terminateDedicatedWorker=w;g.terminateWorkerPermanently=f;g.killSharedWorker=x;g.terminateWorker=y}),98);
__d("MAWWorkerReboot",["EBIsEbEnabled","FBLogger","MAWBridgeObserver","MAWSetupWorker","MAWWaitForBackendSetup","ODS","QPLUserFlow","getErrorSafe","gkx","pageID","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){(h||(h=d("ODS"))).bumpEntityKey(3185,"armadillo_shared_worker_reboot","shared_worker_reboot_"+a)}var j=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker(),k=function(a){switch(a){case"bridge_recovery":return"bridgeRecovery";case"backend_setup_failure":return"backendSetupFailure"}};function a(a,b,e,f,g,h){c("QPLUserFlow").start(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,{annotations:{bool:{isSharedWorker:j},string:{trigger:g,workerInitPageID:c("pageID")}}});c("FBLogger")("messenger_web").info("Rebooting worker started.");i("start");d("MAWWaitForBackendSetup").resetBackendSetup();var l=k(g);c("QPLUserFlow").addPoint(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"terminate_worker_start");return new Promise(function(g,j){return d("MAWSetupWorker").terminateWorker(l).then(async function(){c("QPLUserFlow").addPoint(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"terminate_worker_end");c("FBLogger")("messenger_web").info("Reboot process killed existing worker successfully.");var j;if(c("gkx")("1458"))try{j=await d("EBIsEbEnabled").isEBEnabled()}catch(a){c("FBLogger")("wmi_eb").mustfix("Failed to get EB state during worker reboot: %s",c("getErrorSafe")(a).message),j=void 0}else j=void 0;return d("MAWSetupWorker").getOrSetupWorker(a,b,e,f,l,h,j).then(function(a){c("FBLogger")("messenger_web").info("Rebooting worker success. Reason for reboot: %s",l),i("success"),c("QPLUserFlow").endSuccess(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL),b(a),g()})}).catch(function(a){c("FBLogger")("messenger_web").info("Rebooting worker failed. Error message: %s",a.message),i("fail"),c("QPLUserFlow").endFailure(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,a.message),d("MAWWaitForBackendSetup").rejectBackendSetup(a),j(a)})})}g.rebootWorker=a}),98);
__d("MAWBridgeObserver",["FBLogger","MAWWaitForBackendSetup","MAWWorkerReboot","promiseDone","qex","qpl"],(function(a,b,c,d,e,f,g){"use strict";a=c("qpl")._(1056840252,"808");var h=5,i=[],j=!1,k,l=function(){i=[]};b=function(a){if(!o())return;if(d("MAWWaitForBackendSetup").isBackendSetupInProgress()){l();return}if(n().length>=h&&!d("MAWWaitForBackendSetup").isBackendSetupInProgress()){c("FBLogger")("messenger_web").info("Minimum threshold of unacked messages reached: %s. Unacked messages: %s",h,JSON.stringify(n()));var b=c("qex")._("440"),e=c("qex")._("468")||h;b===!0&&n().length>=e?(c("FBLogger")("messenger_web").info("QE threshold of unacked messages reached: %s. Unacked messages: %s",h,JSON.stringify(n())),l(),c("promiseDone")(m())):(c("FBLogger")("messenger_web").info("Bridge recovery attempt skipped. Reason for skipped: maw_bridge_recovery_v2_enabled: %s, maw_bridge_recovery_threshold: %s",b,e),i.push(a))}else i.push(a)};var m=function(){c("FBLogger")("messenger_web").info("Starting bridge recovery attempt.");return d("MAWWorkerReboot").rebootWorker(k.vaultMaterials,k.onWorkerConnect,k.onConnectToExistingWorker,k.onTerminateWorker,"bridge_recovery",k.updateWorkerState).then(function(){c("FBLogger")("messenger_web").info("Bridge recovery attempt successful. Worker has restarted.")},function(a){c("FBLogger")("messenger_web").info("Bridge recovery attempt failed. Worker has failed to restart. Error: %s",a.message);throw a})};e=function(a){j=!0,k=a};var n=function(){return i},o=function(){return j};f=function(){return k};g.BAD_STATE_RECOVERY_QPL=a;g.MIN_UNACKED_EVENTS_THRESHOLD=h;g.resetUnackedMessages=l;g.notifyUnackedEvent=b;g.attemptRecovery=m;g.initUnackedMessagesObserver=e;g.getUnackedMessages=n;g.getIsObserverActive=o;g.getProps=f}),98);
__d("MAWGetDBVersionForTest",["justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(){if(!c("justknobx")._("1495"))return;var a=new URL(document.location.href);a=a.searchParams.get("db_version");if(a==null)return;if(a==="current"||a==="latest")return a;a=parseInt(a,10);if(Number.isInteger(a))return Number(a)}g.getDbVersionForTest=a}),98);
__d("WADevToolMessageChannel",[],(function(a,b,c,d,e,f){"use strict";var g=new MessageChannel(),h;a=function(){g=new MessageChannel();h(g);return g};b=function(){return g};c=function(a){h=a,h(g)};f.createNewChannel=a;f.getMostRecentChannel=b;f.onCreateNewChannel=c}),66);
__d("MAWCommonSetupWorker",["Deferred","FBLogger","MAWCurrentUser","MAWGetDBVersionForTest","MAWInit","MAWMIC","MAWSetupWorker","MAWWaitForBackendSetup","MAWWebWorkerSingleton","MessengerWebInitData","Promise","WADevToolMessageChannel","WALogger","WorkerClient","WorkerMessagePort","err","gkx","pageID","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("gkx")("3282");e=function(a){function b(b,c){var e;e=a.call(this,b,c)||this;e.onmessage=null;e.$BridgeAdapter$p_1=b;d("WorkerClient").init(e);e.onUnhandledMessage.add(function(a){e.onmessage&&e.onmessage({data:a})});e.addMessageListener("worker-setup",function(a){a.status==="worker-ready"&&d("MAWInit").MAWInit.addBoolAnnotation("workerReadyReceived",!0)});return e}babelHelpers.inheritsLoose(b,a);var c=b.prototype;c.getBridgePort=function(){return this};return b}(d("WorkerMessagePort").WorkerSyncedMessagePort);function a(a){var b=a.bridge,e=a.ebState,f=a.reason,g=a.vaultMaterials,h=new(c("Deferred"))();b.addMessageListener("worker-setup",function(b){return k(a,h,b)});b.addMessageListener("worker-setup-ack",function(a){return l(a,f)});n(b,g,e);c("promiseDone")(d("MAWWebWorkerSingleton").doesWorkerExist(),function(a){return d("MAWInit").MAWInit.addBoolAnnotation("workerExistsOnSetup",a)});c("promiseDone")(d("MAWWebWorkerSingleton").getWorkerHealthStatus(),function(a){return d("MAWInit").MAWInit.addStringAnnotation("workerHealthStatus",a.tag)});return h.getPromise()}function k(a,b,e){var f;if(e.setupHash!==c("pageID"))return;switch(e.status){case"success":b.resolve(a.bridge.getBridgePort());break;case"failure":b.reject(c("err")((f=e.msg)!=null?f:"Error setting up worker"));break;case"already-setup":return m(a,b,e);default:d("MAWInit").MAWInit.addBoolAnnotation("invalidSetupMessageReceived",!0);throw c("FBLogger")("messenger_web").mustfixThrow("Invalid message for worker: "+e.status)}}function l(a,b){if(a.setupHash!==c("pageID"))return;d("MAWInit").MAWInit.logPoint(b+"_backend_setup_ack");d("MAWMIC").addPoint(b+"_backend_setup_ack");a=(b=a.backendState)!=null?b:"none";d("MAWInit").MAWInit.addStringAnnotation("backendAckState",a);d("MAWMIC").addStringAnnotation("backendAckState",a)}function m(a,e,f){var g=a.bridge,j=a.onWorkerAlreadySetup,k=a.onWorkerRestart;a=a.reason;switch(f.action){case"no-action":e.resolve(g.getBridgePort());j();d("MAWInit").MAWInit.logPoint(a+"_backend_already_setup");d("MAWMIC").addPoint(a+"_backend_already_setup");break;case"reboot-required":d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Terminating worker and rebooting..."])));d("MAWMIC").addPoint(a+"_worker_rebooting");d("MAWInit").MAWInit.logPoint(a+"_worker_rebooting");j=(g=f==null?void 0:f.reason)!=null?g:"none";d("MAWInit").MAWInit.addStringAnnotation("workerRebootReason",j);d("MAWMIC").addStringAnnotation("workerRebootReason",j);a=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()?(i||(i=b("Promise"))).resolve(d("MAWWaitForBackendSetup").resetCurrentWorkerWithId(d("MAWWaitForBackendSetup").getCurrentWorkerID())):d("MAWSetupWorker").terminateDedicatedWorker("reboot required");return a.then(function(){return k("rebootRequired").then(function(a){return e.resolve(a)})["catch"](function(a){return e.reject(a)})});default:f.action;throw c("FBLogger")("messenger_web").mustfixThrow("Invalid action for worker-setup:already-setup: "+f.action)}}function n(a,b,e){e={content:{createdAt:c("MessengerWebInitData").createdAt,ebState:e,fbId:d("MAWCurrentUser").getID(),sessionId:c("MessengerWebInitData").sessionId,testDbVersion:d("MAWGetDBVersionForTest").getDbVersionForTest(),userKeyBase:c("MessengerWebInitData").userKeyBase,vaultMaterials:b},setupHash:c("pageID"),type:"worker-setup"};if(j){d("MAWInit").MAWInit.addBoolAnnotation("devToolsEnabled",!0);b=d("WADevToolMessageChannel").createNewChannel();e.content.devToolMessageChannelPort2=b.port2;a.postMessage(e,[b.port2])}else a.postMessage(e)}g.BridgeAdapter=e;g.initWorker=a}),98);
__d("MAWJids",["I64","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h;e=d("WAJids").createJidUtils({platform:"msgr"});var i=e.toUserJid,j=function(a,b){a=(h||(h=d("I64"))).to_string(a);return b?d("WAJids").toGroupJid(a):i(a)};function a(a){return j(a,!1)}function b(a){return j(a,!0)}f=function(a){a=d("WAJids").threadIdForChatJid(a);return(h||(h=d("I64"))).of_string(a)};function c(a){return d("WAJids").unsafeCoerceToChatJid(a)}g.jidUtils=e;g.toUserJid=i;g.convertIntJidToChatJid=j;g.convertIntJidToOneToOneChatJid=a;g.convertIntJidToGroupJid=b;g.convertChatJidToIntJid=f;g.threadIdToChatJid=c}),98);
__d("MAWMiActMappingTableAPI",["I64","LSMessagingThreadTypeUtil","MAWJids","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){return b==null?Promise.resolve(null):d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table).getKeyRange(b))}function a(a,b,c){return i(a,b).then(function(a){a=a==null?void 0:a.jid;return a==null?null:d("MAWJids").convertIntJidToChatJid(a,d("LSMessagingThreadTypeUtil").isGroup(c))})}function b(a,b){return k(a,b).then(function(a){return a==null?void 0:a.serverThreadKey})}function j(a,b){return b==null?Promise.resolve(null):d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table.index("jid")).getKeyRange(b))}function k(a,b){return j(a,d("MAWJids").convertChatJidToIntJid(b))}async function c(a,b){var c=b.intJid;b=b.threadKey;b=await i(a,b);return b!=null?b:j(a,c)}function l(a){return(h||(h=d("I64"))).le(a,h.zero)}function e(a,b){return a.tables.mi_act_mapping_table.subscribe(function(a,c){var d=a[0],e=a[1];a[2];a=c.operation;a==="delete"&&!l(e)&&b(e,d)})}g.getMappingRowForThreadKey=i;g.getChatJidForThreadKey=a;g.getThreadKeyForChatJid=b;g.getMappingRowForIntJid=j;g.getMappingRowForChatJid=k;g.getMappingRowForThreadKeyOrJid=c;g.subscribeToMappingDeletion=e}),98);
__d("MAWMessageRequestUtil",["I64","LSContactBitOffset","LSContactViewerRelationship","LSIntEnum","LSMessagingThreadTypeUtil","MWFBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,e){if(a==="pending"||a==="other"){d("MWFBLogger").MWLogger().debug("isMessagerRequestV2 returns true: folderName is "+a+", contactViewerRelationship is "+(h||(h=d("I64"))).to_string(e.contactViewerRelationship));return!0}var f=d("LSContactBitOffset").hasWithDefault(64,e,!0);if(a==="inbox"&&(h||(h=d("I64"))).equal(e.contactViewerRelationship,(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactViewerRelationship").NOT_CONTACT))&&!f){b&&d("MWFBLogger").MWLogger().debug("isMessagerRequestV2 returns true: folderName is inbox, contactViewerRelationship is "+(h||(h=d("I64"))).to_string(e.contactViewerRelationship)+", isViewerUnconnected is false, hasActivity is true");return b}return!1}function k(a){return a==="pending"||a==="other"}function a(a){return d("LSMessagingThreadTypeUtil").isOneToOne(a.threadType)?k(a.folderName):!1}function l(a,b){return b!=null?j(a.folderName,(h||(h=d("I64"))).gt(a.lastActivityTimestampMs,h.zero),b[1]):!1}function b(a,b){return d("LSMessagingThreadTypeUtil").isOneToOne(a.threadType)?l(a,b):!1}function e(a){return d("LSMessagingThreadTypeUtil").isGroup(a.threadType)?k(a.folderName):!1}f=[8,18,19,34,24,25,122];var m=[21,48];g.isMessageRequestV2=j;g.isOneOnOneMessageRequest=a;g.isOneOnOneMessageRequestV2=b;g.isGroupMessageRequest=e;g.disabledThreadCapabilitiesForIncomingRequest=f;g.enabledThreadCapabilitiesForIncomingRequest=m}),98);
__d("clearedMAWMnRestrictCapabilities",[],(function(a,b,c,d,e,f){"use strict";a=[0,31,35,55,56,58,24,25,35,19];b=a;f["default"]=b}),66);
__d("MAWUpdateLSThreadCapabilities",["fbt","I64","LSBitOffset","LSContactBitOffset","LSContactBlockedByViewerStatus","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MAWBlockUtils","MAWCurrentUser","MAWMessageRequestUtil","ReQL","clearedMAWMnRestrictCapabilities","emptyFunction"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=d("MAWCurrentUser").getID(),l=(i||(i=d("I64"))).of_string(k);function a(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b)).then(function(b){if(b==null)return Promise.resolve();var c=d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(27),b.capabilities);b=babelHelpers.extends({},b,{capabilities:c});return a.threads.put(b)}).then(c("emptyFunction"))}function b(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b)).then(function(b){if(b==null)return Promise.resolve();var c=d("LSBitOffset").clear((j||(j=d("LSIntEnum"))).ofNumber(27),b.capabilities);b=babelHelpers.extends({},b,{capabilities:c});return a.threads.put(b)}).then(c("emptyFunction"))}function e(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b)).then(function(c){if(c==null)return Promise.resolve([void 0,void 0]);var e=d("ReQL").firstAsync(d("LSMessagingThreadTypeUtil").isOneToOne(c.threadType)?d("ReQL").mergeJoin(d("ReQL").fromTableAscending(a.participants).getKeyRange(b),d("ReQL").fromTableAscending(a.contacts)).filter(function(a){a=a[1];return!(i||(i=d("I64"))).equal(a.id,l)}).map(function(a){a=a[1];return a}):d("ReQL").empty());return Promise.all([Promise.resolve(c),e])}).then(function(b){var e=b[0];if(e==null)return Promise.resolve();b=b[1];if(b==null)return Promise.resolve();var f=(i||(i=d("I64"))).equal(b.blockedByViewerStatus,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactBlockedByViewerStatus").MESSAGE_BLOCKED)),g=i.equal(b.blockedByViewerStatus,j.ofNumber(c("LSContactBlockedByViewerStatus").FULLY_BLOCKED));b=d("LSContactBitOffset").has(66,b);g=g?d("LSThreadBitOffset").clear(d("MAWBlockUtils").clearedFbBlockCapabilities,e.capabilities,e.capabilities2,e.capabilities3,e.capabilities4,e.capabilities5):f?d("LSThreadBitOffset").clear(d("MAWBlockUtils").clearedMnBlockCapabilities,e.capabilities,e.capabilities2,e.capabilities3,e.capabilities4,e.capabilities5):b?d("LSThreadBitOffset").clear(c("clearedMAWMnRestrictCapabilities"),e.capabilities,e.capabilities2,e.capabilities3,e.capabilities4,e.capabilities5):[e.capabilities,e.capabilities2,e.capabilities3,e.capabilities4,e.capabilities5];f=g[0];b=g[1];var h=g[2],k=g[3];g=g[4];return a.threads.put(babelHelpers.extends({},e,{capabilities:f,capabilities2:b,capabilities3:h,capabilities4:k,capabilities5:g})).then(c("emptyFunction"))})}async function f(a,b){a=a.threads;b=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(b));if(b==null)return Promise.resolve();var c=d("LSThreadBitOffset").set.apply(d("LSThreadBitOffset"),[d("MAWMessageRequestUtil").disabledThreadCapabilitiesForIncomingRequest].concat(d("LSThreadBitOffset").clear(d("MAWMessageRequestUtil").enabledThreadCapabilitiesForIncomingRequest,b.capabilities,b.capabilities2,b.capabilities3,b.capabilities4,b.capabilities5))),e=c[0],f=c[1],g=c[2],h=c[3];c=c[4];await a.put(babelHelpers.extends({},b,{additionalThreadContext:void 0,capabilities:e,capabilities2:f,capabilities3:g,capabilities4:h,capabilities5:c}))}async function m(a,b,c){b=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b));if(b==null)return;c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts,["name"]).getKeyRange(c));if(c==null)return;c=h._(/*BTDS*/"{Inviter Name} invited you to join",[h._param("Inviter Name",c.name)]).toString();var e=d("LSThreadBitOffset").set([105],b.capabilities,b.capabilities2,b.capabilities3,b.capabilities4,b.capabilities5),f=e[0],g=e[1],i=e[2],j=e[3];e=e[4];await a.threads.put(babelHelpers.extends({},b,{capabilities:f,capabilities2:g,capabilities3:i,capabilities4:j,capabilities5:e,snippet:c}))}async function n(a,b){var c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b));if(c==null)return;b=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.group_invites).getKeyRange(b));var e=d("LSThreadBitOffset").clear([105],c.capabilities,c.capabilities2,c.capabilities3,c.capabilities4,c.capabilities5),f=e[0],g=e[1],h=e[2],i=e[3];e=e[4];await a.threads.put(babelHelpers.extends({},c,{capabilities:f,capabilities2:g,capabilities3:h,capabilities4:i,capabilities5:e,snippet:void 0}));await b.map(async function(b){await a.group_invites.delete(b.threadKey,b.inviterId,b.inviteeId)})}g.enableAddMembersTxn=a;g.disableAddMembersTxn=b;g.disableBlockerCapabilitiesTxn=e;g.updateNonMessageRequestThreadTxn=f;g.setGroupInviteTxn=m;g.clearGroupInviteTxn=n}),226);
__d("uniqueArray",[],(function(a,b,c,d,e,f){"use strict";function g(a){return a}function a(a,b){var c=b!=null?b:g,d=[],e=new Set();a.forEach(function(a){var b=c(a);if(e.has(b))return;e.add(b);d.push(a)});return d}f["default"]=a}),66);
__d("MAWBridgeParticipantsUpdatedHandler",["fbt","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","MAWCurrentUser","MAWJids","MAWMiActMappingTableAPI","MAWUpdateLSThreadCapabilities","uniqueArray"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=d("MAWCurrentUser").getID(),l=(i||(i=d("I64"))).of_string(k);function a(a,b){b=b.map(function(a){var b=a.chatJid,c=a.type;a=a.userJid;return babelHelpers.extends({chatJid:b},s(c),{userJid:a})});return m(a,b)}function b(a,b){b=b.participants.map(function(a){return{chatJid:a.threadJid,isAdmin:a.isAdmin,isInvited:a.isInvited,isSuperAdmin:a.isSuperAdmin,userJid:d("MAWJids").toUserJid(a.fbid)}});return m(a,b)}async function m(a,b){b=await o(a,b);await Promise.all(b.map(function(b){var c=b.mawParticipant,e=b.threadKey,f=d("MAWJids").convertChatJidToIntJid(c.userJid);return[a.participants.get(e,f).then(function(b){var d=q(b,c,e);return b!=null?a.participants.put(d):Promise.all([a.participants.add(d),n(a,f)])}),p(a,f,e,c.isAdmin)]}).flat(Infinity))}async function n(a,b){await c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(a),{authorityLevel:(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:j.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:j.ofNumber(c("LSContactIdType").FBID),contactType:j.ofNumber(c("LSContactType").USER),contactViewerRelationship:j.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:j.ofNumber(c("LSContactGender").UNKNOWN),id:b,isBlocked:!1,isMemorialized:!1,isSelf:k===(i||(i=d("I64"))).to_string(b),workForeignEntityType:j.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)})}async function o(a,b){var e=c("uniqueArray")(b.map(function(a){return a.chatJid})),f=new Map();await Promise.all(e.map(function(b){return d("MAWMiActMappingTableAPI").getThreadKeyForChatJid(a,b).then(function(a){return a!=null&&f.set(b,a)})}));return b.map(function(a){var b=f.get(a.chatJid);return b==null?null:{mawParticipant:a,threadKey:b}}).filter(Boolean)}async function p(a,b,c,e){await d("MAWUpdateLSThreadCapabilities").disableBlockerCapabilitiesTxn(a,c),(i||(i=d("I64"))).equal(l,b)&&(e?await d("MAWUpdateLSThreadCapabilities").enableAddMembersTxn(a,c):await d("MAWUpdateLSThreadCapabilities").disableAddMembersTxn(a,c))}function q(a,b,c){return a==null?babelHelpers.extends({},r(b),{authorityLevel:(i||(i=d("I64"))).zero,contactId:d("MAWJids").convertChatJidToIntJid(b.userJid),deliveredWatermarkTimestampMs:i.zero,isSuperAdmin:b.isSuperAdmin,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:i.zero,readWatermarkTimestampMs:i.zero,threadKey:c,threadRoles:i.zero}):babelHelpers.extends({},a,r(b))}function r(a){return{groupParticipantJoinState:a.isInvited?(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").INVITED):(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:a.isAdmin,isModerator:!1,subscribeSource:a.isSuperAdmin?h._(/*BTDS*/"Group creator").toString():void 0}}function s(a){return{isAdmin:a==="superadmin"||a==="admin",isInvited:a==="invitedParticipant",isSuperAdmin:a==="superadmin"}}g.callFromMainThread=a;g.call=b;g.mawToLsParticipantTypeConversion=s}),226);
__d("MAWFolderTypes",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;e=10;var g=15,h={ARCHIVED:e,INBOX:a,OTHER:c,PENDING:b,RESTRICTED:g,SPAM:d};f.INBOX=a;f.PENDING=b;f.OTHER=c;f.SPAM=d;f.ARCHIVED=e;f.RESTRICTED=g;f.FOLDER_ID=h}),66);
__d("MAWMiActGetMappingWithMawTypes",["I64","MAWJids","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c=(h||(h=d("I64"))).to_string(a.jid);b=b?d("WAJids").toGroupJid(c):d("MAWJids").toUserJid(c);return{clientThreadPk:a.clientThreadPk,jid:b,serverThreadKey:a.serverThreadKey}}g["default"]=a}),98);
__d("MAWMiActThreadLifecycleState__DO_NOT_USE",[],(function(a,b,c,d,e,f){"use strict";a={AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW:"AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW",AUTHORITATIVE_THREAD_ONLY:"AUTHORITATIVE_THREAD_ONLY",CLIENT_PARTIAL_MI_THREAD:"CLIENT_PARTIAL_MI_THREAD",CLIENT_PARTIAL_MI_THREAD_WITH_ACT:"CLIENT_PARTIAL_MI_THREAD_WITH_ACT",JID_MISSING_MAPPING_ROW:"JID_MISSING_MAPPING_ROW",JID_MISSING_MI_THREAD:"JID_MISSING_MI_THREAD",MI_AND_ACT_THREAD_COMPLETE:"MI_AND_ACT_THREAD_COMPLETE",OPTIMISTIC_THREAD_NO_ACT:"OPTIMISTIC_THREAD_NO_ACT",OPTIMISTIC_THREAD_WITH_ACT:"OPTIMISTIC_THREAD_WITH_ACT",SERVER_PARTIAL_MI_THREAD:"SERVER_PARTIAL_MI_THREAD",THREAD_KEY_ONLY:"THREAD_KEY_ONLY"};f.MiActThreadStatesEnum=a}),66);
__d("MWLogSendToSentFailedError",["FBLogger","QuickPerformanceLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,d,e,f){var g,i,j,k=a.qplEventType;a=a.qplInstanceKey;k=(h||(h=c("QuickPerformanceLogger"))).getMarker(k,a);a=k==null||(g=k.annotations)==null||(g=g.bool)==null?void 0:g.is_secure;c("FBLogger")("messenger_web_messaging","send_to_sent_failed").blameToPreviousFrame().blameToPreviousFrame().warn("send_to_sent failed with reason: %s. Caught error message: %s. Additional description: %s. Secure? %s. Error Code: %s. Application Error: %s.",b,(b=d==null?void 0:d.message)!=null?b:"",(b=(d=k==null||(i=k.annotations)==null||(i=i.string)==null?void 0:i.error_description)!=null?d:k==null||(j=k.annotations)==null||(j=j.string)==null?void 0:j.errorType)!=null?b:"",a===!0?"secure":a===!1?"open":"unknown",(d=e==null?void 0:e.toString())!=null?d:"",(k=f==null?void 0:f.toString())!=null?k:"")}g["default"]=a}),98);
__d("MWMsgMediaTypeLogUtils",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum")({Application:"application",Audio:"audio",Avatar:"avatar",HotEmoji:"hot_emoji",File:"file",Gif:"gif",Image:"image",Link:"link",None:"none",Poll:"poll",Reaction:"reaction",Sticker:"sticker",Video:"video",Share:"share",NoteReply:"note_reply"});function a(a){var b=a.hasFile;b=b===void 0?!1:b;var c=a.hasGif;c=c===void 0?!1:c;var d=a.hasHotEmoji;d=d===void 0?!1:d;var e=a.hasImage;e=e===void 0?!1:e;var f=a.hasLinks;f=f===void 0?!1:f;var h=a.hasNoteReply;h=h===void 0?!1:h;var i=a.hasShare;i=i===void 0?!1:i;var j=a.hasSticker;j=j===void 0?!1:j;var k=a.hasVideo;k=k===void 0?!1:k;a=a.hasVoiceClip;a=a===void 0?!1:a;var l=g.None;e?l=g.Image:k?l=g.Video:d?l=g.HotEmoji:j?l=g.Sticker:c?l=g.Gif:a?l=g.Audio:b?l=g.File:i?l=g.Share:f?l=g.Link:h&&(l=g.NoteReply);return l}f.AttachmentType=g;f.getAttachmentType=a}),66);
__d("MWGetOriginalEntrypoint",["I64","InteractionTracingMetrics","MWChatInteraction"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b,e,f,g=d("MWChatInteraction").get((h||(h=d("I64"))).to_string(a));g=g!=null?c("InteractionTracingMetrics").get(g):null;b=(b=g==null||(e=g.annotations.string)==null?void 0:e.inboxEntrypoint)!=null?b:g==null||(f=g.annotations.string)==null?void 0:f.entrypoint;if(b!=null&&b!=="unknown")return b;g=d("MWChatInteraction").get("inbox_init");if(g!=null&&(h||(h=d("I64"))).equal(a,(h||(h=d("I64"))).of_string(g)))return"initInbox";b=d("MWChatInteraction").get(d("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);b=b!=null?(g=c("InteractionTracingMetrics").get(b))==null||(g=g.annotations.string)==null?void 0:g.thread_id:null;return b===(h||(h=d("I64"))).to_string(a)?"auto_open":"unknown"}g["default"]=a}),98);
__d("MWMsgActionLogUtils",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum")({Send:"send",Reaction:"reaction",Reply:"reply",Forward:"forward",Share:"share",StoryReply:"story-reply",Unsend:"unsend",GroupInvite:"group-invite",SenderKeyDistribution:"sender-key-distribution",EphemeralSetting:"ephemeral-setting",Edit:"edit",Bump:"bump",Retry:"retry"});function a(a){var b=a.hasEphemeralSetting;b=b===void 0?!1:b;var c=a.hasGroupInvite;c=c===void 0?!1:c;var d=a.hasReaction;d=d===void 0?!1:d;var e=a.hasReply;e=e===void 0?!1:e;var f=a.hasSenderKeyDistribution;f=f===void 0?!1:f;var h=a.hasStoryReply;h=h===void 0?!1:h;var i=a.isBump;i=i===void 0?!1:i;var j=a.isEdit;j=j===void 0?!1:j;var k=a.isForward;k=k===void 0?!1:k;var l=a.isRetry;l=l===void 0?!1:l;a=a.isUnsend;a=a===void 0?!1:a;var m=g.Send;e?m=g.Reply:h?m=g.StoryReply:a?m=g.Unsend:d?m=g.Reaction:c?m=g.GroupInvite:b?m=g.EphemeralSetting:f?m=g.SenderKeyDistribution:j?m=g.Edit:k?m=g.Forward:i?m=g.Bump:l&&(m=g.Retry);return m}f.ActionType=g;f.getActionType=a}),66);
__d("MWHasLinksUtil",["URLMatcher","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("isStringNullOrEmpty")(a)?!1:c("URLMatcher").match(a)!=null}g.getHasLinks=a}),98);
__d("MWVersion",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;a=(h||d("I64")).of_string("2");g.v2=a}),98);
__d("MWSharedS2SBaseAnnotations",["$InternalEnum","I64","LSMessagingThreadAttributionType","LSMessagingThreadTypeUtil","MWHasLinksUtil","MWMsgActionLogUtils","MWMsgMediaTypeLogUtils","MWPreloadableQueries","MWVersion","MultipleTabsLogger","ReQL","gkx","isStringNullOrEmpty","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h=["hasAttachment","hasEphemeralSetting","hasGroupInvite","hasReaction","hasReply","hasSenderKeyDistribution","hasStoryReply","hasText","isBump","isEdit","isForward","isRetry","isUnsend"],i=["db","threadKey"],j,k=b("$InternalEnum")({Text:"text",NonText:"non-text"});async function a(a,b,e,f,g){var i=a.hasAttachment;i=i===void 0?!1:i;var m=a.hasEphemeralSetting,n=a.hasGroupInvite,o=a.hasReaction,p=a.hasReply,q=a.hasSenderKeyDistribution,r=a.hasStoryReply,s=a.hasText;s=s===void 0?!1:s;var t=a.isBump,u=a.isEdit,v=a.isForward,w=a.isRetry,x=a.isUnsend;a=babelHelpers.objectWithoutPropertiesLoose(a,h);g===void 0&&(g=!1);m=d("MWMsgActionLogUtils").getActionType({hasEphemeralSetting:m,hasGroupInvite:n,hasReaction:o,hasReply:p,hasSenderKeyDistribution:q,hasStoryReply:r,isBump:t,isEdit:u,isForward:v,isRetry:w,isUnsend:x});n=d("MWMsgMediaTypeLogUtils").getAttachmentType(a);o=s&&(!n||n===d("MWMsgMediaTypeLogUtils").AttachmentType.None)?k.Text:k.NonText;p=f!=null?parseInt(f,10):void 0;isNaN(p)&&(p=void 0);return{bool:{has_attachment:i,has_sticker:a.hasSticker,has_text:s,is_attachments_grouped:a.isAttachmentsGrouped,is_pdb:Boolean(c("gkx")("8483")),is_pwa:g,is_tlc_public_user:c("gkx")("24028"),use_maw_shared_worker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()},int:{number_of_attachments:a.numberOfAttachments,number_of_grouped_attachments:a.numberOfGroupedAttachments,offline_threading_id:p},string:{action_type:m,attachment_type:n,entrypoint:l(b),message_type:o,multipleTabs:await d("MultipleTabsLogger").getMultipleTabsAnnotation(),mw_version:(j||(j=d("I64"))).to_string(d("MWVersion").v2),offline_threading_id:f,root_component:e}}}function l(a){var b;return(b=Object.keys(c("LSMessagingThreadAttributionType")).find(function(b){return c("LSMessagingThreadAttributionType")[b]===a}))!=null?b:"UNKNOWN"}async function e(a){var b=a.db,c=a.threadKey;a=babelHelpers.objectWithoutPropertiesLoose(a,i);b=b!=null&&c!=null?await d("ReQL").toArrayAsync(d("MWPreloadableQueries").getMediaStagingQuery(b,c)):[];return{mediaStagings:b,messageTypeParams:m(babelHelpers.extends({},a,{mediaStagings:b}))}}function m(a){var b=a.externalAttachmentUrl,e=a.hotEmojiSize,f=a.isBump,g=a.isEdit,h=a.isEphemeralSetting,i=a.isForward,j=a.isGroupInvite,k=a.isReaction,l=a.isRetry,m=a.isSenderKeyDistribution,n=a.isUnsend,o=a.mediaGroupInfo,p=a.mediaStagings,q=a.messageText,r=a.reply,s=a.sentFromShareSheet,t=a.stickerId,u=a.threadType;a=a.voiceClip;var v=!c("isStringNullOrEmpty")(q);q=d("MWHasLinksUtil").getHasLinks(q);var w=!1;a=a!=null;a?w=!0:b!=null&&(w=!0);var x=!1,y=!1,z=!1,A=0,B=0,C;if(p!=null&&p.length>0){w=!0;for(var D of p){var E=D.mimeType;E.indexOf("image")!==-1&&(x=!0);E.indexOf("video")!==-1&&(y=!0);E.indexOf("application")!==-1&&(z=!0)}if(x&&u!=null){E=d("LSMessagingThreadTypeUtil").isArmadilloSecure(u);C=!E}A=p.length}o!=null&&(C=!0,B=o.messagesAndAttachments.length);D=e!=null;u=r!=null;E=r!=null;p=t!=null&&!D;o=!p&&b!=null;e=s===!0;r=k===!0;t=j===!0;b=h===!0;s=m===!0;return{hasAttachment:w,hasEphemeralSetting:b,hasFile:z,hasGif:o,hasGroupInvite:t,hasHotEmoji:D,hasImage:x,hasLinks:q,hasReaction:r,hasReply:u,hasSenderKeyDistribution:s,hasShare:e,hasSticker:p,hasStoryReply:E,hasText:v,hasVideo:y,hasVoiceClip:a,isAttachmentsGrouped:C,isBump:f!=null?f:!1,isEdit:g!=null?g:!1,isForward:i!=null?i:!1,isRetry:l!=null?l:!1,isUnsend:n!=null?n:!1,numberOfAttachments:A,numberOfGroupedAttachments:B}}g.MsgType=k;g.getSendToSentBaseAnnotations=a;g.getEntrypointAnnotation=l;g.queryMediaStagingAndGetMessageTypeParams=e;g.getMessageTypeParams=m}),98);
__d("MWSharedMsgLogUtils",["$InternalEnum","I64","IGDInteractionTraceAnnotations","LSIntEnum","LSMessagingThreadTypeUtil","MAWEBSwitch","MWGetOriginalEntrypoint","MWMsgActionLogUtils","MWMsgMediaTypeLogUtils","MWSharedS2SBaseAnnotations","MultipleTabsLogger","cr:6985","gkx","isArmadillo","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=b("$InternalEnum")({Text:"text",NonText:"non-text"});async function a(a){var e=a.attachmentTypeParams,f=a.composerEntrypoint,g=a.isPwa,i=a.messageOfflineThreadingId,j=a.source;a=a.thread;var k=b("cr:6985")!=null?await b("cr:6985").isCutoverThreadKey(a.threadKey):!1;e=await d("MWSharedS2SBaseAnnotations").getSendToSentBaseAnnotations(e,j,f,i,g);return{bool:babelHelpers.extends({},e.bool,d("IGDInteractionTraceAnnotations").getInstamadilloBooleanAnnotations(a),{is_community_event:a.eventStartTimestampMs!=null,is_cutover:c("isArmadillo")()&&k,is_message_request:d("LSMessagingThreadTypeUtil").isMessageRequest(a),is_secure:d("LSMessagingThreadTypeUtil").isArmadilloSecure(a.threadType)}),int:babelHelpers.extends({},e.int),string:babelHelpers.extends({},e.string,{consistent_thread_fbid:a.consistentThreadFbid!=null?(h||(h=d("I64"))).to_string(a.consistentThreadFbid):null,original_entrypoint:c("MWGetOriginalEntrypoint")(a.threadKey),thread_id:(h||(h=d("I64"))).to_string(a.threadKey),thread_subtype:a.threadSubtype!=null?(h||(h=d("I64"))).to_string(a.threadSubtype):null,thread_type:h.to_string(a.threadType)})}}function e(a,b,e,f){k(a,b,c("MWGetOriginalEntrypoint")(e.threadKey),e.threadKey,e.consistentThreadFbid,e.threadType,e.threadSubtype,f),d("IGDInteractionTraceAnnotations").addInstamadilloAnnotationsToInteractionTrace(e,a)}function k(a,e,f,g,i,k,l,m){var n=e.hasEphemeralSetting;n=n===void 0?!1:n;var o=e.hasFile;o=o===void 0?!1:o;var p=e.hasGif;p=p===void 0?!1:p;var q=e.hasGroupInvite;q=q===void 0?!1:q;var r=e.hasHotEmoji;r=r===void 0?!1:r;var s=e.hasImage;s=s===void 0?!1:s;var t=e.hasLinks;t=t===void 0?!1:t;var u=e.hasReaction;u=u===void 0?!1:u;var v=e.hasReply;v=v===void 0?!1:v;var w=e.hasSenderKeyDistribution;w=w===void 0?!1:w;var x=e.hasShare;x=x===void 0?!1:x;var y=e.hasSticker;y=y===void 0?!1:y;var z=e.hasStoryReply;z=z===void 0?!1:z;var A=e.hasText;A=A===void 0?!1:A;var B=e.hasVideo;B=B===void 0?!1:B;var C=e.hasVoiceClip;C=C===void 0?!1:C;var D=e.isAttachmentsGrouped,E=e.isBump;E=E===void 0?!1:E;var F=e.isEdit;F=F===void 0?!1:F;var G=e.isForward;G=G===void 0?!1:G;var H=e.isRetry;H=H===void 0?!1:H;var I=e.isUnsend;I=I===void 0?!1:I;var J=e.numberOfAttachments;J=J===void 0?0:J;e=e.numberOfGroupedAttachments;e=e===void 0?0:e;n=d("MWMsgActionLogUtils").getActionType({hasEphemeralSetting:n,hasGroupInvite:q,hasReaction:u,hasReply:v,hasSenderKeyDistribution:w,hasStoryReply:z,isBump:E,isEdit:F,isForward:G,isRetry:H,isUnsend:I});q=d("MWMsgMediaTypeLogUtils").getAttachmentType({hasFile:o,hasGif:p,hasHotEmoji:r,hasImage:s,hasLinks:t,hasShare:x,hasSticker:y,hasVideo:B,hasVoiceClip:C,numberOfAttachments:J,numberOfGroupedAttachments:e});u=A&&(!q||q===d("MWMsgMediaTypeLogUtils").AttachmentType.None)?j.Text:j.NonText;d("MultipleTabsLogger").addAnnotationWithInteractionUuid(a.getTraceId());a.addAnnotation("attachment_type",q);a.addAnnotation("action_type",n);a.addAnnotation("message_type",u);a.addAnnotation("original_entrypoint",f);m!=null&&a.addAnnotation("root_component",m);a.addAnnotationInt("number_of_attachments",J);D!=null&&a.addAnnotationBoolean("is_attachments_grouped",D);a.addAnnotation("thread_id",(h||(h=d("I64"))).to_string(g));i!=null&&a.addAnnotation("consistent_thread_fbid",(h||(h=d("I64"))).to_string(i));a.addAnnotation("thread_type",h.to_string(k));l!=null&&a.addAnnotation("thread_subtype",(h||(h=d("I64"))).to_string(l));b("cr:6985")!=null&&c("promiseDone")(b("cr:6985").isCutoverThreadKey(g),function(b){a.addAnnotationBoolean("is_cutover",b)});a.addAnnotationBoolean("is_secure",d("LSMessagingThreadTypeUtil").isArmadilloSecure(k));a.addAnnotationBoolean("is_eb_enabled",c("MAWEBSwitch").isEnabled());a.addAnnotationBoolean("use_maw_shared_worker",d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker());a.addAnnotationBoolean("is_pdb",Boolean(c("gkx")("8483")))}function f(a){if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(2)))return"media";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4)))return"audio";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4096))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(134217728)))return"sticker";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(16384)))return"gif";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(64)))return"file";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(1)))return"text";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(1024))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(536870912)))return"XMA";else return"unknown"}g.MsgType=j;g.getSendToSentAnnotations=a;g.addSendMessageMetadataForInteractionTrace=e;g.addSendMessageMetadataForInteractionTraceWithThreadMetadata=k;g.getMessageTypeFromDisplayedContentType=f}),98);
__d("sendToSentQPLLogger",["LSDatabaseSingleton","LSIntEnum","MAWMIC","MAWSetupWorkerAuxStateForLogging","MAWWaitForBackendSetup","MWLogSendToSentFailedError","MWMsgMediaTypeLogUtils","MWSharedMsgLogUtils","MWSharedS2SBaseAnnotations","Network","QPLEvent","QPLUserFlow","QuickPerformanceLogger","Random","ReQL","WAExceededStorageQuota","WAGetSafeQPLError","WAGetStorageQplAnnotations","gkx","interaction-tracing","justknobx","mergeDeep","pageID","performance","promiseDone","qpl","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=c("requireDeferred")("MAWWebWorkerSingleton").__setRef("sendToSentQPLLogger"),n=c("qpl")._(25313175,"1551"),o=new Map();function p(a,b){c("QPLUserFlow").addAnnotations(n,b,{instanceKey:a})}function a(a,b){c("QPLUserFlow").endCancel(n,{annotations:b!=null?b:{},instanceKey:a}),u(a)}function b(a,b,e,f){b=f!=null?f.type:b;c("MWLogSendToSentFailedError")({qplEventType:n,qplInstanceKey:a},b,e,f==null?void 0:f.errorCode,f==null?void 0:f.applicationErrorCode);c("QPLUserFlow").endFailure(n,b,{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),useSentBytesCache:c("gkx")("33008"),wasBackendSetupReset:d("MAWWaitForBackendSetup").wasBackendSetupReset(),workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},string:{errorDescription:d("WAGetSafeQPLError").getSafeQPLErrorMessage(e)},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},error:e,instanceKey:a});u(a)}function q(a,b,d,e){a!=null&&c("QPLUserFlow").addPoint(n,b,{data:e,debugInfo:d,instanceKey:a})}function r(a){(k||(k=c("QuickPerformanceLogger"))).markerEnd(n,160,a),u(a)}function s(a,b){q(a,b?"network_connection_online":"network_connection_offline"),b||r(a)}function t(a){var b=c("interaction-tracing").NetworkStatusTracker.onChange(function(b){b=b.online;s(a,b)});o.set(a,b);s(a,c("interaction-tracing").NetworkStatusTracker.isOnline());if(c("Network").containsNetworkInformation()){b=c("Network").getRTT();b!=null&&p(a,{int:{network_rtt:b}});b=c("Network").getEffectiveType();b!=null&&p(a,{string:{network_effective_type:String(b)}});var d=c("Network").getBandwidth();d!=null&&p(a,{int:{network_bandwidth:d}});d=c("Network").getType();d!=null&&p(a,{string:{network_connectivity_type:String(b)}})}}function u(a){var b;(b=o.get(a))==null||b.remove();o.delete(a)}function v(a){window.navigator&&window.navigator.hardwareConcurrency&&p(a,{int:{hardware_concurrency:window.navigator.hardwareConcurrency}})}function w(a,b){a===void 0&&(a=!0);var e=Date.now()+(Math.round(d("Random").random()*1e4)+1e4);c("QPLUserFlow").start(x(b),{annotations:{bool:{backendSetupReady:d("MAWWaitForBackendSetup").isBackendSetupSuccessful(),wasBackendSetupReset:d("MAWWaitForBackendSetup").wasBackendSetupReset(),workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},int:{timeMsSinceSessionStart:(l||(l=c("performance"))).now()},string:{hostname:window.location.hostname,pageID:c("pageID"),workerHeartbeatsOnStart:d("MAWSetupWorkerAuxStateForLogging").getHeartbeatHistoryAsString(),workerID:d("MAWWaitForBackendSetup").getCurrentWorkerID()},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},instanceKey:e});c("promiseDone")(d("MAWMIC").getState().then(function(a){p(e,{string:{mic_state:a}})}));a&&c("promiseDone")(d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){p(e,a)}));c("promiseDone")((h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(a){return d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.tables.connectivity_status)).then(function(a){if(!a)return;p(e,{int:{connection_state_ls_transport:(i||(i=d("LSIntEnum"))).toNumber(a.internetConnectionState)}})})}));c("promiseDone")(m.load().then(function(a){return a.getWorkerHealthStatus().then(function(a){p(e,{string:{workerHealthStatusOnStart:a.tag}})})}));t(e);v(e);return e}function x(a){if((j||(j=d("QPLEvent"))).getSamplingMethod(n)!==1)return n;if(!y(a))return n;a=(j||(j=d("QPLEvent"))).getSampleRate(n);var b=c("justknobx")._("3946");b=Math.max(1,Math.min(b,a));return{i:j.getMarkerId(n),m:j.getSamplingMethod(n),r:b}}function y(a){return a===d("MWMsgMediaTypeLogUtils").AttachmentType.Application||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Audio||a===d("MWMsgMediaTypeLogUtils").AttachmentType.File||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Gif||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Image||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Link||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Sticker||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Video||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Share}function e(a){c("QPLUserFlow").endSuccess(n,{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota()}},instanceKey:a}),u(a)}function f(a,b,e,f,g,h){g===void 0&&(g=!0);var i=w(g);if(a==null)return i;g=d("MWSharedS2SBaseAnnotations").getMessageTypeParams(babelHelpers.extends({},b,{threadType:a.threadType}));c("promiseDone")(d("MWSharedMsgLogUtils").getSendToSentAnnotations({attachmentTypeParams:g,messageOfflineThreadingId:h,source:e,thread:a}),function(a){a=c("mergeDeep")(a,f);p(i,a)});return i}var z=async function(a,b,d){var e=a+"_start";a=a+"_end";c("QPLUserFlow").addPoint(n,e,{instanceKey:b});e=await d();c("QPLUserFlow").addPoint(n,a,{instanceKey:b});return e};g.addSendToSentAnnotations=p;g.markSendToSentCancel=a;g.markSendToSentFail=b;g.markSendToSentPoint=q;g.markSendToSentStart=w;g.markSendToSentSuccess=e;g.markSendToSentStartWithAnnotation=f;g.measureSendToSentPerformance=z}),98);
__d("MAWMiActGetThreadLifecycleState__DO_NOT_USE",["FBLogger","I64","LSAuthorityLevel","LSIntEnum","LSMessagingThreadTypeUtil","MAWMiActGetMappingWithMawTypes","MAWMiActMappingTableAPI","MAWMiActThreadLifecycleState__DO_NOT_USE","MAWThreadLoadingState","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,e){var f=(h||(h=d("LSIntEnum"))).toNumber(a.authorityLevel);if(f===c("LSAuthorityLevel").OPTIMISTIC)if(b!=null)return babelHelpers.extends({},c("MAWMiActGetMappingWithMawTypes")(b,d("LSMessagingThreadTypeUtil").isGroup(a.threadType)),{type:d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.OPTIMISTIC_THREAD_WITH_ACT});else return{serverThreadKey:a.threadKey,thread:a,type:d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.OPTIMISTIC_THREAD_NO_ACT};if(f===c("LSAuthorityLevel").CLIENT_PARTIAL)return b!=null?babelHelpers.extends({},c("MAWMiActGetMappingWithMawTypes")(b,d("LSMessagingThreadTypeUtil").isGroup(a.threadType)),{type:d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD_WITH_ACT}):{serverThreadKey:a.threadKey,type:d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD};if(f===c("LSAuthorityLevel").SERVER_PARTIAL)return{serverThreadKey:a.threadKey,type:d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.SERVER_PARTIAL_MI_THREAD};if(f===c("LSAuthorityLevel").AUTHORITATIVE){if(b==null)return{serverThreadKey:a.threadKey,thread:a,type:d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW};var g=d("MAWThreadLoadingState").getActState(b)===d("MAWThreadLoadingState").ActState.IN_PROGRESS;if(!g)return babelHelpers.extends({},c("MAWMiActGetMappingWithMawTypes")(b,d("LSMessagingThreadTypeUtil").isGroup(a.threadType)),{type:d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE});else{g=c("MAWMiActGetMappingWithMawTypes")(b,d("LSMessagingThreadTypeUtil").isGroup(a.threadType));return{jid:g.jid,jidInt64:b.jid,serverThreadKey:g.serverThreadKey,thread:a,type:d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_ONLY}}}throw c("FBLogger")("messenger_web").mustfixThrow("[MiActMapping] Unknown thread lifecycle state for threadKey: %s, authorityLevel: %s, thread action: %s",(i||(i=d("I64"))).to_string(a.threadKey),f,e)}async function k(a,b,c){var e=await d("MAWMiActMappingTableAPI").getMappingRowForIntJid(a,b);if(e==null)return{jidInt64:b,type:d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW};a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(e.serverThreadKey));return a==null?{jidInt64:b,type:d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.JID_MISSING_MI_THREAD}:j(a,e,c)}async function l(a,b,c){var e;e=await Promise.all([(e=d("ReQL")).firstAsync(e.fromTableAscending(a.threads).getKeyRange(b)),e.firstAsync(e.fromTableAscending(a.mi_act_mapping_table).getKeyRange(b))]);a=e[0];e=e[1];return a==null?{serverThreadKey:b,type:d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.THREAD_KEY_ONLY}:j(a,e,c)}async function a(a,b,c,e){b=await k(a,b,e);if(b.type===d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW&&c!=null)return l(a,(i||(i=d("I64"))).of_string(c),"MAWBridgeOccamadilloVerifyThreadExistsHandler");else return b}g.getThreadLifecycleStateByJid=k;g.getThreadLifecycleStateByThreadKey=l;g.getThreadLifecycleStateByJidOrThreadKey=a}),98);
__d("MAWMiActOnActThreadReadyInstrumentation",["QPLUserFlow","Random","WAHashStringToNumber","isOfflineThreadingId","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WAHashStringToNumber").hashStringToNumber(a+Math.round(d("Random").random()*1e4)+1e4)}function b(a,b,d,e){c("QPLUserFlow").start(c("qpl")._(1056846543,"1530"),{annotations:{bool:{is_otid:c("isOfflineThreadingId")(d)},string:{apiName:e,description:b}},instanceKey:a})}function e(a,b){c("QPLUserFlow").addPoint(c("qpl")._(1056846543,"1530"),b,{instanceKey:a})}function f(a,b){c("QPLUserFlow").addAnnotations(c("qpl")._(1056846543,"1530"),b,{instanceKey:a})}function h(a){c("QPLUserFlow").endSuccess(c("qpl")._(1056846543,"1530"),{instanceKey:a})}function i(a,b){c("QPLUserFlow").endFailure(c("qpl")._(1056846543,"1530"),b,{instanceKey:a})}g.getOnActThreadReadyInstanceKey=a;g.startQPL=b;g.addPointQPL=e;g.addAnnotationsQPL=f;g.endSuccessQPL=h;g.endFailureQPL=i}),98);
__d("MAWVerifyThreadExistsUtils",["FBLogger","I64","LSAuthorityLevel","LSIntEnum","LSVerifyE2EEMetadataThreadExistsV2StoredProcedure","isOfflineThreadingId"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=new Map(),k=6e4,l=1e4;function m(a){if(j.size>l){c("FBLogger")("messenger_web").mustfix("MAWVerifyThreadExistsUtils: requestedThreadKeys size exceeded limit");return}j.has(a)&&(window.clearTimeout(j.get(a)),j["delete"](a));j.set(a,window.setTimeout(function(){j["delete"](a)},k))}function a(a){return j.has(a)}function b(a,b,e){var f=b.threadKey;f!=null&&m((h||(h=d("I64"))).to_string(f));f!=null&&c("isOfflineThreadingId")(f)&&(h||(h=d("I64"))).equal(b.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))&&c("FBLogger")("messenger_web").warn("MAWVerifyThreadExistsUtils: runVerifyThreadExistsSproc called with offline thread key - callsite: %s",e);return c("LSVerifyE2EEMetadataThreadExistsV2StoredProcedure")(a,b)}g.isThreadRequested=a;g.runVerifyThreadExistsSproc=b}),98);
__d("MAWMiActOnActThreadReadyQueue",["ExecutionEnvironment","I64","LSPlatformLsInitLog","MAWInit","MAWMIC","MAWMiActOnActThreadReadyInstrumentation","MAWThreadMappingQPL","MAWVerifyThreadExistsUtils","MWChatInteraction","MWFBLogger","clearTimeout","getErrorSafe","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=d("MWFBLogger").MWLogger().tags(["MiActMapping","UIActions","ThreadReady"]),n=new Map(),o=3e4;function a(a,b,e,f,g,i){var j;if(!(l||(l=c("ExecutionEnvironment"))).isInBrowser)return;d("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(i,"enqueue_by_thread_key_start");var p=(k||(k=d("I64"))).to_string(a);j=(j=n.get(p))!=null?j:[];var q=c("setTimeout")(function(){var b=d("MWChatInteraction").getInteractionTraceForThreadKey((k||(k=d("I64"))).to_string(a));b==null||b.addMarkerPoint("timeout_when_waiting_for_act_thread","AppTiming");b==null||b.addAnnotation("callsite_waiting_for_act_thread",f);b==null||b.addAnnotation("initial_thread_state",g);b==null||b.addAnnotationBoolean("is_mi_thread_requested",d("MAWVerifyThreadExistsUtils").isThreadRequested(p));d("MAWMiActOnActThreadReadyInstrumentation").addAnnotationsQPL(i,{bool:{during_mic:d("MAWMIC").duringMIC(),is_thread_requested:d("MAWVerifyThreadExistsUtils").isThreadRequested(p),ls_sync_has_ended:d("LSPlatformLsInitLog").LsSync.hasEnded(),maw_init_completed:d("MAWInit").MAWInitState.isCompleted()}});d("MAWMiActOnActThreadReadyInstrumentation").endFailureQPL(i,"enqueue_by_thread_key_timeout");m.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Took longer than "," ms to execute: "," in threadState: "," for threadKey: ",", onActThreadReady"])),o,f,g,p);e(g)},o);j.push({callback:b,description:f,telemetryInstanceKey:i,threadState:g,timeoutId:q});n.set(p,j)}function b(a,b,c,e){if(a==null&&b==null)return;var f=a!=null?b!=null?"both":"clientThreadKey":"authoritativeThreadKey";a=a==null?0:(a=(a=n.get(a))==null?void 0:a.length)!=null?a:0;b=b==null?0:(b=(b=n.get(b))==null?void 0:b.length)!=null?b:0;d("MAWThreadMappingQPL").addAnnotations({int:{authorativeThreadKeyCallbacksNum:b,clientThreadKeyCallbacksNum:a},string:{flushBasedOnKey:f,flushReason:e}},c);d("MAWThreadMappingQPL").addPoint("flush_awaiting_callbacks",c)}async function e(a,b,e,f){var g=(k||(k=d("I64"))).to_string(a),h=n.get(g);if(h==null||h.length===0)return;while(h.length!==0){var l=h.shift();if(l==null)continue;var o=l.callback,p=l.description,q=l.telemetryInstanceKey,r=l.threadState;l=l.timeoutId;d("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(q,"enqueue_by_thread_key_end");d("MAWMiActOnActThreadReadyInstrumentation").addAnnotationsQPL(q,{string:{caller_identifier:e,processed_based_on_key:f}});try{m.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Executing queued "," for threadKey: ",""])),p,g),d("MAWMiActOnActThreadReadyInstrumentation").endSuccessQPL(q),await o(a,b),c("clearTimeout")(l)}catch(a){c("clearTimeout")(l),d("MAWMiActOnActThreadReadyInstrumentation").endFailureQPL(q,"process_queue_on_act_thread_ready_failure"),m.catching(c("getErrorSafe")(a)).MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Error executing callback on ACT thread ready: ",", original threadState: ",", threadKey: ",""])),p,r,g)}}n.delete(g)}g.enqueueByThreadKey=a;g.logOnFlushQueue=b;g.processQueueOnActThreadReady=e}),98);
__d("MAWMiActOnActThreadReadyWithoutValidator",["I64","MAWMiActGetThreadLifecycleState__DO_NOT_USE","MAWMiActOnActThreadReadyInstrumentation","MAWMiActOnActThreadReadyQueue","MAWMiActThreadLifecycleState__DO_NOT_USE","MWFBLogger","emptyFunction","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("MWFBLogger").MWLogger().tags(["Occam","MiActMapping"]);async function l(a,b,e,f,g,l){var m=d("MAWMiActOnActThreadReadyInstrumentation").getOnActThreadReadyInstanceKey(e);d("MAWMiActOnActThreadReadyInstrumentation").startQPL(m,e,b,"onActThreadReady");d("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(m,"get_thread_lifecycle_state_by_thread_key_start");l=l||await d("MAWMiActGetThreadLifecycleState__DO_NOT_USE").getThreadLifecycleStateByThreadKey(a,b,e);d("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(m,"get_thread_lifecycle_state_by_thread_key_end");d("MAWMiActOnActThreadReadyInstrumentation").addAnnotationsQPL(m,{string:{threadState:l.type}});switch(l.type){case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.OPTIMISTIC_THREAD_WITH_ACT:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD_WITH_ACT:k.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[MiActMapping] Executing thread action: ",", threadState: ",", threadKey: "," on act thread ready"])),e,l.type,(j||(j=d("I64"))).to_string(b));d("MAWMiActOnActThreadReadyInstrumentation").endSuccessQPL(m);return f(b,l.jid);case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.THREAD_KEY_ONLY:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.OPTIMISTIC_THREAD_NO_ACT:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_ONLY:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.SERVER_PARTIAL_MI_THREAD:k.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[MiActMapping] Enqueue by thread key: ",", threadState: ",", threadKey: "," on act thread ready"])),e,l.type,(j||(j=d("I64"))).to_string(b));return d("MAWMiActOnActThreadReadyQueue").enqueueByThreadKey(b,f,g!=null?g:c("emptyFunction"),e,l.type,m);case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.JID_MISSING_MI_THREAD:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW:d("MAWMiActOnActThreadReadyInstrumentation").endFailureQPL(m,"jid_missing_mi_or_mapping_state");throw k.mustfixThrow("Unhandled onActThreadReady for threadKey:%s, thread action: %s",(j||(j=d("I64"))).to_string(b),e);default:l.type;throw k.mustfixThrow(" Unreachable miActThreadState.type: %s",l.type)}}function a(a,b,d){return new Promise(function(e,f){l(a,b,d,function(a,b){e({chatJid:b,serverThreadKey:a});return Promise.resolve()},function(a){return f(c("err")("Timed out waiting for ACT thread to be ready in %s. Thread state: %s",d,a))}).catch(function(){return f()})})}g.onActThreadReadyWithoutValidator=l;g.waitForACTThreadReadyWithoutValidator=a}),98);
__d("hasDefaultThreadOneToOneCapabilityDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";a=c("requireDeferred")("hasDefaultThreadOneToOneCapability").__setRef("hasDefaultThreadOneToOneCapabilityDeferred");g["default"]=a}),98);
__d("useCometMessengerhasDefaultThreadOneToOneCapability",["FBLogger","hasDefaultThreadOneToOneCapabilityDeferred","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useEffect,j=b.useState;function a(a,b){var e=d("react-compiler-runtime").c(7),f=j(!1),g=f[0],h=f[1];e[0]!==a||e[1]!==b?(f=function(){c("hasDefaultThreadOneToOneCapabilityDeferred").load().then(function(c){b==null?h(!1):c(b,a).then(function(a){h(a)})["catch"](l)})["catch"](k)},e[0]=a,e[1]=b,e[2]=f):f=e[2];var m;e[3]!==a||e[4]!==g||e[5]!==b?(m=[a,g,b],e[3]=a,e[4]=g,e[5]=b,e[6]=m):m=e[6];i(f,m);return g}function k(a){c("FBLogger")("messenger_web").warn("Error loading hasDefaultThreadOneToOneCapability. %s",a)}function l(){}g["default"]=a}),98);
__d("MAWThreadCutover",["I64","LSAuthorityLevel","LSContactBitOffset","LSDatabaseSingleton","LSMessagingThreadTypeUtil","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsSharedState","MWPActor.react","MWPreloadableQueries","ReQL","ReQLSuspense","WAJids","react-compiler-runtime","useCometMessengerhasDefaultThreadOneToOneCapability","useMAWCanThreadBeCutoverOnDemand","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b){var e=(j||(j=c("useReStore")))(),f=u(a);e=c("useCometMessengerhasDefaultThreadOneToOneCapability")(e,a);a=b!=null&&d("LSMessagingThreadTypeUtil").isGroup(b);return a?!0:f||e}async function b(a){return await C(a)!=null}function k(a){var b=d("react-compiler-runtime").c(4),e=(j||(j=c("useReStore")))(),g,h;b[0]!==e||b[1]!==a?(g=function(){return a!=null?d("MWPreloadableQueries").getCutoverThreadByThreadKey(e,a):d("ReQL").empty()},h=[e,a],b[0]=e,b[1]=a,b[2]=g,b[3]=h):(g=b[2],h=b[3]);return d("ReQLSuspense").useFirst(g,h,f.id+":62")!=null}function l(a){var b,e=(j||(j=c("useReStore")))();b=(b=d("ReQLSuspense").useFirst(function(){return a!=null?d("MWPreloadableQueries").getCutoverThreadByThreadKey(e,a):d("ReQL").empty()},[e,a],f.id+":74"))==null?void 0:b.showOpenMessageHistory;return b===!1}function e(a){a=t(a);return l(a)}function m(a,b){return d("ReQL").fromTableAscending(a.tables.mi_act_mapping_table).getKeyRange(b)}function n(a,b){return d("ReQL").fromTableAscending(a.tables.cutover_threads).filter(function(a){return(h||(h=d("I64"))).equal(a.armadilloThreadId,b)})}function o(a){var b=d("react-compiler-runtime").c(8),e=(j||(j=c("useReStore")))(),g,h;b[0]!==e||b[1]!==a?(g=function(){return a==null?d("ReQL").empty():m(e,a)},h=[e,a],b[0]=e,b[1]=a,b[2]=g,b[3]=h):(g=b[2],h=b[3]);var i=d("ReQLSuspense").useFirst(g,h,f.id+":112");b[4]!==e||b[5]!==i?(g=function(){return i==null?d("ReQL").empty():n(e,i.jid)},h=[e,i],b[4]=e,b[5]=i,b[6]=g,b[7]=h):(g=b[6],h=b[7]);return d("ReQLSuspense").useFirst(g,h,f.id+":120")}function p(a,b){return d("ReQL").fromTableAscending(a.tables.threads).getKeyRange(b.openThreadId)}function q(a){a=r(a);if(a==null||(h||(h=d("I64"))).lt(a.authorityLevel,(h||(h=d("I64"))).of_int32(c("LSAuthorityLevel").SERVER_PARTIAL)))return;return a}function r(a){var b=d("react-compiler-runtime").c(4),e=(j||(j=c("useReStore")))(),g=o(a),h;b[0]!==g||b[1]!==e?(a=function(){return g==null?d("ReQL").empty():p(e,g)},h=[e,g],b[0]=g,b[1]=e,b[2]=a,b[3]=h):(a=b[2],h=b[3]);return d("ReQLSuspense").useFirst(a,h,f.id+":162")}function s(a){var b=d("react-compiler-runtime").c(8),e=(j||(j=c("useReStore")))(),g,h;b[0]!==e||b[1]!==a?(g=function(){return a==null?d("ReQL").empty():m(e,a)},h=[e,a],b[0]=e,b[1]=a,b[2]=g,b[3]=h):(g=b[2],h=b[3]);g=d("ReQLSuspense").useFirst(g,h,f.id+":174");var i=g==null?void 0:g.jid;b[4]!==e.tables.threads||b[5]!==i?(h=function(){return i!=null?d("ReQL").fromTableAscending(e.tables.threads).getKeyRange(i):d("ReQL").empty()},g=[e.tables.threads,i],b[4]=e.tables.threads,b[5]=i,b[6]=h,b[7]=g):(h=b[6],g=b[7]);b=d("ReQLSuspense").useFirst(h,g,f.id+":183");h=c("useMAWCanThreadBeCutoverOnDemand")(i);return h?b:void 0}function t(a){a=o(a);if(a!=null)return a.openThreadId}function u(a){return o(a)!=null}function v(a,b){b=d("WAJids").threadIdForChatJid(b);return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.cutover_threads).getKeyRange((h||(h=d("I64"))).of_string(b))).then(function(a){return a!=null})}function w(){var a=d("react-compiler-runtime").c(3),b=(j||(j=c("useReStore")))(),e=d("MWPActor.react").useActor();if(a[0]!==e||a[1]!==b.tables.contacts){var g=d("ReQLSuspense").first(d("ReQL").fromTableAscending(b.tables.contacts).getKeyRange(e),f.id+":223");g=g!=null&&((g=d("LSContactBitOffset").has(75,g))!=null?g:!1);a[0]=e;a[1]=b.tables.contacts;a[2]=g}else g=a[2];return g}function x(){var a=d("react-compiler-runtime").c(4),b=(j||(j=c("useReStore")))(),e;a[0]!==b.tables.experiences_shared_state?(e=function(){return d("ReQL").fromTableAscending(b.tables.experiences_shared_state).getKeyRange(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY)},a[0]=b.tables.experiences_shared_state,a[1]=e):e=a[1];var g;a[2]!==b?(g=[b],a[2]=b,a[3]=g):g=a[3];a=d("ReQLSuspense").useFirst(e,g,f.id+":238");e=d("MWEncryptedBackupsSharedState").getEntryValue({db:b,sharedStateRow:a,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY});return e!=null}function y(a){var b=d("react-compiler-runtime").c(7),e=(j||(j=c("useReStore")))(),g;b[0]!==a?(g=a!=null?(h||(h=d("I64"))).of_string(a):void 0,b[0]=a,b[1]=g):g=b[1];var i=g,l=k(i);b[2]!==e||b[3]!==l||b[4]!==i?(a=function(){if(l&&i!=null)return d("ReQL").fromTableAscending(e.tables.mi_act_mapping_table).filter(function(a){return(h||(h=d("I64"))).equal(a.jid,i)}).map(z);else return d("ReQL").empty()},g=[e,i,l],b[2]=e,b[3]=l,b[4]=i,b[5]=a,b[6]=g):(a=b[5],g=b[6]);return d("ReQLSuspense").useFirst(a,g,f.id+":259")}function z(a){return(h||(h=d("I64"))).to_string(a.serverThreadKey)}function A(){return!0}function B(a){var b=d("react-compiler-runtime").c(8),e=(j||(j=c("useReStore")))(),g,h;b[0]!==e||b[1]!==a?(g=function(){if(a!=null)return d("MWPreloadableQueries").getCutoverThreadByThreadKey(e,a);else return d("ReQL").empty()},h=[e,a],b[0]=e,b[1]=a,b[2]=g,b[3]=h):(g=b[2],h=b[3]);g=d("ReQLSuspense").useFirst(g,h,f.id+":286");var i=g==null?void 0:g.armadilloThreadId;b[4]!==e.tables.mi_act_mapping_table||b[5]!==i?(h=function(){if(i!=null)return d("ReQL").fromTableAscending(e.tables.mi_act_mapping_table.index("jid")).getKeyRange(i);else return d("ReQL").empty()},g=[i,e.tables.mi_act_mapping_table],b[4]=e.tables.mi_act_mapping_table,b[5]=i,b[6]=h,b[7]=g):(h=b[6],g=b[7]);b=d("ReQLSuspense").useFirst(h,g,f.id+":297");return b==null?void 0:b.serverThreadKey}async function C(a){var b=await (i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton,c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.mi_act_mapping_table).getKeyRange(a));if(c==null)return void 0;a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.cutover_threads).filter(function(a){return(h||(h=d("I64"))).equal(a.armadilloThreadId,c.jid)}));return a}g.useShouldHideE2eeAttribution=a;g.isCutoverThreadKey=b;g.useIsCutoverOpenThread=k;g.useIsDualThreadCutoverOpenThread=l;g.useIsDualThreadCutoverSecureThread=e;g.getMiActMappings=m;g.getCutoverThreadsByJid=n;g.useGetCutoverMapping=o;g.getThreadByCutoverThread=p;g.useOpenThreadIfExistsFromCutoverThread=q;g.useCutoverOpenThread=r;g.useODCutoverEligibleOpenOneToOneThread=s;g.useGetCutoverOpenThreadKey=t;g.useIsCutoverSecureThread=u;g.isCutoverSecureThreadFromChatJid=v;g.useIsCurrentUserCutoverUser=w;g.useGetHasUserRestoredBefore=x;g.useGetCutoverSecureThreadKey=y;g.useSupportedCutoverEnvironment=A;g.useCutoverSecureThreadKeyForOpenThreadKey=B;g.getCutoverThreadBySecureThreadKey=C}),98);
__d("useMAWCanThreadBeCutoverOnDemand",["LSContactBitOffset","LSMessagingThreadTypeUtil","MAWThreadCutover","ReQL","ReQLSuspense","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=d("react-compiler-runtime").c(12),e=(h||(h=c("useReStore")))(),g,i;b[0]!==e||b[1]!==a?(g=function(){return a!=null?d("ReQL").fromTableAscending(e.tables.contacts,d("LSContactBitOffset").contactCapabilityFields).getKeyRange(a):d("ReQL").empty()},i=[e,a],b[0]=e,b[1]=a,b[2]=g,b[3]=i):(g=b[2],i=b[3]);g=d("ReQLSuspense").useFirst(g,i,f.id+":34");b[4]!==g?(i=g!=null&&d("LSContactBitOffset").has(76,g),b[4]=g,b[5]=i):i=b[5];g=i;var j;b[6]!==e||b[7]!==a?(i=function(){return a!=null?d("ReQL").fromTableAscending(e.tables.threads,["threadType"]).getKeyRange(a):d("ReQL").empty()},j=[e,a],b[6]=e,b[7]=a,b[8]=i,b[9]=j):(i=b[8],j=b[9]);i=d("ReQLSuspense").useFirst(i,j,f.id+":53");b[10]!==i?(j=i?d("LSMessagingThreadTypeUtil").isOpenOneToOne(i.threadType):!1,b[10]=i,b[11]=j):j=b[11];i=j;b=((j=(b=d("ReQLSuspense").useFirst(function(){return a!=null?d("ReQL").fromTableAscending(e.tables.messages_ranges_v2__generated,["minMessageId"]).getKeyRange(a):d("ReQL").empty()},[e,a],f.id+":67"))==null?void 0:b.minMessageId)!=null?j:"")==="";j=d("MAWThreadCutover").useIsCutoverOpenThread(a);var k=d("MAWThreadCutover").useIsCutoverSecureThread(a);j=j||k;return g&&i&&!b&&!j}g["default"]=a}),98);
__d("WAGlobals",["WAJids","WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null;function a(a){i=a}function j(){if(i==null)throw c("err")("WaMsgr api called before set");return i}function k(){var a;return(a=j().myJids)==null?void 0:a.deviceJid}function b(){var a;return(a=j().myJids)==null?void 0:a.userJid}function e(a){return d("WAJids").extractUserJid(a)===d("WAJids").extractUserJid(k())}function f(){return j().config}function l(){return j().dependencies}var m="WAOneQueue is not defined";function n(){var a=j().waOneQueue;if(a==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",""])),m);throw c("err")(m)}return a}function o(){return j().hmacKey}g.setGlobals=a;g.getMyDeviceJid=k;g.getMyUserJid=b;g.isPeerDevice=e;g.getConfig=f;g.getDependencies=l;g.getWaOneQueue=n;g.getHMACKey=o}),98);
__d("MAWUserJidWrapper",["ExecutionEnvironment","MAWCurrentUser","MAWODSProxy","WAGlobals","WAJids","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){var a=d("WAJids").toMsgrUserJid(d("MAWCurrentUser").getID());if((h||(h=c("ExecutionEnvironment"))).isInWorker){var b=d("WAGlobals").getMyUserJid();d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MY_USER_JID_GETTER,key:b===a?"same":"different"});return b}return a}g.getMyUserJid=a}),98);
__d("MWGetOtherContactOrSelf",["I64","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b,c){a=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(c.tables.participants).getKeyRange(a));if(a.length===1){var e=a[0];return d("ReQL").firstAsync(d("ReQL").fromTableAscending(c.tables.contacts).getKeyRange(e.contactId))}if(a.length>2)return;e=a.find(function(a){return!(h||(h=d("I64"))).equal(a.contactId,b)});if(e!=null)return d("ReQL").firstAsync(d("ReQL").fromTableAscending(c.tables.contacts).getKeyRange(e.contactId))}g.getOtherContactOrSelf=a}),98);
__d("RetUtil",["LSResult"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("LSResult")(a)}g.getNullableRetResult=a}),98);
__d("WAArrayZip",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=Math.min(a.length,b.length);return a.slice(0,c).map(function(a,c){return[a,b[c]]})}f.zip=a}),66);
__d("WADbContact",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;f.NON_CONTACT=a;f.ONE_WAY_CONTACT=b;f.REVERSED_ONE_WAY_CONTACT=c;f.TWO_WAY_CONTACT=d}),66);
__d("hasDefaultThreadOneToOneCapability",["FBLogger","LSContactBitOffset","MAWDefaultE2eeOneToOneEligibility","MWGetOtherContactOrSelf","ReQL"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b){if(a==null)return!1;var e=await d("ReQL").firstExnAsync(d("ReQL").fromTableAscending(b.tables._user_info).map(function(a){return a.facebookUserId})),f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.contacts).getKeyRange(e));if(f==null){c("FBLogger")("messenger_search").warn("Error fetching viewer details");return!1}f=d("LSContactBitOffset").has(80,f);if(!f)return!1;f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.contacts).getKeyRange(a));a=await d("MWGetOtherContactOrSelf").getOtherContactOrSelf(a,e,b);e=a!=null?a:f;return d("MAWDefaultE2eeOneToOneEligibility").isContactDefaultE2eeOneToOneEligible({maybeContact:e})}g.default=a}),98);
__d("isTlcSearchEnabled",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("qex")._("135")===!0}g["default"]=a}),98);